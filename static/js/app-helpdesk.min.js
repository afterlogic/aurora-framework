/*!
 * Copyright 2004-2015, AfterLogic Corp.
 * Licensed under AGPLv3 license or AfterLogic license
 * if commerical version of the product was purchased.
 * See the LICENSE file for a full license statement.
 */
!function($,window,ko,crossroads,hasher){"use strict";function CBrowser(){this.ie11=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),this.ie=/msie/.test(navigator.userAgent.toLowerCase())&&!window.opera||this.ie11,this.ieVersion=this.getIeVersion(),this.ie8AndBelow=this.ie&&this.ieVersion<=8,this.ie9AndBelow=this.ie&&this.ieVersion<=9,this.ie10AndAbove=this.ie&&this.ieVersion>=10,this.opera=!!window.opera||/opr/.test(navigator.userAgent.toLowerCase()),this.firefox=/firefox/.test(navigator.userAgent.toLowerCase()),this.chrome=/chrome/.test(navigator.userAgent.toLowerCase())&&!/opr/.test(navigator.userAgent.toLowerCase()),this.chromeIos=/crios/.test(navigator.userAgent.toLowerCase()),this.safari=/safari/.test(navigator.userAgent.toLowerCase())&&!this.chromeIos}function CAjax(){this.sUrl="?/Ajax/",this.requests=ko.observableArray([]),this.openedRequestsCount=ko.observable(0),this.requests.subscribe(function(){this.openedRequestsCount(this.requests().length)},this),this.aActionsWithoutAuthForSend=["SystemLogin","SystemUpdateLanguageOnLogin","SystemLogout","AccountCreate","SystemSetMobile","AccountRegister","AccountGetForgotQuestion","AccountValidateForgotQuestion","AccountChangeForgotPassword"],this.aActionsWithoutAuthForSendExt=["SocialRegister","HelpdeskRegister","HelpdeskForgot","HelpdeskLogin","HelpdeskForgotChangePassword","SystemLogout","CalendarList","CalendarEventList","FilesPub"]}function CRouting(){this.defaultScreen=Enums.Screens.Mailbox,this.currentScreen=Enums.Screens.Mailbox,this.lastMailboxHash=ko.observable(Enums.Screens.Mailbox),this.lastHelpdeskHash=ko.observable(Enums.Screens.Helpdesk),this.lastSettingsHash=ko.observable(Enums.Screens.Settings),this.currentHash=ko.observable(""),this.previousHash=ko.observable("")}function CLinkBuilder(){}function CSelector(e,t,i,s,o,n,r,a,l,p){this.fBeforeSelectCallback=null,this.fSelectCallback=t||function(){},this.fDeleteCallback=i||function(){},this.fDblClickCallback=!bMobileApp&&s?s:function(){},this.fEnterCallback=o||function(){},this.bResetCheckedOnClick=Utils.isUnd(r)?!1:!!r,this.bCheckOnSelect=Utils.isUnd(a)?!1:!!a,this.bUnselectOnCtrl=Utils.isUnd(l)?!1:!!l,this.bDisableMultiplySelection=Utils.isUnd(p)?!1:!!p,this.useKeyboardKeys=ko.observable(!1),this.list=ko.observableArray([]),e&&e.subscribe&&e.subscribe(function(e){this.list(e)},this),this.multiplyLineFactor=n,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Up,this.KeyRight=Enums.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe(function(e){this.iFactor=e>0?e:1},this):this.iFactor=Utils.pInt(this.multiplyLineFactor),this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Left,this.KeyRight=Enums.Key.Right,$("html").hasClass("rtl")&&(this.KeyLeft=Enums.Key.Right,this.KeyRight=Enums.Key.Left)),this.sActionSelector="",this.sSelectabelSelector="",this.sCheckboxSelector="";var h=this;this.listChecked=ko.computed({read:function(){var e=_.filter(this.list(),function(e){var t=e.checked(),i=e.selected();return t||h.bCheckOnSelect&&i});return e},write:function(e){e=!!e,_.each(this.list(),function(t){t.checked(e)}),this.list.valueHasMutated()},owner:this}),this.checkAll=ko.computed({read:function(){return 0<this.listChecked().length},write:function(e){this.listChecked(!!e)},owner:this}),this.selectorHook=ko.observable(null),this.selectorHook.subscribe(function(){var e=this.selectorHook();e&&e.selected(!1)},this,"beforeChange"),this.selectorHook.subscribe(function(e){e&&e.selected(!0)},this),this.itemSelected=ko.computed({read:this.selectorHook,write:function(e){this.selectorHook(e),e&&(this.oLast=e)},owner:this}),this.list.subscribe(function(e){if(_.isArray(e)){var t=this.itemSelected();t&&(_.find(e,function(e){return t===e})||this.itemSelected(null))}else this.itemSelected(null)},this),this.listCheckedOrSelected=ko.computed({read:function(){var e=this.itemSelected(),t=this.listChecked();return 0<t.length?t:e?[e]:[]},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=ko.computed({read:function(){var e=[],t=this.itemSelected(),i=this.listChecked();return i&&(e=i.slice(0)),t&&-1===_.indexOf(i,t)&&e.push(t),e},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=ko.computed(function(){var e=this.list().length,t=this.listChecked().length;return e>0&&t>0&&e>t},this),this.onKeydownBinded=_.bind(this.onKeydown,this)}function CApi(){this.openPgp=null,this.openPgpCallbacks=[]}function CStorage(){this.bHtml5=!0,this.init()}function OpenPgp(e,t){this.pgp=e,this.pgpKeyring=new this.pgp.Keyring(new this.pgp.Keyring.localstore(t)),this.keys=ko.observableArray([]),this.reloadKeysFromStorage()}function OpenPgpKey(e){this.pgpKey=e;var t=this.pgpKey.getPrimaryUser();this.user=t&&t.user?t.user.userId.userid:this.pgpKey.users&&this.pgpKey.users[0]?this.pgpKey.users[0].userId.userid:"",this.emailParts=Utils.Address.getEmailParts(this.user)}function OpenPgpResult(){this.result=!0,this.errors=null,this.notices=null,this.exceptions=null}function AlertPopup(){this.alertDesc=ko.observable(""),this.closeCallback=null,this.title=ko.observable(""),this.okButtonText=ko.observable(Utils.i18n("MAIN/BUTTON_OK"))}function ConfirmPopup(){this.fConfirmCallback=null,this.confirmDesc=ko.observable(""),this.title=ko.observable(""),this.okButtonText=ko.observable(Utils.i18n("MAIN/BUTTON_OK")),this.cancelButtonText=ko.observable(Utils.i18n("MAIN/BUTTON_CANCEL")),this.shown=!1}function ChangePasswordPopup(){this.currentPassword=ko.observable(""),this.newPassword=ko.observable(""),this.confirmPassword=ko.observable(""),this.isHelpdesk=ko.observable(!1),this.hasOldPassword=ko.observable(!1)}function CImportOpenPgpKeyPopup(){this.pgp=null,this.keyArmor=ko.observable(""),this.keyArmorFocused=ko.observable(!1),this.keys=ko.observableArray([]),this.hasExistingKeys=ko.observable(!1),this.headlineText=ko.computed(function(){return Utils.i18n("OPENPGP/INFO_TEXT_INCLUDES_KEYS_PLURAL",{},null,this.keys().length)},this)}function ContactCreatePopup(){this.displayName=ko.observable(""),this.email=ko.observable(""),this.phone=ko.observable(""),this.address=ko.observable(""),this.skype=ko.observable(""),this.facebook=ko.observable(""),this.focusDisplayName=ko.observable(!1),this.loading=ko.observable(!1),this.fCallback=null,this.oContext=null}function PlayerPopup(){this.iframe=ko.observable("")}function CAppSettingsModel(e){this.AllowWebMail=!0,this.AllowUsersChangeInterfaceSettings=!0,this.AllowUsersChangeEmailSettings=!0,this.AllowUsersAddNewAccounts=!0,this.SiteName="",this.Languages=[{name:"English",value:"en"}],this.Themes=["Default"],this.DateFormats=[],this.DefaultLanguage="English",this.AttachmentSizeLimit=1024e4,this.ImageUploadSizeLimit=1024e4,this.FileSizeLimit=1024e4,this.AutoSave=!0,this.AutoSaveIntervalSeconds=60,this.IdleSessionTimeout=0,this.AllowInsertImage=!0,this.AllowBodySize=!1,this.MaxBodySize=600,this.MaxSubjectSize=255,this.JoinReplyPrefixes=!0,this.AllowAppRegisterMailto=!0,this.AllowPrefetch=!0,this.MaxPrefetchBodiesSize=5e4,this.LoginFormType=Enums.LoginFormType.Email,this.LoginAtDomainValue="",this.AllowRegistration=!1,this.AllowPasswordReset=!1,this.RegistrationDomains=[],this.RegistrationQuestions=[],this.DemoWebMail=!0,this.DemoWebMailLogin="",this.DemoWebMailPassword="",this.LoginDescription="",this.GoogleAnalyticsAccount="",this.ShowQuotaBar=!1,this.ServerUseUrlRewrite=!1,this.AllowLanguageOnLogin=!1,this.FlagsLangSelect=!1,this.CustomLoginUrl="",this.CustomLogoutUrl="",this.IosDetectOnLogin=!1,this.AllowContactsSharing=!1,this.DefaultLanguageShort="en",this.AllowOpenPgp=e,this.DefaultTab="",this.AllowIosProfile=!0,this.PasswordMinLength=0,this.PasswordMustBeComplex=!1}function CDateModel(){this.iTimeStampInUTC=0,this.oMoment=null}function CCommonFileModel(){this.isIosDevice=bIsIosDevice,this.isFolder=ko.observable(!1),this.isLink=ko.observable(!1),this.linkType=ko.observable(Enums.FileStorageLinkType.Unknown),this.linkUrl=ko.observable(""),this.isPopupItem=ko.observable(!1),this.id=ko.observable(""),this.fileName=ko.observable(""),this.tempName=ko.observable(""),this.displayName=ko.observable(""),this.extension=ko.observable(""),this.oembed=ko.observable(""),this.linkType.subscribe(function(e){var t="";switch(e){case Enums.FileStorageLinkType.YouTube:t="YouTube";break;case Enums.FileStorageLinkType.Vimeo:(!App.browser.ie||App.browser.ie11)&&(t="Vimeo");break;case Enums.FileStorageLinkType.SoundCloud:(!App.browser.ie||App.browser.ie10AndAbove)&&(t="SoundCloud")}this.oembed(t)},this),this.fileName.subscribe(function(e){this.id(e),this.displayName(e),this.extension(this.isFolder()?"":Utils.getFileExtension(e))},this),this.size=ko.observable(0),this.friendlySize=ko.computed(function(){return this.size()>0?Utils.friendlySize(this.size()):""},this),this.content=ko.observable(""),this.accountId=ko.observable(AppData.Accounts?AppData.Accounts.defaultId():null),this.hash=ko.observable(""),this.thumb=ko.observable(!1),this.iframedView=ko.observable(!1),this.downloadLink=ko.computed(function(){return Utils.getDownloadLinkByHash(this.accountId(),this.hash())},this),this.viewLink=ko.computed(function(){var e=Utils.File.getViewLinkByHash(this.accountId(),this.hash());return this.iframedView()?Utils.getIframeWrappwer(this.accountId(),e):e},this),this.thumbnailSrc=ko.observable(""),this.thumbnailLoaded=ko.observable(!1),this.thumbnailSessionUid=ko.observable(""),this.thumbnailLink=ko.computed(function(){return this.thumb()?Utils.getViewThumbnailLinkByHash(this.accountId(),this.hash()):""},this),this.type=ko.observable(""),this.uploadUid=ko.observable(""),this.uploaded=ko.observable(!1),this.uploadError=ko.observable(!1),this.visibleImportLink=ko.computed(function(){return AppData.User.enableOpenPgp()&&"asc"===this.extension().toLowerCase()&&""!==this.content()&&!this.isPopupItem()},this),this.isViewMimeType=ko.computed(function(){return-1!==$.inArray(this.type(),aViewMimeTypes)||this.iframedView()},this),this.isMessageType=ko.observable(!1),this.visibleViewLink=ko.computed(function(){return this.isVisibleViewLink()&&!this.isPopupItem()},this),this.visibleOpenLink=ko.computed(function(){return""!==this.linkUrl()},this),this.visibleDownloadLink=ko.computed(function(){return!this.isPopupItem()&&!this.visibleOpenLink()},this),this.subFiles=ko.observableArray([]),this.allowExpandSubFiles=ko.observable(!1),this.subFilesLoaded=ko.observable(!1),this.subFilesCollapsed=ko.observable(!1),this.subFilesStartedLoading=ko.observable(!1),this.visibleExpandLink=ko.computed(function(){return this.allowExpandSubFiles()&&!this.subFilesCollapsed()&&!this.subFilesStartedLoading()},this),this.visibleExpandingText=ko.computed(function(){return this.allowExpandSubFiles()&&!this.subFilesCollapsed()&&this.subFilesStartedLoading()},this),this.visibleSpinner=ko.observable(!1),this.statusText=ko.observable(""),this.statusTooltip=ko.computed(function(){return this.uploadError()?this.statusText():""},this),this.progressPercent=ko.observable(0),this.visibleProgress=ko.observable(!1),this.uploadStarted=ko.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this),this.allowDrag=ko.observable(!1),this.allowSelect=ko.observable(!1),this.allowCheck=ko.observable(!1),this.allowDelete=ko.observable(!1),this.allowUpload=ko.observable(!1),this.allowSharing=ko.observable(!1),this.allowHeader=ko.observable(!1),this.allowDownload=ko.observable(!0),this.downloadTitle=ko.computed(function(){var e="";return!this.allowSelect()&&this.allowDownload()&&(e=Utils.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()}),""===this.friendlySize()&&(e=e.replace(" ()",""))),e},this),this.oembedHtml=ko.observable("")}function CContactModel(){this.allowSendEmails=ko.computed(function(){return AppData.App.AllowWebMail&&AppData.Accounts.isCurrentAllowsMail()},this),this.sEmailDefaultType=Enums.ContactEmailType.Personal,this.sPhoneDefaultType=Enums.ContactPhoneType.Mobile,this.sAddressDefaultType=Enums.ContactAddressType.Personal,this.voiceApp=null,App.Phone&&(this.voiceApp=App.Phone.voiceApp),this.idContact=ko.observable(""),this.idUser=ko.observable(""),this.global=ko.observable(!1),this.itsMe=ko.observable(!1),this.isNew=ko.observable(!1),this.readOnly=ko.observable(!1),this.edited=ko.observable(!1),this.extented=ko.observable(!1),this.personalCollapsed=ko.observable(!1),this.businessCollapsed=ko.observable(!1),this.otherCollapsed=ko.observable(!1),this.groupsCollapsed=ko.observable(!1),this.displayName=ko.observable(""),this.firstName=ko.observable(""),this.lastName=ko.observable(""),this.nickName=ko.observable(""),this.skype=ko.observable(""),this.facebook=ko.observable(""),this.displayNameFocused=ko.observable(!1),this.primaryEmail=ko.observable(this.sEmailDefaultType),this.primaryPhone=ko.observable(this.sPhoneDefaultType),this.primaryAddress=ko.observable(this.sAddressDefaultType),this.mainPrimaryEmail=ko.computed({read:this.primaryEmail,write:function(e){this.primaryEmail(!Utils.isUnd(e)&&0<=Utils.inArray(e,[Enums.ContactEmailType.Personal,Enums.ContactEmailType.Business,Enums.ContactEmailType.Other])?e:Enums.ContactEmailType.Personal)},owner:this}),this.mainPrimaryPhone=ko.computed({read:this.primaryPhone,write:function(e){this.primaryPhone(!Utils.isUnd(e)&&0<=Utils.inArray(e,[Enums.ContactPhoneType.Mobile,Enums.ContactPhoneType.Personal,Enums.ContactPhoneType.Business])?e:Enums.ContactPhoneType.Mobile)},owner:this}),this.mainPrimaryAddress=ko.computed({read:this.primaryAddress,write:function(e){this.primaryAddress(!Utils.isUnd(e)&&0<=Utils.inArray(e,[Enums.ContactAddressType.Personal,Enums.ContactAddressType.Business])?e:Enums.ContactAddressType.Personal)},owner:this}),this.personalEmail=ko.observable(""),this.personalStreetAddress=ko.observable(""),this.personalCity=ko.observable(""),this.personalState=ko.observable(""),this.personalZipCode=ko.observable(""),this.personalCountry=ko.observable(""),this.personalWeb=ko.observable(""),this.personalFax=ko.observable(""),this.personalPhone=ko.observable(""),this.personalMobile=ko.observable(""),this.businessEmail=ko.observable(""),this.businessCompany=ko.observable(""),this.businessDepartment=ko.observable(""),this.businessJob=ko.observable(""),this.businessOffice=ko.observable(""),this.businessStreetAddress=ko.observable(""),this.businessCity=ko.observable(""),this.businessState=ko.observable(""),this.businessZipCode=ko.observable(""),this.businessCountry=ko.observable(""),this.businessWeb=ko.observable(""),this.businessFax=ko.observable(""),this.businessPhone=ko.observable(""),this.otherEmail=ko.observable(""),this.otherBirthdayMonth=ko.observable("0"),this.otherBirthdayDay=ko.observable("0"),this.otherBirthdayYear=ko.observable("0"),this.otherNotes=ko.observable(""),this.etag=ko.observable(""),this.sharedToAll=ko.observable(!1),this.birthdayIsEmpty=ko.computed(function(){var e="0"===this.otherBirthdayMonth(),t="0"===this.otherBirthdayDay(),i="0"===this.otherBirthdayYear();return e||t||i},this),this.otherBirthday=ko.computed(function(){var e="",t=Utils.pInt(this.otherBirthdayYear()),i=Utils.pInt(this.otherBirthdayMonth()),s=Utils.pInt(this.otherBirthdayDay()),o=new CDateModel;if(!this.birthdayIsEmpty()){var n=moment().diff(moment(t+"/"+i+"/"+s,"YYYY/MM/DD"),"years"),r=Utils.i18n("CONTACTS/YEARS_TEXT_PLURAL",{COUNT:n},null,n);o.setDate(t,i>0?i-1:0,s),e=o.getShortDate()+" ("+r+")"}return e},this),this.groups=ko.observableArray([]),this.groupsIsEmpty=ko.computed(function(){return 0===this.groups().length},this),this.email=ko.computed({read:function(){var e="";switch(this.primaryEmail()){case Enums.ContactEmailType.Personal:e=this.personalEmail();break;case Enums.ContactEmailType.Business:e=this.businessEmail();break;case Enums.ContactEmailType.Other:e=this.otherEmail()}return e},write:function(e){switch(this.primaryEmail()){case Enums.ContactEmailType.Personal:this.personalEmail(e);break;case Enums.ContactEmailType.Business:this.businessEmail(e);break;case Enums.ContactEmailType.Other:this.otherEmail(e);break;default:this.primaryEmail(this.sEmailDefaultType),this.email(e)}},owner:this}),this.personalIsEmpty=ko.computed(function(){var e=this.personalEmail()!==this.email()?this.personalEmail():"";return""==""+e+this.personalStreetAddress()+this.personalCity()+this.personalState()+this.personalZipCode()+this.personalCountry()+this.personalWeb()+this.personalFax()+this.personalPhone()+this.personalMobile()},this),this.businessIsEmpty=ko.computed(function(){var e=this.businessEmail()!==this.email()?this.businessEmail():"";return""==""+e+this.businessCompany()+this.businessDepartment()+this.businessJob()+this.businessOffice()+this.businessStreetAddress()+this.businessCity()+this.businessState()+this.businessZipCode()+this.businessCountry()+this.businessWeb()+this.businessFax()+this.businessPhone()},this),this.otherIsEmpty=ko.computed(function(){var e=this.otherEmail()!==this.email()?this.otherEmail():"";return""==""+e+this.otherNotes()&&this.birthdayIsEmpty()},this),this.phone=ko.computed({read:function(){var e="";switch(this.primaryPhone()){case Enums.ContactPhoneType.Mobile:e=this.personalMobile();break;case Enums.ContactPhoneType.Personal:e=this.personalPhone();break;case Enums.ContactPhoneType.Business:e=this.businessPhone()}return e},write:function(e){switch(this.primaryPhone()){case Enums.ContactPhoneType.Mobile:this.personalMobile(e);break;case Enums.ContactPhoneType.Personal:this.personalPhone(e);break;case Enums.ContactPhoneType.Business:this.businessPhone(e);break;default:this.primaryPhone(this.sEmailDefaultType),this.phone(e)}},owner:this}),this.address=ko.computed({read:function(){var e="";switch(this.primaryAddress()){case Enums.ContactAddressType.Personal:e=this.personalStreetAddress();break;case Enums.ContactAddressType.Business:e=this.businessStreetAddress()}return e},write:function(e){switch(this.primaryAddress()){case Enums.ContactAddressType.Personal:this.personalStreetAddress(e);break;case Enums.ContactAddressType.Business:this.businessStreetAddress(e);break;default:this.primaryAddress(this.sEmailDefaultType),this.address(e)}},owner:this}),this.emails=ko.computed(function(){var e=[];return""!==this.personalEmail()&&e.push({text:Utils.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalEmail(),value:Enums.ContactEmailType.Personal}),""!==this.businessEmail()&&e.push({text:Utils.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessEmail(),value:Enums.ContactEmailType.Business}),""!==this.otherEmail()&&e.push({text:Utils.i18n("CONTACTS/OPTION_OTHER")+": "+this.otherEmail(),value:Enums.ContactEmailType.Other}),e},this),this.phones=ko.computed(function(){var e=[];return""!==this.personalMobile()&&e.push({text:Utils.i18n("CONTACTS/LABEL_MOBILE")+": "+this.personalMobile(),value:Enums.ContactPhoneType.Mobile}),""!==this.personalPhone()&&e.push({text:Utils.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalPhone(),value:Enums.ContactPhoneType.Personal}),""!==this.businessPhone()&&e.push({text:Utils.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessPhone(),value:Enums.ContactPhoneType.Business}),e},this),this.addresses=ko.computed(function(){var e=[];return""!==this.personalStreetAddress()&&e.push({text:Utils.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalStreetAddress(),value:Enums.ContactAddressType.Personal}),""!==this.businessStreetAddress()&&e.push({text:Utils.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessStreetAddress(),value:Enums.ContactAddressType.Business}),e},this),this.hasEmails=ko.computed(function(){return 0<this.emails().length},this),this.extented.subscribe(function(e){e&&(this.personalCollapsed(!this.personalIsEmpty()),this.businessCollapsed(!this.businessIsEmpty()),this.otherCollapsed(!this.otherIsEmpty()),this.groupsCollapsed(!this.groupsIsEmpty()))},this),this.birthdayMonthSelect=CContactModel.birthdayMonthSelect,this.birthdayYearSelect=CContactModel.birthdayYearSelect,this.birthdayDaySelect=ko.computed(function(){for(var e=1,t=Utils.pInt(Utils.daysInMonth(this.otherBirthdayMonth(),this.otherBirthdayYear())),i="",s=[{text:Utils.i18n("DATETIME/DAY"),value:"0"}];t>=e;e++)i=e.toString(),s.push({text:i,value:i});return s},this);for(var e=new Date,t="",i=e.getFullYear(),s=1932;i>=s;i--)t=i.toString(),this.birthdayYearSelect.push({text:t,value:t});this.canBeSave=ko.computed(function(){return""!==this.displayName()||!!this.emails().length},this),this.sendMailLink=ko.computed(function(){return bMobileApp?this.getSendMailLink(this.email()):"#"},this),this.sendMailToPersonalLink=ko.computed(function(){return bMobileApp?this.getSendMailLink(this.personalEmail()):"#"},this),this.sendMailToBusinessLink=ko.computed(function(){return bMobileApp?this.getSendMailLink(this.businessEmail()):"#"},this),this.sendMailToOtherLink=ko.computed(function(){return bMobileApp?this.getSendMailLink(this.otherEmail()):"#"},this)}function CPostModel(){this.Id=null,this.IdThread=null,this.IdOwner=null,this.sFrom="",this.sDate="",this.iType=null,this.bSysType=!1,this.bThreadOwner=null,this.sText="",this.collapsed=ko.observable(!1),this.attachments=ko.observableArray([]),this.allowDownloadAttachmentsLink=!0,this.itsMe=ko.observable(!1),this.canBeDeleted=this.itsMe}function CThreadListModel(){this.Id=null,this.ThreadHash="",this.IdOwner=null,this.ItsMe=!1,this.aOwner=[],this.sSubject="",this.sEmail="",this.sName="",this.sFrom="",this.sFromFull="",this.time=ko.observable(0),this.state=ko.observable(0),this.unseen=ko.observable(!1),this.postsCount=ko.observable(0),this.date=ko.computed(function(){return moment(1e3*this.time()).fromNow(!1)},this),this.printableState=ko.computed(function(){var e="",t=this.ItsMe?"_FOR_CLIENT":"";switch(this.state()){case Enums.HelpdeskThreadStates.Pending:e=Utils.i18n("HELPDESK/THREAD_STATE_PENDING"+t);break;case Enums.HelpdeskThreadStates.Resolved:e=Utils.i18n("HELPDESK/THREAD_STATE_RESOLVED"+t);break;case Enums.HelpdeskThreadStates.Waiting:e=Utils.i18n("HELPDESK/THREAD_STATE_WAITING"+t);break;case Enums.HelpdeskThreadStates.Answered:e=Utils.i18n("HELPDESK/THREAD_STATE_ANSWERED"+t);break;case Enums.HelpdeskThreadStates.Deferred:e=Utils.i18n("HELPDESK/THREAD_STATE_DEFERRED"+t)}return e},this),this.deleted=ko.observable(!1),this.checked=ko.observable(!1),this.selected=ko.observable(!1)}function CHelpdeskAttachmentModel(){CCommonFileModel.call(this),this.downloadLink=ko.computed(function(){var e=!bExtApp&&AppData&&AppData.Accounts?AppData.Accounts.currentId():0,t=bExtApp&&AppData?AppData.TenantHash:"";return Utils.getDownloadLinkByHash(e,this.hash(),bExtApp,t)},this),this.viewLink=ko.computed(function(){var e=!bExtApp&&AppData&&AppData.Accounts?AppData.Accounts.currentId():0,t=bExtApp&&AppData?AppData.TenantHash:"";return Utils.File.getViewLinkByHash(e,this.hash(),bExtApp,t)},this),this.thumbnailLink=ko.computed(function(){var e=!bExtApp&&AppData&&AppData.Accounts?AppData.Accounts.currentId():0,t=bExtApp&&AppData?AppData.TenantHash:"",i=this.thumb()?Utils.getViewThumbnailLinkByHash(e,this.hash(),bExtApp,t):"";return i},this)}function CUserSettingsModel(){this.Name="",this.Email="",this.DefaultLanguage="English",this.DefaultDateFormat="MM/DD/YYYY",this.defaultTimeFormat=ko.observable(Enums.TimeFormat.F24),this.IsHelpdeskAgent=!0,this.HelpdeskIframeUrl="",this.enableOpenPgp=ko.observable(!1),this.helpdeskSignature=ko.observable(""),this.helpdeskSignatureEnable=ko.observable(!1),this.HasPassword=!1}function CInformationViewModel(){this.iAnimationDuration=500,this.iReportDuration=5e3,this.iErrorDuration=1e4,this.loadingMessage=ko.observable(""),this.loadingHidden=ko.observable(!0),this.loadingVisible=ko.observable(!1),this.reportMessage=ko.observable(""),this.reportHidden=ko.observable(!0),this.reportVisible=ko.observable(!1),this.reportVisibleClose=ko.observable(!1),this.iReportTimeout=-1,this.errorMessage=ko.observable(""),this.errorHidden=ko.observable(!0),this.errorVisible=ko.observable(!1),this.iErrorTimeout=-1,this.isHtmlError=ko.observable(!1),this.gray=ko.observable(!1)}function CPageSwitcherViewModel(e,t){this.shown=!1,this.currentPage=ko.observable(1),this.count=ko.observable(e),this.perPage=ko.observable(t),this.firstPage=ko.observable(1),this.lastPage=ko.observable(1),this.pagesCount=ko.computed(function(){var e=Math.ceil(this.count()/this.perPage());return e>0?e:1},this),ko.computed(function(){var e=20,t=4,i=this.pagesCount(),s=this.currentPage(),o=s,n=s;if(i>1)for(;;){if(e--,o>1&&(o--,t--),0===t)break;if(i>n&&(n++,t--),0===t)break;if(0===e)break}this.firstPage(o),this.lastPage(n)},this),this.visibleFirst=ko.computed(function(){return this.firstPage()>1},this),this.visibleLast=ko.computed(function(){return this.lastPage()<this.pagesCount()},this),this.clickPage=_.bind(this.clickPage,this),this.pages=ko.computed(function(){var e=this.firstPage(),t=[];if(this.firstPage()<this.lastPage())for(;e<=this.lastPage();e++)t.push({number:e,current:e===this.currentPage(),clickFunc:this.clickPage});return t},this),this.hotKeysBind()}function CHelpdeskLoginViewModel(){this.emailFocus=ko.observable(!1),this.email=ko.observable(""),this.passwordFocus=ko.observable(!1),this.password=ko.observable(""),this.signMeType=ko.observable(!0),this.signMe=ko.observable(!0),this.loginDescription=ko.observable(""),this.loginProcess=ko.observable(!1),this.loginCustomLogo=ko.observable(AppData.HelpdeskStyleImage||""),this.activationDescription=ko.observable(""),this.registeringProcess=ko.observable(!1),this.regNameFocus=ko.observable(!1),this.regName=ko.observable(""),this.regEmailFocus=ko.observable(!1),this.regSocialEmailFocus=ko.observable(!1),this.regEmail=ko.observable(""),this.regSocialEmail=ko.observable(""),this.regPasswordFocus=ko.observable(!1),this.regPassword=ko.observable(""),this.regConfirmPasswordFocus=ko.observable(!1),this.regConfirmPassword=ko.observable(""),this.helpdeskQuestion=ko.observable(""),this.helpdeskQuestion.subscribe(function(e){e||App.Storage.setData("helpdeskQuestion")},this),this.helpdeskQuestionFocus=ko.observable(""),this.signInButtonText=ko.computed(function(){return Utils.i18n(this.registeringProcess()?"LOGIN/BUTTON_SIGNING_IN":"LOGIN/BUTTON_SIGN_IN")},this),this.regButtonText=ko.computed(function(){return Utils.i18n(this.registeringProcess()?"HELPDESK/BUTTON_REGISTERING":"HELPDESK/BUTTON_REGISTER")},this),this.sendingPasswordProcess=ko.observable(!1),this.forgotButtonText=ko.computed(function(){return Utils.i18n(this.sendingPasswordProcess()?"MAIN/BUTTON_SENDING":"HELPDESK/BUTTON_SEND_PASSWORD")},this),this.forgotEmailFocus=ko.observable(!1),this.forgotEmail=ko.observable(""),this.changingPasswordProcess=ko.observable(!1),this.changepassButtonText=ko.computed(function(){return Utils.i18n(this.changingPasswordProcess()?"HELPDESK/BUTTON_CHANGING_PASS":"HELPDESK/BUTTON_CHANGE_PASS")},this),this.changepassNewpassFocus=ko.observable(!1),this.changepassNewpass=ko.observable(""),this.changepassConfirmpassFocus=ko.observable(!1),this.changepassConfirmpass=ko.observable(""),this.gotoForgot=ko.observable(!1),this.gotoRegister=ko.observable(!1),this.gotoSignin=ko.observable(!1),this.gotoSocialRegister=ko.observable(!1),this.gotoChangepass=ko.observable(AppData.HelpdeskForgotHash?!0:!1),this.socialFacebook=ko.observable(AppData.SocialFacebook),this.socialGoogle=ko.observable(AppData.SocialGoogle),this.socialTwitter=ko.observable(AppData.SocialTwitter),this.socialEmail=ko.observable(AppData.SocialEmail),this.socialIsLoggedIn=ko.observable(AppData.SocialIsLoggedIn),this.shake=ko.observable(!1).extend({autoResetToFalse:800}),this.loginCommand=Utils.createCommand(this,this.actionLogin,function(){return!this.loginProcess()}),this.sendCommand=Utils.createCommand(this,this.actionSend,this.helpdeskQuestion),this.registerCommand=Utils.createCommand(this,this.actionRegister,function(){return!this.registeringProcess()&&""!==Utils.trim(this.regPassword())&&""!==Utils.trim(this.regConfirmPassword())&&""!==Utils.trim(this.regEmail())}),this.forgotCommand=Utils.createCommand(this,this.actionForgot,function(){return!this.sendingPasswordProcess()&&""!==Utils.trim(this.forgotEmail())}),this.socialNetworkLogin(),AfterLogicApi.runPluginHook&&AfterLogicApi.runPluginHook("view-model-defined",[this.__name,this])}function CHelpdeskHeaderViewModel(){this.sThreadsHash=App.Routing.buildHashFromArray([Enums.Screens.Helpdesk]),this.settingsHash=App.Routing.lastSettingsHash}function CHelpdeskViewModel(){var e=this,t=function(t){return function(){e.executeChangeState(t),e.isQuickReplyHidden(!e.bAgent),t===Enums.HelpdeskThreadStates.Resolved&&(e.selectedItem(null),App.Routing.setHash([Enums.Screens.Helpdesk,""]))}};this.bRtl=Utils.isRTL(),this.iAutoCheckTimer=0,this.bExtApp=bExtApp,this.ajaxSendFunc=this.bExtApp?"sendExt":"send",this.bAgent=AppData.User.IsHelpdeskAgent,this.singleMode=AppData.SingleMode,this.externalUrl=ko.observable(AppData.HelpdeskIframeUrl),this.signature=AppData.User.helpdeskSignature,this.signatureEnable=AppData.User.helpdeskSignatureEnable,this.isSignatureVisible=ko.computed(function(){return""!==this.signature()&&"1"===this.signatureEnable()},this),this.loadingList=ko.observable(!0),this.loadingViewPane=ko.observable(!1),this.loadingMoreMessages=ko.observable(!1),this.threads=ko.observableArray([]),this.posts=ko.observableArray([]),this.iPingInterval=-1,this.iPingStartTimer=-1,this.selectedItem=ko.observable(null),this.previousSelectedItem=ko.observable(null),this.postForDelete=ko.observable(null),this.state=ko.observable(0),this.selectedItem.subscribe(function(e){this.state(e?e.state():0),this.subject(this.selectedItem()?this.bExtApp?this.selectedItem().sSubject:this.selectedItem().sFromFull:""),this.internalNote(!1),!this.bExtApp&&this.selectedItem()&&App.ContactsCache.getContactsByEmails([this.selectedItem().sEmail],this.onOwnerContactResponse,this),clearInterval(this.iPingInterval),clearTimeout(this.iPingStartTimer),this.watchers([]),this.selectedItem()&&(this.iPingStartTimer=setTimeout(_.bind(function(){this.executeThreadPing(this.selectedItem().Id),clearInterval(this.iPingInterval),this.iPingInterval=setInterval(_.bind(function(){this.executeThreadPing(this.selectedItem().Id)},this),18e4)},this),5e3))},this),this.listFilter=ko.observable(this.bAgent?Enums.HelpdeskFilters.Open:Enums.HelpdeskFilters.All),this.listFilter.subscribe(function(){this.requestThreadsList()},this),this.prevListFilter=ko.observable(""),this.hasMorePosts=ko.computed(function(){var e=this.selectedItem();return e&&e.postsCount()>this.posts().length},this).extend({throttle:1}),this.selector=new CSelector(this.threads,_.bind(this.onItemSelect,this),_.bind(this.onItemDelete,this),null,null,null,!1,!1,!1,!0),this.checkStarted=ko.observable(!1),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.ThreadsPerPage=10,this.oPageSwitcher=new CPageSwitcherViewModel(0,this.ThreadsPerPage),this.oPageSwitcher.currentPage.subscribe(function(){this.requestThreadsList()},this),this.isSearchFocused=ko.observable(!1),this.search=ko.observable(""),this.searchText=ko.computed(function(){return Utils.i18n("HELPDESK/INFO_SEARCH_RESULT",{SEARCH:this.search()})},this),this.deleteCommand=Utils.createCommand(this,this.executeDelete,this.isEnableListActions),this.openNewWindowCommand=Utils.createCommand(this,this.executeOpenNewWindow,this.isEnableListActions),this.checkCommand=Utils.createCommand(this,function(){this.requestThreadsList(),this.requestPosts(),this.startAutocheckmail()}),this.closeCommand=Utils.createCommand(this,t(Enums.HelpdeskThreadStates.Resolved),this.isEnableListActions),this.waitCommand=Utils.createCommand(this,t(Enums.HelpdeskThreadStates.Waiting),this.isEnableListActions),
this.pendingCommand=Utils.createCommand(this,t(Enums.HelpdeskThreadStates.Pending),this.isEnableListActions),this.deferCommand=Utils.createCommand(this,t(Enums.HelpdeskThreadStates.Deferred),this.isEnableListActions),this.answerCommand=Utils.createCommand(this,t(Enums.HelpdeskThreadStates.Answered),this.isEnableListActions),this.postCommand=Utils.createCommand(this,this.executePostCreate,function(){return!!this.selectedItem()&&!this.isQuickReplyPaneEmpty()&&this.allAttachmentsUploaded()}),this.visibleNewThread=ko.observable(!1),this.newThreadId=ko.observable(0),this.newThreadText=ko.observable(""),this.newThreadCreating=ko.observable(!1),this.domNewThreadTextarea=ko.observable(null),this.newThreadTextFocus=ko.observable(null),this.createThreadCommand=Utils.createCommand(this,this.executeThreadCreate,function(){return this.visibleNewThread()&&this.newThreadText().length>0&&!this.newThreadCreating()}),this.createThreadButtonText=ko.computed(function(){return Utils.i18n(this.newThreadCreating()?"MAIN/BUTTON_SENDING":"HELPDESK/BUTTON_CREATE")},this),this.commandGetOlderPosts=function(){var e=this.posts(),t=e[0]?e[0].Id:0;this.requestPosts(null,t)},this.externalContentUrl=ko.observable(""),AppData.HelpdeskIframeUrl&&(this.bAgent?this.externalContentUrl=ko.computed(function(){var e="",t=this.selectedItem();return t&&(e=t.Email()),e?AppData.HelpdeskIframeUrl.replace(/\[EMAIL\]/g,e):""},this):AppData.User.Email&&(this.externalContentUrl=ko.computed(function(){return AppData.HelpdeskIframeUrl.replace(/\[EMAIL\]/g,AppData.User.Email)},this))),this.clientDetailsVisible=ko.observable(App.Storage.hasData("HelpdeskUserDetails")?App.Storage.getData("HelpdeskUserDetails"):!0),this.clientDetailsVisible.subscribe(function(e){App.Storage.setData("HelpdeskUserDetails",e)},this),this.subject=ko.observable(""),this.watchers=ko.observableArray([]),this.ownerExistsInContacts=ko.observable(!1),this.ownerContactInfoReceived=ko.observable(!1),this.ownerContact=ko.observable(this.bExtApp?null:new CContactModel),this.hasOwnerContact=ko.computed(function(){return!this.singleMode&&this.ownerContactInfoReceived()&&this.ownerExistsInContacts()},this),this.visibleAddToContacts=ko.computed(function(){return!this.singleMode&&this.ownerContactInfoReceived()&&!this.ownerExistsInContacts()},this),this.contactCardWidth=ko.observable(0),this.uploadedFiles=ko.observableArray([]),this.allAttachmentsUploaded=ko.computed(function(){var e=_.filter(this.uploadedFiles(),function(e){return!e.uploaded()});return 0===e.length},this),this.uploaderButton=ko.observable(null),this.uploaderButtonCompose=ko.observable(null),this.uploaderArea=ko.observable(null),this.bDragActive=ko.observable(!1),this.internalNote=ko.observable(!1),this.ccbccVisible=ko.observable(!1),this.ccAddrDom=ko.observable(),this.ccAddrDom.subscribe(function(){this.initInputosaurus(this.ccAddrDom,this.ccAddr,this.lockCcAddr,"cc")},this),this.lockCcAddr=ko.observable(!1),this.ccAddr=ko.observable("").extend({reversible:!0}),this.ccAddr.subscribe(function(){this.lockCcAddr()||($(this.ccAddrDom()).val(this.ccAddr()),$(this.ccAddrDom()).inputosaurus("refresh"))},this),this.bccAddrDom=ko.observable(),this.bccAddrDom.subscribe(function(){this.initInputosaurus(this.bccAddrDom,this.bccAddr,this.lockBccAddr,"bcc")},this),this.lockBccAddr=ko.observable(!1),this.bccAddr=ko.observable("").extend({reversible:!0}),this.bccAddr.subscribe(function(){this.lockBccAddr()||($(this.bccAddrDom()).val(this.bccAddr()),$(this.bccAddrDom()).inputosaurus("refresh"))},this),this.preventFalseClick=ko.observable(!1).extend({autoResetToFalse:500}),this.isQuickReplyHidden=ko.observable(!this.bAgent),this.domQuickReply=ko.observable(null),this.domQuickReplyTextarea=ko.observable(null),this.replySendingStarted=ko.observable(!1),this.replyPaneVisible=ko.observable(!0),this.replyText=ko.observable(""),this.replyTextFocus=ko.observable(!1),this.isQuickReplyActive=ko.observable(!1),this.replyTextFocus.subscribe(function(e){e&&(this.isQuickReplyActive(!0),this.setSignature(this.replyText,this.domQuickReplyTextarea()))},this),this.isQuickReplyActive.subscribe(function(){this.isQuickReplyActive()&&this.replyTextFocus(!0)},this),this.isQuickReplyPaneEmpty=ko.computed(function(){return Utils.trim(this.replyText())===this.signature()||""===this.replyText()},this),this.isNewThreadPaneEmpty=ko.computed(function(){return Utils.trim(this.newThreadText())===this.signature()||""===this.newThreadText()},this),this.isSearch=ko.computed(function(){return""!==this.search()},this),this.isEmptyList=ko.computed(function(){return 0===this.threads().length},this),this.dynamicEmptyListInfo=this.bAgent?ko.computed(function(){return Utils.i18n(this.isEmptyList()&&this.isSearch()?"HELPDESK/INFO_SEARCH_EMPTY":"HELPDESK/INFO_EMPTY_OPEN_THREAD_LIST_AGENT")},this):ko.computed(function(){return Utils.i18n(this.isEmptyList()&&this.isSearch()?"HELPDESK/INFO_SEARCH_EMPTY":"HELPDESK/INFO_EMPTY_THREAD_LIST")},this),this.simplePreviewPane=ko.computed(function(){var e=this.selectedItem();return e?e.ItsMe:!this.bAgent},this),this.allowInternalNote=ko.computed(function(){return!this.simplePreviewPane()},this),this.scrollToTopTrigger=ko.observable(!1),this.scrollToBottomTrigger=ko.observable(!1),this.allowDownloadAttachmentsLink=!1,this.newThreadButtonWidth=ko.observable(0),this.focusedField=ko.observable(),this.requestFromLogin()}function CHelpdeskSettingsViewModel(){this.name=ko.observable(AppData.User.Name),this.language=ko.observable(AppData.User.DefaultLanguage),this.timeFormat=ko.observable(AppData.User.defaultTimeFormat()),this.aDateFormats=Utils.getDateFormatsForSelector(),this.dateFormat=ko.observable(AppData.User.DefaultDateFormat),this.hasPassword=ko.observable(AppData.User.HasPassword)}function CScreens(){var e=$(window);this.resizeAll=_.debounce(function(){e.resize()},100),this.oScreens={},this.currentScreen=ko.observable(""),this.informationScreen=ko.observable(null),this.popups=[]}function AbstractApp(){this.browser=new CBrowser;try{this.favico=!this.browser.ie8AndBelow&&window.Favico?new window.Favico({animation:"none"}):null}catch(e){this.favico=null}this.Ajax=new CAjax,this.Screens=new CScreens,this.Api=new CApi,this.Storage=new CStorage,this.helpdeskUnseenCount=ko.observable(0),this.helpdeskPendingCount=ko.observable(0),this.mailUnseenCount=ko.observable(0),this.InternetConnectionError=!1}function AppHelpDesk(){AbstractApp.call(this),window.opener&&window.frameElement&&(window.close(),window.opener.location.reload()),this.Routing=new CRouting,this.Links=new CLinkBuilder,this.currentScreen=this.Screens.currentScreen,this.currentScreen.subscribe(this.setTitle,this),this.focused=ko.observable(!0),this.focused.subscribe(this.setTitle,this),this.init(),this.initHeaderInfo()}var Consts={},Enums={},Utils={},I18n=window.pSevenI18N||{},App={},AfterLogicApi={},AppData=window.pSevenAppData||{},bExtApp=!1,bMobileApp=!1,$html=$("html"),bIsWindowsPhone=-1<navigator.userAgent.indexOf("Windows Phone"),bIsIosDevice=!bIsWindowsPhone&&(-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad")),bIsAndroidDevice=!bIsWindowsPhone&&-1<navigator.userAgent.toLowerCase().indexOf("android"),bMobileDevice=bIsWindowsPhone||bIsIosDevice||bIsAndroidDevice,aViewMimeTypes=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript","application/pdf"];if(window.Modernizr&&navigator&&window.Modernizr.addTest("pdf",function(){for(var e=navigator.mimeTypes,t=0,i=e.length;i>t;t++)if("application/pdf"===e[t].type)return!0;return!1}),Date.now||(Date.now=function(){return(new Date).getTime()}),bExtApp=!0,CBrowser.prototype.getIeVersion=function(){var e=navigator.userAgent.toLowerCase(),t=Utils.pInt(e.slice(e.indexOf("msie")+4,e.indexOf(";",e.indexOf("msie")+4)));return this.ie11&&(t=11),t},CAjax.prototype.AddActionsWithoutAuthForSendExt=function(e){e=Utils.isUnd(e)?"":e,""!==e&&-1===_.indexOf(this.aActionsWithoutAuthForSendExt,e)&&this.aActionsWithoutAuthForSendExt.push(e)},CAjax.prototype.AddActionsWithoutAuthForSend=function(e){e=Utils.isUnd(e)?"":e,""!==e&&-1===_.indexOf(this.aActionsWithoutAuthForSend,e)&&this.aActionsWithoutAuthForSend.push(e)},CAjax.prototype.hasOpenedRequests=function(e){return e=Utils.isUnd(e)?"":e,this.requests(_.filter(this.requests(),function(t){var i=t&&4===t.Xhr.readyState,s=!t||0===t.Xhr.readyState&&"abort"===t.Xhr.statusText,o=""===e||t&&t.Parameters.Action===e;return t&&!i&&!s&&o})),this.requests().length>0},CAjax.prototype.isSearchMessages=function(){var e=!1;return _.each(this.requests(),function(t){t&&t.Parameters&&"MessagesGetList"===t.Parameters.Action&&""!==t.Parameters.Search&&(e=!0)},this),e},CAjax.prototype.isAllowedActionWithoutAuth=function(e){return-1!==_.indexOf(this.aActionsWithoutAuthForSend,e)},CAjax.prototype.isAllowedExtAction=function(e){return"SocialRegister"===e||"HelpdeskRegister"===e||"HelpdeskForgot"===e||"HelpdeskLogin"===e||"SystemLogout"===e},CAjax.prototype.doSend=function(e,t,i,s){var o=_.bind(s||null,this,e,t,i),n=_.bind(this.fail,this,e,t,i),r=_.bind(this.always,this,e),a=null;AfterLogicApi.runPluginHook&&AfterLogicApi.runPluginHook("ajax-default-request",[e.Action,e]),AppData.Token&&(e.Token=AppData.Token),this.abortRequests(e),Utils.log("Ajax request send",e.Action,e),a=$.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:e,success:o,error:n,complete:r,timeout:"MessagesGetBodies"===e.Action?1e5:5e4}),this.requests().push({Parameters:e,Xhr:a})},CAjax.prototype.send=function(e,t,i){var s=void 0===e.AccountID,o=s||AppData.Accounts.hasAccountWithId(e.AccountID);e&&(AppData.Auth&&o||this.isAllowedActionWithoutAuth(e.Action))&&(s&&"Login"!==e.Action&&(e.AccountID=AppData.Accounts.currentId()),this.doSend(e,t,i,this.done))},CAjax.prototype.sendExt=function(e,t,i){var s=-1!==_.indexOf(this.aActionsWithoutAuthForSendExt,e.Action);e&&(AppData.Auth||s)&&(AppData.TenantHash&&(e.TenantHash=AppData.TenantHash),this.doSend(e,t,i,this.doneExt))},CAjax.prototype.abortRequests=function(e){switch(e.Action){case"MessageMove":case"MessageDelete":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("MessageGet");break;case"MessagesGetList":case"MessageSetSeen":case"MessageSetFlagged":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder});break;case"MessagesSetAllSeen":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("MessagesGetListByUids",{Folder:e.Folder});break;case"FolderClear":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("FoldersGetRelevantInformation");break;case"FoldersGetRelevantInformation":this.abortRequestByActionName("FoldersGetRelevantInformation");break;case"MessagesGetFlags":this.abortRequestByActionName("MessagesGetFlags");break;case"ContactList":case"ContactGlobalList":this.abortRequestByActionName("ContactList"),this.abortRequestByActionName("ContactGlobalList");break;case"ContactGet":case"ContactGlobal":this.abortRequestByActionName("ContactGet"),this.abortRequestByActionName("ContactGlobal");break;case"CalendarEventUpdate":this.abortRequestByActionName("CalendarEventUpdate",{calendarId:e.calendarId,uid:e.uid});break;case"CalendarList":this.abortRequestByActionName("CalendarList");break;case"CalendarEventList":this.abortRequestByActionName("CalendarEventList")}},CAjax.prototype.abortRequestByActionName=function(e,t){var i;_.each(this.requests(),function(s,o){if(i=!1,s&&s.Parameters.Action===e)switch(e){case"MessagesGetList":t.Folder===s.Parameters.Folder&&(i=!0);break;case"CalendarEventUpdate":t.calendarId===s.Parameters.calendarId&&t.uid===s.Parameters.uid&&(i=!0);break;default:i=!0}i&&(s.Xhr.abort(),this.requests()[o]=void 0)},this),this.requests(_.compact(this.requests()))},CAjax.prototype.abortAllRequests=function(){_.each(this.requests(),function(e){e&&e.Xhr.abort()},this),this.requests([])},CAjax.prototype.done=function(e,t,i,s,o,n){var r=this.isAllowedActionWithoutAuth(e.Action),a=AppData.Accounts.hasAccountWithId(e.AccountID),l=e.AccountID===AppData.Accounts.defaultId();if(Utils.log("Ajax request done",e.Action,o,Utils.getAjaxDataForLog(e.Action,s),e),r||a){if(s&&!s.Result)switch(s.ErrorCode){case Enums.Errors.InvalidToken:r||App.tokenProblem();break;case Enums.Errors.AuthError:l&&!r&&(this.abortAllRequests(),App.authProblem())}this.executeResponseHandler(t,i,s,e)}},CAjax.prototype.doneExt=function(e,t,i,s,o,n){this.executeResponseHandler(t,i,s,e)},CAjax.prototype.fail=function(e,t,i,s,o,n){var r={Result:!1,ErrorCode:0};switch(Utils.log("Ajax request fail",e.Action,o,e),o){case"abort":r={Result:!1,ErrorCode:Enums.Errors.NotDisplayedError};break;default:case"error":case"parseerror":r=""===n?{Result:!1,ErrorCode:Enums.Errors.NotDisplayedError}:{Result:!1,ErrorCode:Enums.Errors.DataTransferFailed}}this.executeResponseHandler(t,i,r,e)},CAjax.prototype.executeResponseHandler=function(e,t,i,s){i||(i={Result:!1,ErrorCode:0}),AfterLogicApi.runPluginHook&&AfterLogicApi.runPluginHook("ajax-default-response",[s.Action,i]),"function"!=typeof e||i.StopExecuteResponse||e.apply(t,[i,s])},CAjax.prototype.always=function(e,t,i){"abort"!==i&&(_.each(this.requests(),function(t,i){t&&_.isEqual(t.Parameters,e)&&(this.requests()[i]=void 0)},this),this.requests(_.compact(this.requests())),Utils.checkConnection(e.Action,i),App.Prefetcher&&"parsererror"!==i&&!this.hasOpenedRequests()&&App.Prefetcher.start())},Enums.Screens={Login:"login",Information:"information",Header:"header",Mailbox:"mailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files",Helpdesk:"helpdesk",SingleHelpdesk:"single-helpdesk"},Enums.CalendarDefaultTab={Day:1,Week:2,Month:3},Enums.TimeFormat={F24:"0",F12:"1"},Enums.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,DemoLimitations:106,Captcha:107,AccessDenied:108,CanNotGetMessage:202,ImapQuota:205,NotSavedInSentItems:304,NoRequestedMailbox:305,CanNotChangePassword:502,AccountOldPasswordNotCorrect:503,FetcherIncServerNotAvailable:702,FetcherLoginNotCorrect:703,HelpdeskThrowInWebmail:805,HelpdeskUserNotExists:807,HelpdeskUserNotActivated:808,IncorrectFileExtension:811,MailServerError:901,DataTransferFailed:1100,NotDisplayedError:1155},Enums.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,System:9,User:10},Enums.FolderFilter={Flagged:"flagged",Unseen:"unseen"},Enums.LoginFormType={Email:0,Login:3,Both:4},Enums.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2},Enums.ReplyType={Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward"},Enums.Importance={Low:5,Normal:3,High:1},Enums.Sensitivity={Nothing:0,Confidential:1,Private:2,Personal:3},Enums.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"},Enums.ContactPhoneType={Mobile:"Mobile",Personal:"Personal",Business:"Business"},Enums.ContactAddressType={Personal:"Personal",Business:"Business"},Enums.ContactSortType={Email:"Email",Name:"Name",Frequency:"Frequency"},Enums.SaveMail={Hidden:0,Checked:1,Unchecked:2},Enums.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobile_sync",OutLookSync:"outlook_sync",Helpdesk:"helpdesk",Pgp:"pgp",Services:"services",CloudStorage:"cloud-storage"},Enums.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders",FetcherInc:"fetcher-inc",FetcherOut:"fetcher-out",FetcherSig:"fetcher-sig",IdentityProperties:"identity-properties",IdentitySignature:"identity-signature"},Enums.AccountCreationPopupType={OneStep:1,TwoSteps:2,ConnectToMail:3},Enums.ContactsGroupListType={Personal:0,SubGroup:1,Global:2,SharedToAll:3,All:4},Enums.IcalType={Request:"REQUEST",Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"},Enums.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"},Enums.IcalConfigInt={Accepted:1,Declined:2,Tentative:3,NeedsAction:0},Enums.Key={Tab:9,Enter:13,Shift:16,Ctrl:17,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Left:37,Right:39,Del:46,Six:54,a:65,b:66,c:67,f:70,i:73,k:75,n:78,p:80,q:81,r:82,s:83,u:85,v:86,y:89,z:90,F5:116,Comma:188,Dot:190,Dash:192,Apostrophe:222},Enums.MouseKey={Left:0,Middle:1,Right:2},Enums.FileStorageType={Personal:"personal",Corporate:"corporate",Shared:"shared",GoogleDrive:"google",Dropbox:"dropbox"},Enums.FileStorageLinkType={Unknown:0,GoogleDrive:1,Dropbox:2,YouTube:3,Vimeo:4,SoundCloud:5},Enums.HelpdeskThreadStates={None:0,Pending:1,Waiting:2,Answered:3,Resolved:4,Deferred:5},Enums.HelpdeskPostType={Normal:0,Internal:1,System:2},Enums.HelpdeskFilters={All:0,Pending:1,Resolved:2,InWork:3,Open:4,Archived:9},Enums.CalendarAccess={Full:0,Write:1,Read:2},Enums.CalendarEditRecurrenceEvent={None:0,OnlyThisInstance:1,AllEvents:2},Enums.CalendarRepeatPeriod={None:0,Daily:1,Weekly:2,Monthly:3,Yearly:4},Enums.CalendarAlways={Disable:0,Enable:1},Enums.PhoneAction={Offline:"offline",OfflineError:"offline_error",OfflineInit:"offline_init",OfflineActive:"offline_active",Online:"online",OnlineActive:"online_active",Incoming:"incoming",IncomingConnect:"incoming_connect",Outgoing:"outgoing",OutgoingConnect:"outgoing_connect",Settings:"settings"},Enums.HtmlEditorImageSizes={Small:"small",Medium:"medium",Large:"large",Original:"original"},Enums.MobilePanel={Groups:1,Items:2,View:3},Enums.PgpAction={Import:"import",Generate:"generate",Encrypt:"encrypt",Sign:"sign",EncryptSign:"encrypt-sign",Verify:"ferify",DecryptVerify:"decrypt-ferify"},Enums.SocialType={Unknown:0,Google:1,Dropbox:2,Facebook:3,Twitter:4,Vkontakte:5},Enums.notificationPermission={Granted:"granted",Denied:"denied",Default:"default"},Enums.AnotherMessageComposedAnswer={Discard:"Discard",SaveAsDraft:"SaveAsDraft",Cancel:"Cancel"},ko.bindingHandlers.command={init:function(e,t,i,s){var o=$(e),n=t();if(!n||!n.enabled||!n.canExecute)throw new Error("You are not using command function");o.addClass("command"),ko.bindingHandlers[o.is("form")?"submit":"click"].init.apply(s,arguments)},update:function(e,t){var i=!0,s=$(e),o=t();i=o.enabled(),s.toggleClass("command-not-enabled",!i),i&&(i=o.canExecute(),s.toggleClass("unavailable",!i)),s.toggleClass("command-disabled disable disabled",!i),s.toggleClass("command-disabled",!i)}},ko.bindingHandlers.simpleTemplate={init:function(e,t){var i=$(e);i.length>0&&"replaced"!==i.data("replaced")&&(i.html(i.html().replace(/&lt;script(.*?)&gt;/i,"<script$1>").replace(/&lt;\/script(.*?)&gt;/i,"</script>")),i.data("replaced","replaced"))}},ko.bindingHandlers.findFocused={init:function(e){var t=$(e),i=null;i=t.find(".catch-focus"),i&&1===i.length&&i[0]&&i.on("blur",function(){t.removeClass("focused")}).on("focus",function(){t.addClass("focused")})}},ko.bindingHandlers.findFilled={init:function(e){var t=$(e),i=null,s=null;i=t.find(".catch-filled"),i&&1===i.length&&i[0]&&(s=function(){t.toggleClass("filled",""!==i.val())},s(),_.delay(s,200),i.on("change",s))}},ko.bindingHandlers.alert={init:function(e,t){window.alert(ko.utils.unwrapObservable(t()))},update:function(e,t){window.alert(ko.utils.unwrapObservable(t()))}},ko.bindingHandlers.onEnter={init:function(e,t,i,s){ko.bindingHandlers.event.init(e,function(){return{keyup:function(i,s){s&&13===window.parseInt(s.keyCode,10)&&($(e).trigger("change"),t().call(this,i))}}},i,s)}},ko.bindingHandlers.onCtrlEnter={init:bMobileApp?null:function(e,t,i,s){ko.bindingHandlers.event.init(e,function(){return{keydown:function(i,s){return s&&13===window.parseInt(s.keyCode,10)&&s.ctrlKey?($(e).trigger("change"),t().call(this,i),!1):!0}}},i,s)}},ko.bindingHandlers.onEsc={init:bMobileApp?null:function(e,t,i,s){ko.bindingHandlers.event.init(e,function(){return{keyup:function(i,s){s&&27===window.parseInt(s.keyCode,10)&&($(e).trigger("change"),t().call(this,i))}}},i,s)}},ko.bindingHandlers.onFocusSelect={init:function(e,t,i,s){ko.bindingHandlers.event.init(e,function(){return{focus:function(){e.select()}}},i,s)}},ko.bindingHandlers.onEnterChange={init:function(e,t,i,s){ko.bindingHandlers.event.init(e,function(){return{keyup:function(t,i){i&&13===window.parseInt(i.keyCode,10)&&$(e).trigger("change")}}},i,s)}},ko.bindingHandlers.fadeIn={update:function(e,t){ko.utils.unwrapObservable(t())&&$(e).hide().fadeIn("fast")}},ko.bindingHandlers.fadeOut={update:function(e,t){ko.utils.unwrapObservable(t())&&$(e).fadeOut()}},ko.bindingHandlers.csstext={init:function(e,t){e&&e.styleSheet&&!Utils.isUnd(e.styleSheet.cssText)?e.styleSheet.cssText=ko.utils.unwrapObservable(t()):$(e).text(ko.utils.unwrapObservable(t()))},update:function(e,t){e&&e.styleSheet&&!Utils.isUnd(e.styleSheet.cssText)?e.styleSheet.cssText=ko.utils.unwrapObservable(t()):$(e).text(ko.utils.unwrapObservable(t()))}},ko.bindingHandlers.i18n={init:function(e,t){var i=$(e).data("i18n"),s=i?Utils.i18n(i):i;if(""!==s)switch(t()){case"value":$(e).val(s);break;case"text":$(e).text(s);break;case"html":$(e).html(s);break;case"title":$(e).attr("title",s);break;case"placeholder":$(e).attr({placeholder:s})}}},ko.bindingHandlers.link={init:function(e,t){$(e).attr("href",ko.utils.unwrapObservable(t()))}},ko.bindingHandlers.title={init:function(e,t){$(e).attr("title",ko.utils.unwrapObservable(t()))},update:function(e,t){$(e).attr("title",ko.utils.unwrapObservable(t()))}},ko.bindingHandlers.initDom={init:function(e,t){if(t())if(_.isArray(t()))for(var i=t(),s=i.length-1;s>=0;s--)i[s]($(e));else t()($(e))}},ko.bindingHandlers.customScrollbar={init:bMobileApp?null:function(e,t,i,s){if(!bMobileDevice){var o=$(e),n=_.defaults(t(),{oScroll:null,scrollToTopTrigger:null,scrollToBottomTrigger:null,scrollTo:null}),r=null;n=n,o.addClass("scroll-wrap").customscroll(n),r=o.data("customscroll"),n.oScroll&&Utils.isFunc(n.oScroll.subscribe)?n.oScroll(r):n.oScroll=r,Utils.isUnd(n.reset)||(e._customscroll_reset=_.throttle(function(){r.reset()},100)),n.scrollToTopTrigger&&Utils.isFunc(n.scrollToTopTrigger.subscribe)&&n.scrollToTopTrigger.subscribe(function(){r&&r.scrollToTop()}),n.scrollToBottomTrigger&&Utils.isFunc(n.scrollToBottomTrigger.subscribe)&&n.scrollToBottomTrigger.subscribe(function(){r&&r.scrollToBottom()}),n.scrollTo&&Utils.isFunc(n.scrollTo.subscribe)&&n.scrollTo.subscribe(function(){r&&r.scrollTo(n.scrollTo())})}},update:bMobileApp?null:function(e,t,i,s,o){bMobileDevice||(e._customscroll_reset&&e._customscroll_reset(),Utils.isUnd(t().top)||$(e).data("customscroll").vertical.set(t().top))}},ko.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,i,s,o){for(var n=0,r=0,a=ko.utils.arrayMap(ko.utils.arrayFilter(e.childNodes,function(e){return e.tagName&&"OPTION"===e.tagName&&e.selected}),function(e){return ko.selectExtensions.readValue(e)||e.innerText||e.textContent}),l=e.scrollTop,p=ko.utils.unwrapObservable(t());e.length>0;)ko.cleanNode(e.options[0]),e.remove(0);if(p){"number"!=typeof p.length&&(p=[p]);var h=i().optionsBind;for(n=0,r=p.length;r>n;n++){var c=document.createElement("OPTION"),u=ko.utils.unwrapObservable(p[n]);ko.selectExtensions.writeValue(c,u),c.appendChild(document.createTextNode(u)),e.appendChild(c),h&&(c.setAttribute("data-bind",h),ko.applyBindings(o.createChildContext(u),c))}var d=e.getElementsByTagName("OPTION"),m=0,g=navigator.userAgent.indexOf("MSIE 6")>=0;for(n=0,r=d.length;r>n;n++)ko.utils.arrayIndexOf(a,ko.selectExtensions.readValue(d[n]))>=0&&(g?d[n].setAttribute("selected",!0):d[n].selected=!0,m++);e.scrollTop=l,m<a.length&&ko.utils.triggerEvent(e,"change")}}},ko.bindingHandlers.splitter={init:bMobileApp?null:function(e,t){setTimeout(function(){$(e).splitter(t())},1)}},ko.bindingHandlers.dropdown={update:function(e,t,i,s){var o,n,r,a=$(e),l=_.defaults(t(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",scrollToTopContainer:".scroll-inner",passClick:!0,trueValue:!0}),p="function"==typeof l.control?l.control():l.control,h=a.find(".control"),c=a.find(".dropdown"),u=a.find(".dropdown_helper"),d=a.find(".dropdown_arrow"),m=a.find(".dropdown_arrow.bottom"),g=$(document),f=!1,b=function(){Utils.isUnd(l.callback)||l.callback.call(s,a.hasClass(l.expand)?l.trueValue:!1,a)},y=function(e){e.stopPropagation()},A=function(){l.scrollToTopContainer&&a.find(l.scrollToTopContainer).scrollTop(0)},E=function(e){Utils.isUnd(e)&&(e=!a.hasClass(l.expand)),!e&&a.hasClass(l.expand)&&A(),a.toggleClass(l.expand,e),m.length>0&&a.hasClass(l.expand)&&c.css({top:a.position().top-u.height()+"px",left:a.position().left+"px",width:"auto"})},C=function(e){o=u.offset(),Utils.isUnd(o)||(n=o.left+10,r=$(window).width()-(n+u.outerWidth(!0)),r>0&&(r=0),u.css("left",e||r+"px"),d.css("left",e||Math.abs(r?r+parseInt(d.css("margin-left")):0)+"px"))},k=function(e){var t=$(e.originalEvent.originalTarget).parents(".dropdown"),i=t.length>0;i||a.hasClass(l.disabled)||f||(E(),_.defer(function(){b()}),a.hasClass(l.expand)&&(l.close&&l.close.subscribe&&l.close(!0),_.defer(function(){g.on("click.dropdown",function(e){!l.passClick&&e.button===Enums.MouseKey.Right||f||(g.unbind("click.dropdown"),l.close&&l.close.subscribe&&l.close(!1),E(!1),b(),C(0)),f=!1})}),C()))};a.off(),h.off(),l.passClick||(a.find(l.container).on("click",y),a.on("click",y),h.on("click",y)),E(!1),l.close&&l.close.subscribe&&l.close.subscribe(function(e){e||(g.unbind("click.dropdown"),E(!1)),b()}),a.on("mousedown",function(e,t){f=$(e.target).hasClass("customscroll-scrollbar")||$(e.target.parentElement).hasClass("customscroll-scrollbar")}),a.on("click",function(e){p||k(e)}),h.on("click",function(e){p&&k(e)})}},ko.bindingHandlers.customSelect={init:function(e,t,i,s){var o=$(e),n=_.defaults(t(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,input:!1,expandState:function(){}}),r=[],a=n.control?o.find(".control"):o,l=o.find(".dropdown_content"),p=o.find(".link"),h=function(e){_.each(r,function(e){e.removeClass(n.selected)});var t=_.find(n.options,function(t){return t[n.optionsValue]===e});return Utils.isUnd(t)?t=n.options[0]:(r[_.indexOf(n.options,t)].addClass(n.selected),p.text($.trim(t[n.optionsText]))),t[n.optionsValue]},c=function(e){l.empty(),r=[],_.each(e?e:n.options,function(e){var t=$('<span class="item"></span>').text(e[n.optionsText]).data("value",e[n.optionsValue]),i=e.isDisabled;i?t.data("isDisabled",i).addClass("disabled"):t.data("isDisabled",i).removeClass("disabled"),r.push(t),l.append(t)},this)};c(),l.on("click",".item",function(){var e=$(this);e.data("isDisabled")||n.value(e.data("value"))}),!n.input&&n.value&&n.value.subscribe&&(n.value.subscribe(function(){var e=h(n.value());n.value()!==e&&n.value(e)},s),n.value.valueHasMutated()),n.input&&n.value&&n.value.subscribe&&(n.value.subscribe(function(){h(n.value())},s),n.value.valueHasMutated()),n.input&&n.value&&n.value.subscribe&&(n.value.subscribe(function(){h(n.value())},s),n.value.valueHasMutated()),n.alarmOptions&&n.alarmOptions.subscribe(function(){c()},s),n.timeOptions&&n.timeOptions.subscribe(function(e){c(e)},s),o.removeClass(n.expand),a.click(function(e){if(!o.hasClass(n.disabled)&&(o.toggleClass(n.expand),n.expandState(o.hasClass(n.expand)),o.hasClass(n.expand))){var t=o.find(".dropdown_content"),i=t.find(".selected");i.position()&&(t.scrollTop(0),t.scrollTop(i.position().top-100)),_.defer(function(){$(document).one("click",function(){o.removeClass(n.expand),n.expandState(!1)})})}})}},ko.bindingHandlers.moveToFolderFilter={init:function(e,t,i,s,o){var n=$(e),r=t(),a=$(e).find(r.container),l=_.isArray(r.options)?r.options:r.options(),p=r.value?r.value():"",h=_.find(l,function(e){return e[r.optionsValue]===p});h||(p="",r.value("")),n.removeClass("expand"),a.empty(),_.each(l,function(e){var t=$('<span class="item"></span>').text(e[r.optionsText]).data("value",e[r.optionsValue]);p===e[r.optionsValue]&&t.addClass("selected"),e.jq=t,a.append(t)}),a.on("click",".item",function(){var e=$(this).data("value");r.value(e)}),n.click(function(){n.toggleClass("expand"),n.hasClass("expand")&&_.defer(function(){$(document).one("click",function(){n.removeClass("expand")})})})},update:function(e,t){var i=$(e),s=t(),o=_.isArray(s.options)?s.options:s.options(),n=s.value?s.value():"",r=_.find(o,function(e){return e[s.optionsValue]===n}),a=i.find(".link");_.each(o,function(e){e.jq&&e.jq.toggleClass("selected",n===e[s.optionsValue])}),r&&a.text($.trim(r[s.optionsText]))}},ko.bindingHandlers.contactCardInMessage={update:bMobileApp||bMobileDevice?null:function(e,t,i,s){var o=$(e),n=t(),r=n.address,a=$("div.item_viewer[data-email='"+r+"']"),l=!1,p=0,h=function(){a&&o&&(l=!0,clearTimeout(p),setTimeout(function(){var e,t,i,s=o.offset();l&&s.left+s.top!==0&&(e=s.left+10,t=s.top+o.height()+6,i=$(window).width()-(e+396),i>0&&(i=0),a.addClass("expand").offset({top:t,left:e+i}))},180))},c=function(){l&&a&&o&&(l=!1,p=setTimeout(function(){l||a.removeClass("expand")},200))};a.length>0?(o.off().on("mouseover",function(){a.off().on("mouseenter",h).on("mouseleave",c).find(".link, .button").off(".links").on("click.links",function(){l=!1,a.removeClass("expand")}),setTimeout(function(){a.find(".link, .button").off("click.links").on("click.links",function(){l=!1,a.removeClass("expand")})}.bind(this),100),h()}).on("mouseout",c),l=!1,a.removeClass("expand")):o.off()}},ko.bindingHandlers.contactcard={init:bMobileApp||bMobileDevice?null:function(e,t,i,s){var o=$(e),n=!1,r=_.defaults(t(),{disabled:"disabled",expand:"expand",control:!0}),a=r.control?o.find(".control"):o;void 0!==r.trigger&&void 0!==r.trigger.subscribe&&(o.removeClass(r.expand),a.bind({mouseover:function(){!o.hasClass(r.disabled)&&r.trigger()&&(n=!0,_.delay(function(){n&&(void 0!==r.controlWidth&&void 0!==r.controlWidth.subscribe&&r.controlWidth(a.width()),o.addClass(r.expand))},200))},mouseout:function(){r.trigger()&&(n=!1,_.delay(function(){n||o.removeClass(r.expand)},200))}}))}},ko.bindingHandlers.checkmail={update:function(e,t,i,s,o){var n=e.oOptions||null,r=e.jqElement||null,a=e.oIconIE||null,l=t(),p=l.state;void 0!==l.state&&(r||(e.jqElement=r=$(e)),n||(e.oOptions=n=_.defaults(l,{activeClass:"process",duration:800})),Utils.deferredUpdate(r,p,n.duration,function(t,i){if(App.browser.ie9AndBelow)if(a||(e.oIconIE=a=r.find(".icon")),!a.__intervalIE&&i){var s=0,o="";a.__intervalIE=setInterval(function(){o="0px -"+20*s+"px",s=7>s?s+1:0,a.css({"background-position":o})},1e3/12)}else a.css({"background-position":"0px 0px"}),clearInterval(a.__intervalIE),a.__intervalIE=null;else t.toggleClass(n.activeClass,i)}))}},ko.bindingHandlers.heightAdjust={update:function(e,t,i){var s=e.jqElement||null,o=0,n=t().location,r=t().delay||400;s||(e.jqElement=s=$(e)),_.delay(function(){_.each(t().elements,function(e){var t=e();t&&(o+=t.is(":visible")?t.outerHeight():0)}),"top"===n||void 0===n?s.css({"padding-top":o,"margin-top":-o}):"bottom"===n&&s.css({"padding-bottom":o,"margin-bottom":-o})},r)}},ko.bindingHandlers.minHeightAdjust={update:function(e,t,i){var s=$(e),o=t(),n=o.adjustElement||$("body"),r=o.minHeight||0;o.removeTrigger&&n.css("min-height","inherit"),o.trigger&&_.delay(function(){n.css({"min-height":s.outerHeight(!0)+r})},100)}},ko.bindingHandlers.watchWidth={init:function(e,t){var i=!1;i||t().subscribe(function(){t()($(e).outerWidth()),i=!0},this)}},ko.bindingHandlers.columnCalc={init:function(e,t){var i=$(e),s=t().prop,o=null,n=0;o=i.find(t().itemSelector),void 0!==o[0]&&(n=o.outerWidth(!0),n=1>=n?1:n,s&&$(window).bind("resize",function(){var e=i.width();s(e>0?Math.floor(e/n):1)}))}},ko.bindingHandlers.listWithMoreButton={init:function(e,t){var i=$(e),s=!1;i.closest("div.panel.left_panel").resize(function(){var e=i.find("span.hotkey"),t=i.find("span.item"),o=i.find("span.more_hints").show(),n=i.width(),r=o.width(),a=!0;s?s=!1:(_.each(e,function(e,i){var o=$(e),l=o.width();a&&n>r+l?(s=!1,o.show(),$(t[i]).hide(),r+=l):(s=!0,a=!1,
o.hide(),$(t[i]).show())}),a&&o.hide())})}},ko.bindingHandlers.quickReplyAnim={update:bMobileApp?null:function(e,t,i,s,o){var n=e.jqTextarea||null,r=e.jqStatus||null,a=e.jqButtons||null,l=e.jqElement||null,p=e.oPrevActions||null,h=t(),c=null;c=_.defaults(h,{saveAction:!1,sendAction:!1,activeAction:!1}),l||(e.jqElement=l=$(e),e.jqTextarea=n=l.find("textarea"),e.jqStatus=r=l.find(".status"),e.jqButtons=a=l.find(".buttons"),e.oPrevActions=p={saveAction:null,sendAction:null,activeAction:null}),App.browser.ie9AndBelow?(!n||l.defualtHeight||n.defualtHeight||(l.defualtHeight=l.outerHeight(),n.defualtHeight=n.outerHeight(),r.defualtHeight=a.outerHeight(),a.defualtHeight=a.outerHeight()),_.defer(function(){var e=p.activeAction!==c.activeAction,t=p.sendAction!==c.sendAction,i=p.saveAction!==c.saveAction;e&&(c.activeAction?(n.animate({height:n.defualtHeight+50},300),l.animate({"max-height":l.defualtHeight+a.defualtHeight+50},300)):(n.animate({height:n.defualtHeight},300),l.animate({"max-height":l.defualtHeight},300))),(t||i)&&(c.sendAction?(l.animate({"max-height":"30px"},300),r.animate({"max-height":"30px",opacity:1},300)):c.saveAction?l.animate({"max-height":0},300):(l.animate({"max-height":l.defualtHeight+a.defualtHeight+50},300),r.animate({"max-height":0,opacity:0},300)))})):(l.toggleClass("saving",c.saveAction),l.toggleClass("sending",c.sendAction),l.toggleClass("active",c.activeAction)),_.defer(function(){p=c})}},ko.extenders.reversible=function(e){var t=e();return e.commit=function(){t=e()},e.revert=function(){e(t)},e.commitedValue=function(){return t},e.changed=function(){return t!==e()},e},ko.extenders.autoResetToFalse=function(e,t){return e.iTimeout=0,e.subscribe(function(i){i&&(window.clearTimeout(e.iTimeout),e.iTimeout=window.setTimeout(function(){e.iTimeout=0,e(!1)},Utils.pInt(t)))}),e},Utils.createCommand=function(e,t,i){var s=t?function(){return s.canExecute&&s.canExecute()?t.apply(e,Array.prototype.slice.call(arguments)):!1}:function(){};return s.enabled=ko.observable(!0),i=Utils.isUnd(i)?!0:i,s.canExecute=ko.computed(Utils.isFunc(i)?function(){return s.enabled()&&i.call(e)}:function(){return s.enabled()&&!!i}),s},ko.bindingHandlers.autocomplete={init:function(e,t){function i(e){return e.split(/,\s*/)}function s(e){return i(e).pop()}var o=t(),n=$(e);o&&n&&n[0]&&n.autocomplete({minLength:0,autoFocus:!0,source:function(e,t){o(s(e.term),t)},search:function(){return s(this.value).length>0},focus:function(){return!1},select:function(e,t){var s=i(this.value),o=null;return s.pop(),s.push(t.item.value),s.push(""),this.value=s.join(", ").slice(0,-2),n.trigger("change"),o=function(e){var t=e.value.length;e.blur(),e.focus(),e.setSelectionRange&&e.setSelectionRange(t,t)},o(n[0]),!1}}).on("click",function(){""===n.val()&&($(n.autocomplete("widget")).is(":visible")?n.autocomplete("close"):(n.autocomplete("option","minLength",0),n.autocomplete("search"),n.autocomplete("option","minLength",1)))})}},ko.bindingHandlers.autocompleteSimple={init:function(e,t,i,s,o){var n=$(e),r=t(),a=r.callback,l=r.dataAccessor?r.dataAccessor:Utils.emptyFunction(),p=r.deleteAccessor?r.deleteAccessor:Utils.emptyFunction(),h=Utils.emptyFunction(),c=function(){p(d),$.ui.autocomplete.prototype.__response.call(n.data("autocomplete"),_.filter(u,function(e){return e.value!==d.value}))},u=null,d=null;a&&n&&n[0]&&n.autocomplete({minLength:1,autoFocus:!0,position:{collision:"flip"},source:function(e,t){h=t,a(e.term,function(e){u=e,h(e)})},focus:function(e,t){d=t.item},open:function(e,t){$(n.autocomplete("widget")).find("span.del").on("click",function(e,t){Utils.calmEvent(e),c()})},select:function(e,t){return _.delay(function(){n.trigger("change")},5),l(t.item),!0}}).on("click",function(e,t){""===n.val()&&($(n.autocomplete("widget")).is(":visible")?n.autocomplete("close"):(n.autocomplete("option","minLength",0),n.autocomplete("search"),n.autocomplete("option","minLength",1)))}).on("keydown",function(e,t){u&&d&&!d.global&&e.keyCode===Enums.Key.Del&&e.shiftKey&&(Utils.calmEvent(e),c())})}},ko.bindingHandlers.draggablePlace={init:bMobileApp?null:function(e,t,i,s,o){if(null===t())return null;var n=i?i():null;$(e).draggable({distance:20,handle:".dragHandle",cursorAt:{top:0,left:0},helper:function(e){return t().apply(s,e&&e.target?[ko.dataFor(e.target),e.ctrlKey]:null)},start:n&&n.draggableDragStartCallback?n.draggableDragStartCallback:Utils.emptyFunction,stop:n&&n.draggableDragStopCallback?n.draggableDragStopCallback:Utils.emptyFunction}).on("mousedown",function(){Utils.removeActiveFocus()})}},ko.bindingHandlers.droppable={init:bMobileApp?null:function(e,t){var i=t(),s=i.valueFunc,o=i.switchObserv;!1!==s&&$(e).droppable({hoverClass:"droppableHover",drop:function(e,t){s(e,t)}}),o&&s!==!1&&(o.subscribe(function(t){$(e).data().droppable&&$(e).droppable(t?"disable":"enable")},this),o.valueHasMutated())}},ko.bindingHandlers.draggable={init:bMobileApp?null:function(e,t){$(e).attr("draggable",ko.utils.unwrapObservable(t()))}},ko.bindingHandlers.autosize={init:function(e,t,i,s,o){var n=$(e),r=t(),a=n.height(),l=n.outerHeight(),p=n.innerHeight(),h=l-p,c=p-a,u=r.minHeight?r.minHeight:0,d=r.maxHeight?r.maxHeight:0,m=r.scrollableHeight?r.scrollableHeight:1e3,g=r.autosizeTrigger?r.autosizeTrigger:null,f=function(e){var t=0;App.browser.firefox&&(t=2*parseInt(n.css("padding-top"),10)),d?setTimeout(function(){n.prop("scrollHeight")<d?(n.height(u-c-h),n.height(n.prop("scrollHeight")+t-c)):n.height(d-c-h)},100):(e||n.prop("scrollHeight")<m)&&setTimeout(function(){n.height(u-c-h),n.height(n.prop("scrollHeight")+t-c)},100)};n.on("keydown",function(e,t){f()}),n.on("paste",function(e,t){f()}),g&&g.subscribe(function(e){f(e)},this),f()}},ko.bindingHandlers.customBind={init:function(e,t,i,s,o){var n=t(),r=n.onKeydown?n.onKeydown:null,a=n.onKeyup?n.onKeyup:null,l=n.onPaste?n.onPaste:null,p=n.onInput?n.onInput:null,h=n.valueObserver?n.valueObserver:null;ko.bindingHandlers.event.init(e,function(){return{keydown:function(t,i){return r&&r.call(this,e,i,h),!0},keyup:function(t,i){return a&&a.call(this,e,i,h),!0},paste:function(t,i){return l&&l.call(this,e,i,h),!0},input:function(t,i){return p&&p.call(this,e,i,h),!0}}},i,s)}},ko.bindingHandlers.fade={init:function(e,t,i,s,o){var n=$(e),r=$('<span class="faded"></span>'),a=_.defaults(t(),{color:null,css:"fadeout"}),l=a.color,p=a.css,h=function(e){if(""!==e){var t=c(e),i="rgba("+t.r+","+t.g+","+t.b;u(e,i)}},c=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e=e.replace(t,function(e,t,i,s){return t+t+i+i+s+s}),i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},u=function(e,t){Utils.isRTL()?r.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+e+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+t+",1)), color-stop(100%,"+t+",0)))").css("background-image","-moz-linear-gradient(left, "+t+",1)0%, "+t+",0)100%)").css("background-image","-webkit-linear-gradient(left, "+t+"1)0%,"+t+",0)100%)").css("background-image","-o-linear-gradient(left, "+t+",1)0%,"+t+",0)100%)").css("background-image","-ms-linear-gradient(left, "+t+",1)0%,"+t+",0)100%)").css("background-image","linear-gradient(left, "+t+",1)0%,"+t+",0)100%)"):r.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+e+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+t+",0)), color-stop(100%,"+t+",1)))").css("background-image","-moz-linear-gradient(left, "+t+",0)0%, "+t+",1)100%)").css("background-image","-webkit-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","-o-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","-ms-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","linear-gradient(left, "+t+",0)0%,"+t+",1)100%)")};n.parent().addClass(p),n.after(r),void 0!==a.color.subscribe&&(h(l()),l.subscribe(function(e){h(e)},this))}},ko.bindingHandlers.highlighter={init:function(e,t,i,s,o){function n(e){if(A){var t=0,i=l.text(),s=i.split(m),o=[],n='<span class="search_highlight">$&</span>';$.each(s,function(e,t){_.any(d,function(e){return e===t})?$.each(t,function(e,t){o.push($(t.replace(/(.)/,n)))}):$.each(t,function(e,t){o.push(" "===t?document.createTextNode(""):document.createTextNode(t))})}),e?l.empty().append(o):(t=r(),l.empty().append(o),a(t))}}function r(){var t,i,s,o,n=0;return"undefined"!=typeof window.getSelection?(t=window.getSelection().getRangeAt(0),i=t.cloneRange(),i.selectNodeContents(e),i.setEnd(t.endContainer,t.endOffset),n=i.toString().length):"undefined"!=typeof document.selection&&"Control"!==document.selection.type&&(s=document.selection.createRange(),o=document.body.createTextRange(),o.moveToElementText(e),o.setEndPoint("EndToEnd",s),n=o.text.length),n}function a(t){var i,s,o;if(!e)return!1;if(document.createRange)i=document.createRange(),i.selectNodeContents(e),i.setStart(e,t),i.setEnd(e,t),s=window.getSelection(),s.removeAllRanges(),s.addRange(i);else{if(e.createTextRange)return o=e.createTextRange(),o.collapse(!0),o.moveEnd(t),o.moveStart(t),o.select(),!0;if(e.setSelectionRange)return e.setSelectionRange(t,t),!0}return!1}var l=$(e),p=t(),h=p.valueObserver?p.valueObserver:null,c=p.highlighterValueObserver?p.highlighterValueObserver:null,u=p.highlightTrigger?p.highlightTrigger:null,d=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],m=function(){var e="";return $.each(d,function(t,i){e=t?e+"|\\b"+i:e+"\\b"+i}),new RegExp("("+e+")","g")}(),g=function(e){return e.replace(/\xC2\xA0/g," ").replace(/\xA0/g," ").replace(/[\s]+/g," ")},f=-1,b=window.navigator.language||window.navigator.userLanguage,y=["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],A=!_.include(y,b);ko.bindingHandlers.event.init(e,function(){return{keydown:function(e,t){return t.keyCode!==Enums.Key.Enter},keyup:function(e,t){var i=[Enums.Key.Left,Enums.Key.Right,Enums.Key.Home,Enums.Key.End],s=-1!==Utils.inArray(t.keyCode,i);return t.keyCode===Enums.Key.Shift||t.keyCode===Enums.Key.Ctrl||t.keyCode===Enums.Key.Dash||t.keyCode===Enums.Key.Apostrophe||t.keyCode===Enums.Key.Six&&t.shiftKey||s||(t.ctrlKey||f===Enums.Key.Ctrl)&&t.keyCode===Enums.Key.a||(h(g(l.text())),n(!1)),f=t.keyCode,!0},paste:function(e,t){return setTimeout(function(){h(g(l.text())),n(!1)},0),!0}}},i,s),setTimeout(function(){n(!0)},0),u.notifySubscribers(),u.subscribe(function(e){setTimeout(function(){n(!!e)},0)},this),c.subscribe(function(){l.text(h())},this)}},ko.bindingHandlers.quoteText={init:function(e,t,i,s,o){var n=($(e),$('<span class="button_quote">'+Utils.i18n("HELPDESK/BUTTON_QUOTE")+"</span>")),r=t(),a=r.actionHandler,l=!1,p=null,h="";$("#pSevenContent").append(n),$(document.body).on("click",function(e){l=!!$(e.target).parents(".posts")[0],document.getSelection?(p=document.getSelection(),p&&(h=p.toString())):h=document.selection.createRange().text,l&&""!==h.replace(/[\n\r\s]/,"")?n.css({top:e.clientY+20,left:e.clientX+20}).show():n.hide()}),n.on("click",function(e){a.call(s,h)})}},ko.bindingHandlers.adjustHeightToContent={init:function(e,t,i,s,o){var n=$(e),r=null,a=null,l=null;_.delay(_.bind(function(){r=$(_.max(n.find(".title .text"),function(e){return e.offsetWidth})),a=r.parent(),l=a.find(".icon"),n.css("min-width",parseInt(a.css("margin-left"))+parseInt(a.css("padding-left"))+parseInt(l.width())+parseInt(l.css("margin-left"))+parseInt(l.css("margin-right"))+parseInt(l.css("padding-left"))+parseInt(l.css("padding-right"))+parseInt(r.width())+parseInt(r.css("margin-left"))+parseInt(r.css("padding-left"))+10)},this),1)}},ko.bindingHandlers.customTooltip={init:bMobileDevice||bMobileApp?null:function(e,t){var i=Utils.i18n(t()),s=$(e),o=s.find("span.dropdown"),n=!1,r=function(){var e=$(this);e.hasClass("expand")||(clearTimeout(Utils.CustomTooltip.iHideTimer),n=!0,clearTimeout(Utils.CustomTooltip.iTimer),Utils.CustomTooltip.iTimer=setTimeout(function(){n&&(e.hasClass("expand")?(n=!1,clearTimeout(Utils.CustomTooltip.iTimer),Utils.CustomTooltip.hide()):Utils.CustomTooltip.show(i,e))},100))},a=function(){clearTimeout(Utils.CustomTooltip.iHideTimer),Utils.CustomTooltip.iHideTimer=setTimeout(function(){n=!1,clearTimeout(Utils.CustomTooltip.iTimer),Utils.CustomTooltip.hide()},10)},l=function(){},p=function(){s.unbind("mouseover",r),s.unbind("mouseout",a),s.unbind("click",a),o.unbind("mouseover",a),o.unbind("mouseout",l),""!==i&&(s.bind("mouseover",r),s.bind("mouseout",a),s.bind("click",a),o.bind("mouseover",a),o.bind("mouseout",l))},h=null;"function"==typeof i&&(i=i()),p(),"function"==typeof t().subscribe&&null===h&&(h=t().subscribe(function(e){i=e,p()}))}},ko.bindingHandlers.foreachprop={transformObject:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push({key:i,value:e[i]});return t},init:function(e,t,i,s,o){var n=ko.utils.unwrapObservable(t()),r=ko.bindingHandlers.foreachprop.transformObject(n);return ko.applyBindingsToNode(e,{foreach:r},o),{controlsDescendantBindings:!0}}},CRouting.prototype.init=function(e){this.defaultScreen=e,hasher.initialized.removeAll(),hasher.changed.removeAll(),hasher.initialized.add(this.parseRouting,this),hasher.changed.add(this.parseRouting,this),hasher.init(),hasher.initialized.removeAll()},CRouting.prototype.finalize=function(){hasher.dispose()},CRouting.prototype.setHashFromString=function(e){var t=location.hash===decodeURIComponent(e);return t||(location.hash=e),t},CRouting.prototype.replaceHashWithoutMessageUid=function(e){if("string"==typeof e&&""!==e){var t=location.hash.replace("/msg"+e,"");this.replaceHashFromString(t)}},CRouting.prototype.replaceHashFromString=function(e){location.hash!==e&&location.replace(e)},CRouting.prototype.setHash=function(e){return this.setHashFromString(this.buildHashFromArray(e))},CRouting.prototype.replaceHash=function(e){this.replaceHashFromString(this.buildHashFromArray(e))},CRouting.prototype.replaceHashDirectly=function(e){hasher.stop(),this.replaceHashFromString(this.buildHashFromArray(e)),hasher.init()},CRouting.prototype.setPreviousHash=function(){location.hash=this.previousHash()},CRouting.prototype.buildHashFromArray=function(e){var t=0,i=0,s="";if(_.isArray(e))for(i=e.length;i>t;t++)e[t]=encodeURIComponent(e[t]);else e=[encodeURIComponent(e.toString())];return s=e.join("/"),""!==s&&(s="#"+s),s},CRouting.prototype.getHashFromHref=function(){var e=location.href.indexOf("#"),t="";return-1!==e&&(t=location.href.substr(e+1)),t},CRouting.prototype.isSingleMode=function(){var e=this.getScreenFromHash(),t=e===Enums.Screens.SingleMessageView||e===Enums.Screens.SingleCompose||e===Enums.Screens.SingleHelpdesk;return this.currentScreen=e,t},CRouting.prototype.goDirectly=function(e,t){hasher.stop(),this.setHash(e),this.parseRouting(t),hasher.init()},CRouting.prototype.historyBackWithoutParsing=function(e){hasher.stop(),location.hash=this.currentHash(),hasher.init()},CRouting.prototype.getScreenFromHash=function(){var e=this.getHashFromHref(),t=e.split("/");return decodeURIComponent(t.shift())||this.defaultScreen},CRouting.prototype.parseRouting=function(e){var t=App.Screens.getCurrentScreenModel(),i=_.bind(this.chooseScreen,this,e);t&&Utils.isFunc(t.beforeHide)?t.beforeHide(i):i()},CRouting.prototype.chooseScreen=function(e){var t=this.getHashFromHref(),i=t.split("/"),s=decodeURIComponent(i.shift())||this.defaultScreen,o=!!_.find(Enums.Screens,function(e){return e===s}),n=0,r=i.length;for(s===Enums.Screens.Mailbox&&this.lastMailboxHash(t),s===Enums.Screens.Helpdesk&&this.lastHelpdeskHash(t),s===Enums.Screens.Settings&&this.lastSettingsHash(t),this.previousHash(this.currentHash()),this.currentHash(t);r>n;n++)i[n]=decodeURIComponent(i[n]);switch($.isArray(e)&&(i=_.union(i,e)),this.currentScreen=s,s){case Enums.Screens.SingleMessageView:case Enums.Screens.SingleCompose:case Enums.Screens.SingleHelpdesk:AppData.SingleMode=!0,App.Screens.showCurrentScreen(s,i);break;default:o||(s=this.defaultScreen),AppData.SingleMode=!1,App.Screens.showNormalScreen(Enums.Screens.Header),App.Screens.showCurrentScreen(s,i);break;case Enums.Screens.Mailbox:AppData.SingleMode=!1,App.Screens.showNormalScreen(Enums.Screens.Header),App.Screens.showCurrentScreen(Enums.Screens.Mailbox,i)}},CLinkBuilder.prototype.mailbox=function(e,t,i,s,o){var n=[Enums.Screens.Mailbox];return t=Utils.isNormal(t)?Utils.pInt(t):1,i=Utils.isNormal(i)?Utils.pString(i):"",s=Utils.isNormal(s)?Utils.pString(s):"",o=Utils.isNormal(o)?Utils.pString(o):"",e&&""!==e&&n.push(e),o&&""!==o&&n.push("filter:"+o),t>1&&n.push("p"+t),i&&""!==i&&n.push("msg"+i),s&&""!==s&&n.push(s),n},CLinkBuilder.prototype.inbox=function(){return this.mailbox()},CLinkBuilder.prototype.parseMailbox=function(e){var t="INBOX",i=1,s="",o="",n="",r="",a=0;return Utils.isNonEmptyArray(e)&&(t=Utils.pString(e[a]),a++,e.length>a&&(r=Utils.pString(e[a]),r==="filter:"+Enums.FolderFilter.Flagged&&(n=Enums.FolderFilter.Flagged,a++),r==="filter:"+Enums.FolderFilter.Unseen&&(n=Enums.FolderFilter.Unseen,a++)),e.length>a&&(r=Utils.pString(e[a]),this.isPageParam(r)&&(i=Utils.pInt(r.substr(1)),0>=i&&(i=1),a++)),e.length>a&&(r=Utils.pString(e[a]),this.isMsgParam(r)&&(s=r.substr(3),a++)),e.length>a&&(o=Utils.pString(e[a]))),{Folder:t,Page:i,Uid:s,Search:o,Filters:n}},CLinkBuilder.prototype.contacts=function(e,t,i,s,o){var n=[Enums.Screens.Contacts];return"number"==typeof e&&n.push(e),t&&""!==t&&n.push(t),i&&""!==i&&n.push(i),Utils.isNumeric(s)&&n.push("p"+s),o&&""!==o&&n.push("cnt"+o),n},CLinkBuilder.prototype.parseContacts=function(e){var t=0,i=[Enums.ContactsGroupListType.Personal,Enums.ContactsGroupListType.SharedToAll,Enums.ContactsGroupListType.Global,Enums.ContactsGroupListType.All],s=Enums.ContactsGroupListType.All,o="",n="",r=1,a="";return Utils.isNonEmptyArray(e)&&(s=Utils.pInt(e[t]),t++,-1===Utils.inArray(s,i)&&(s=Enums.ContactsGroupListType.SubGroup),s===Enums.ContactsGroupListType.SubGroup&&(e.length>t?(o=Utils.pString(e[t]),t++):s=Enums.ContactsGroupListType.Personal),e.length>t&&!this.isPageParam(e[t])&&!this.isContactParam(e[t])&&(n=Utils.pString(e[t]),t++),e.length>t&&this.isPageParam(e[t])&&(r=Utils.pInt(e[t].substr(1)),t++,0>=r&&(r=1)),e.length>t&&this.isContactParam(e[t])&&(a=Utils.pString(e[t].substr(3)),t++)),{Type:s,GroupId:o,Search:n,Page:r,Uid:a}},CLinkBuilder.prototype.isPageParam=function(e){return"p"===e.substr(0,1)&&/^[1-9][\d]*$/.test(e.substr(1))},CLinkBuilder.prototype.isContactParam=function(e){return"cnt"===e.substr(0,3)&&/^[1-9][\d]*$/.test(e.substr(3))},CLinkBuilder.prototype.isMsgParam=function(e){return"msg"===e.substr(0,3)&&/^[1-9][\d]*$/.test(e.substr(3))},CLinkBuilder.prototype.compose=function(){var e=AppData.SingleMode?Enums.Screens.SingleCompose:Enums.Screens.Compose;return[e]},CLinkBuilder.prototype.composeFromMessage=function(e,t,i,s){var o=s||AppData.SingleMode?Enums.Screens.SingleCompose:Enums.Screens.Compose;return[o,e,t,i]},CLinkBuilder.prototype.composeWithToField=function(e){var t=AppData.SingleMode?Enums.Screens.SingleCompose:Enums.Screens.Compose;return[t,"to",e]},CLinkBuilder.prototype.parseToAddr=function(e){var t=decodeURI(Utils.pString(e)),i=-1!==t.indexOf("mailto:"),s=[],o=[],n="",r="",a="",l="";return i&&(s=t.replace(/^mailto:/,"").split("?"),t=s[0],2===s.length&&(o=s[1].split("&"),_.each(o,function(e){var t=e.split("=");if(2===t.length)switch(t[0]){case"subject":n=t[1];break;case"cc":r=t[1];break;case"bcc":a=t[1];break;case"body":l=t[1]}}))),{to:t,hasMailto:i,subject:n,cc:r,bcc:a,body:l}},Utils.inArray=$.inArray,Utils.isFunc=$.isFunction,Utils.trim=$.trim,Utils.emptyFunction=function(){},Utils.isUnd=function(e){return void 0===e},Utils.isNull=function(e){return null===e},Utils.isNormal=function(e){return!Utils.isUnd(e)&&!Utils.isNull(e)},Utils.isNumeric=function(e){return Utils.isNormal(e)?/^[1-9]+[0-9]*$/.test(e.toString()):!1},Utils.pInt=function(e){var t=window.parseInt(e,10);return isNaN(t)&&(t=0),t},Utils.pString=function(e){return Utils.isNormal(e)?e.toString():""},Utils.isNonEmptyArray=function(e,t){return t=t||1,_.isArray(e)&&t<=e.length},Utils.pImport=function(e,t,i){e[t]=i},Utils.pExport=function(e,t,i){return Utils.isUnd(e[t])?i:e[t]},Utils.encodeHtml=function(e){return e?e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},Utils.i18n=function(e,t,i,s){var o="",n=Utils.isUnd(I18n[e])?Utils.isNormal(i)?i:e:I18n[e];if(Utils.isUnd(s)||(n=function(e,t){var i=Utils.getPlural(AppData.User.DefaultLanguage,e),s=t.split("|");return s&&s[i]?s[i]:s&&s[0]?s[0]:t}(s,n)),Utils.isNormal(t))for(o in t)if(t.hasOwnProperty(o)){var r=new RegExp("%"+o+"%","g");n=n.replace(r,t[o])}return n},Utils.roundNumber=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},Utils.friendlySize=function(e){var t=1024,i=t*t,s=t*t*t;return e=Utils.pInt(e),e>=s?Utils.roundNumber(e/s,1)+Utils.i18n("MAIN/GIGABYTES"):e>=i?Utils.roundNumber(e/i,1)+Utils.i18n("MAIN/MEGABYTES"):e>=t?Utils.roundNumber(e/t,0)+Utils.i18n("MAIN/KILOBYTES"):e+Utils.i18n("MAIN/BYTES")},Utils.timeOutAction=function(){var e={};return function(t,i,s){Utils.isUnd(e[t])&&(e[t]=0),window.clearTimeout(e[t]),e[t]=window.setTimeout(i,s)}}(),Utils.$log=null,Utils.aLog=[],Utils.log=function(){function e(e,t){return"string"==typeof t&&t.length>50?t.substring(0,50):t}if(AppData&&AppData.ClientDebug&&App.browser&&!App.browser.ie9AndBelow){var t=Utils.$log||$('<div style="display: none;"></div>').appendTo("body"),i=[];_.each(arguments,function(t){var s="string"==typeof t?t:JSON.stringify(t,e);0===i.length&&(s=" *** "+s+" *** "),i.push(s)}),i.push(moment().format(" *** D MMMM, YYYY, HH:mm:ss *** ")),Utils.$log=t,Utils.aLog.length>200&&Utils.aLog.shift(),Utils.aLog.push(Utils.encodeHtml(i.join(", "))),t.html(Utils.aLog.join("<br /><br />"))}},Utils.getAjaxDataForLog=function(e,t){var i=t;if(t&&t.Result)switch(e){case"MessagesGetList":case"MessagesGetListByUids":i={Result:{Uids:t.Result.Uids,UidNext:t.Result.UidNext,FolderHash:t.Result.FolderHash,MessageCount:t.Result.MessageCount,MessageUnseenCount:t.Result.MessageUnseenCount,MessageResultCount:t.Result.MessageResultCount}};break;case"MessageGet":i={Result:{Folder:t.Result.Folder,Uid:t.Result.Uid,Subject:t.Result.Subject,Size:t.Result.Size,TextSize:t.Result.TextSize,From:t.Result.From,To:t.Result.To}};break;case"MessagesGetBodies":i={Result:_.map(t.Result,function(e){return{Uid:e.Uid,Subject:e.Subject}})}}else t&&(i={Result:t.Result,ErrorCode:t.ErrorCode});return i},Utils.getImportContactsLink=function(){return"?/ImportContacts/"},Utils.getExportContactsLink=function(e){return"?/Raw/Contacts"+e+"/"},Utils.getExportCalendarLinkByHash=function(e,t){return"?/Raw/Calendar/"+e+"/"+t},Utils.getDownloadLinkByHash=function(e,t,i,s){return i=Utils.isUnd(i)?!1:!!i,s=Utils.isUnd(s)?"":s,"?/Raw/Download/"+e+"/"+t+"/"+(i?"1":"0")+(""===s?"":"/"+s)},Utils.getIframeLinkByHash=function(e,t,i,s){return i=Utils.isUnd(i)?!1:!!i,s=Utils.isUnd(s)?"":s,"?/Raw/Iframe/"+e+"/"+t+"/"+(i?"1":"0")+(""===s?"":"/"+s)},Utils.getIframeWrappwer=function(e,t){return"?/Raw/Iframe/"+e+"/"+window.encodeURIComponent(t)+"/"},Utils.getViewThumbnailLinkByHash=function(e,t,i,s){return i=Utils.isUnd(i)?!1:!!i,s=Utils.isUnd(s)?"":s,"?/Raw/Thumbnail/"+e+"/"+t+"/"+(i?"1":"0")+(""===s?"":"/"+s)},Utils.getFilestorageDownloadLinkByHash=function(e,t,i){var s="?/Raw/FilesDownload/"+e+"/"+t;return Utils.isUnd(i)||(s=s+"/0/"+i),s},Utils.getFilestorageViewLinkByHash=function(e,t,i){var s="?/Raw/FilesView/"+e+"/"+t;return Utils.isUnd(i)||(s=s+"/0/"+i),s},Utils.getFilestorageViewThumbnailLinkByHash=function(e,t,i){var s="?/Raw/FilesThumbnail/"+e+"/"+t;return Utils.isUnd(i)||(s=s+"/0/"+i),s},Utils.getFilestoragePublicViewLinkByHash=function(e){return"?/Window/Files/0/"+e},Utils.getFilestoragePublicDownloadLinkByHash=function(e){return"?/Raw/FilesPub/0/"+e},Utils.daysInMonth=function(e,t){return e>0&&13>e&&t>0?new Date(t,e,0).getDate():31},Utils.WindowOpener={_iDefaultRatio:.8,_aOpenedWins:[],openMessage:function(e,t){if(e){var i=e.folder(),s=e.uid(),o="";o=App.Routing.buildHashFromArray(t?[Enums.Screens.SingleCompose,"drafts",i,s]:[Enums.Screens.SingleMessageView,i,"msg"+s]),this.openTab(o)}},openTab:function(e,t){$.cookie("aft-cache-ctrl","1");var i=null;return i=window.open(e,"_blank"),i&&(i.focus(),i.name=t?t:AppData.Accounts?AppData.Accounts.currentId():0,this._aOpenedWins.push(i)),i},open:function(e,t,i){var s=i?",menubar=yes":",menubar=no",o="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+s,n=null;return t=t.replace(/\W/g,""),o+=this._getSizeParameters(),n=window.open(e,t,o),n.focus(),n.name=AppData.Accounts?AppData.Accounts.currentId():0,this._aOpenedWins.push(n),n},getOpenedDraftUids:function(){this._aOpenedWins=_.filter(this._aOpenedWins,function(e){return!e.closed});var e=_.map(this._aOpenedWins,function(e){return e.App?e.App.MailCache.editedDraftUid():""});return App.Screens.hasOpenedMinimizedPopups()&&e.push(App.MailCache.editedDraftUid()),_.uniq(_.compact(e))},closeComposesWithDraftUids:function(e){_.each(this._aOpenedWins,function(t){t.App&&-1!==Utils.inArray(t.App.MailCache.editedDraftUid(),e)&&t.close()}),-1!==Utils.inArray(App.MailCache.editedDraftUid(),e)&&App.Api.closeComposePopup()},closeAll:function(){for(var e=this._aOpenedWins.length,t=0,i=null;e>t;t++)i=this._aOpenedWins[t],i.closed||i.close();this._aOpenedWins=[]},_getSizeParameters:function(){var e=window.screen.width,t=Math.ceil(e*this._iDefaultRatio),i=Math.ceil((e-t)/2),s=window.screen.height,o=Math.ceil(s*this._iDefaultRatio),n=Math.ceil((s-o)/2);return",width="+t+",height="+o+",top="+n+",left="+i}},Utils.delegateRun=function(e,t,i){e&&e[t]&&e[t].apply(e,_.isArray(i)?i:[])},Utils.strRepeat=function(e,t){return new Array(t+1).join(e)},Utils.deferredUpdate=function(e,t,i,s){!e.__interval&&t?(e.__state=!0,s(e,!0),e.__interval=window.setInterval(function(){e.__state||(s(e,!1),window.clearInterval(e.__interval),e.__interval=null)},i)):t||(e.__state=!1)},Utils.draggableMessages=function(){return $('<div class="draggable draggableMessages"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},Utils.draggableContacts=function(){return $('<div class="draggable draggableContacts"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},Utils.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var e=$(document.activeElement);(e.is("input")||e.is("textarea"))&&document.activeElement.blur()}},Utils.uiDropHelperAnim=function(e,t){var i=0,s=0,o=0,n=0,r=0,a=0,l=t.helper.clone().appendTo("#pSevenHidden"),p=$(e.target).find(".animGoal"),h=null;p=$(p[0]?p[0]:e.target),h=p&&p[0]?p.offset():null,h&&(i=window.Math.round(h.left),s=window.Math.round(h.top),r=p.width(),a=p.height(),o=i,r>0&&(o+=window.Math.round(r/2)),n=s,a>0&&(n+=window.Math.round(a/2)),l.animate({left:o+"px",top:n+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){$(this).remove()}))},Utils.isTextFieldFocused=function(){var e=document&&document.activeElement?document.activeElement:null,t=e?e.tagName:null,i=e&&e.type?e.type.toLowerCase():null,s=e?e.contentEditable:null;return"INPUT"===t&&("text"===i||"password"===i||"email"===i)||"TEXTAREA"===t||"IFRAME"===t||"true"===s},Utils.removeSelection=function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},Utils.getMonthNamesArray=function(){for(var e=Utils.i18n("DATETIME/MONTH_NAMES").split(" "),t=12,i=e.length;t>i;i++)e[i]="";return e},Utils.getPlural=function(e,t){var i=0;switch(t=Utils.pInt(t),e){case"Arabic":i=0===t?0:1===t?1:2===t?2:t%100>=3&&10>=t%100?3:t%100>=11?4:5;break;case"Bulgarian":i=1===t?0:1;break;case"Chinese-Simplified":i=0;break;case"Chinese-Traditional":i=1===t?0:1;break;case"Czech":i=1===t?0:t>=2&&4>=t?1:2;break;case"Danish":i=1===t?0:1;break;case"Dutch":i=1===t?0:1;break;case"English":i=1===t?0:1;break;case"Estonian":i=1===t?0:1;break;case"Finish":i=1===t?0:1;break;case"French":i=1===t?0:1;break;case"German":i=1===t?0:1;break;case"Greek":i=1===t?0:1;break;case"Hebrew":i=1===t?0:1;break;case"Hungarian":i=1===t?0:1;break;case"Italian":i=1===t?0:1;break;case"Japanese":i=0;break;case"Korean":i=0;break;case"Latvian":i=t%10===1&&t%100!==11?0:0!==t?1:2;break;case"Lithuanian":i=t%10===1&&t%100!==11?0:t%10>=2&&(10>t%100||t%100>=20)?1:2;break;case"Norwegian":i=1===t?0:1;break;case"Persian":i=0;break;case"Polish":i=1===t?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Portuguese-Portuguese":i=1===t?0:1;break;case"Portuguese-Brazil":i=1===t?0:1;break;case"Romanian":i=1===t?0:0===t||t%100>0&&20>t%100?1:2;break;case"Russian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Slovenian":i=t%10===1&&t%100!==11?0:t%10===2&&t%100!==12?1:2;break;case"Serbian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Spanish":i=1===t?0:1;break;case"Swedish":i=1===t?0:1;break;case"Thai":i=0;break;case"Turkish":i=1===t?0:1;break;case"Ukrainian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Vietnamese":i=0;break;default:i=0}return i},Utils.getFileExtension=function(e){var t="",i=e.lastIndexOf(".");return i>-1&&(t=e.substr(i+1)),t},Utils.getFileNameWithoutExtension=function(e){var t=e,i=e.lastIndexOf(".");return i>-1&&(t=e.substr(0,i)),t},Utils.defaultOptionsAfterRender=function(e,t){t&&(Utils.isUnd(t.disable)||ko.applyBindingsToNode(e,{disable:t.disable},t))},Utils.getDateFormatForMoment=function(e){var t="MM/DD/YYYY";switch(e){case"MM/DD/YYYY":t="MM/DD/YYYY";break;case"DD/MM/YYYY":t="DD/MM/YYYY";break;case"DD Month YYYY":t="DD MMMM YYYY"}return t},Utils.getDateFormatForDatePicker=function(e){var t="mm/dd/yy";switch(e){case"MM/DD/YYYY":t="mm/dd/yy";break;case"DD/MM/YYYY":t="dd/mm/yy";break;case"DD Month YYYY":t="dd MM yy"}return t},Utils.getDateFormatsForSelector=function(){return _.map(AppData.App.DateFormats,function(e){switch(e){case"MM/DD/YYYY":return{name:Utils.i18n("DATETIME/DATEFORMAT_MMDDYYYY"),value:e};case"DD/MM/YYYY":return{name:Utils.i18n("DATETIME/DATEFORMAT_DDMMYYYY"),value:e};case"DD Month YYYY":return{name:Utils.i18n("DATETIME/DATEFORMAT_DDMONTHYYYY"),value:e};default:return{name:e,value:e}}})},Utils.getTitleForEvent=function(e){var t=e?Utils.trim(e.replace(/[\n\r]/," ")):"",i=t.indexOf(" ",180);return i>=0&&(t=t.substring(0,i)+"..."),t.length>200&&(t=t.substring(0,200)+"..."),t},Utils.desktopNotify=function(){var e=[];return function(t){if(t&&AppData.User.DesktopNotifications&&window.Notification&&!App.focused())switch(t.action){case"show":if(window.Notification.permission!==Enums.notificationPermission.Denied){var i,s={body:t.body||"",dir:t.dir||"auto",lang:t.lang||"",tag:t.tag||Math.floor(900*Math.random()+100),icon:t.icon||!1},o=function(){i=new window.Notification(t.title,s),i.onclick=function(e){t.callback&&t.callback(),i.close()},t.timeout&&setTimeout(function(){i.close()},t.timeout),e.push(i)};window.Notification.permission===Enums.notificationPermission.Granted?o():window.Notification.permission===Enums.notificationPermission.Default&&window.Notification.requestPermission(function(e){e===Enums.notificationPermission.Granted&&o()})}break;case"hide":_.each(e,function(i,s){t.tag===i.tag&&(i.close(),e.splice(s,1))});break;case"hideAll":_.each(e,function(e){e.close()}),e.length=0}}}(),Utils.isRTL=function(){return $html.hasClass("rtl")},Utils.validateFileOrFolderName=function(e){return e=Utils.trim(e),""!==e&&!/["\/\\*?<>|:]/.test(e)},Utils.shadeColor=function(e,t){var i=!1,s=0,o=0,n=0,r=0;return"#"===e[0]&&(e=e.slice(1),i=!0),s=window.parseInt(e,16),o=(s>>16)+t,o>255?o=255:0>o&&(o=0),n=(s>>8&255)+t,n>255?n=255:0>n&&(n=0),r=(255&s)+t,r>255?r=255:0>r&&(r=0),(i?"#":"")+(r|n<<8|o<<16).toString(16)},Utils.extend=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,
e.prototype.constructor=e},Utils.thumbQueue=function(){var e={},t={},i=2;return function(s,o,n){o&&n?!(s in t)||t[s]>0?(s in t||(t[s]=i,e[s]=[]),t[s]--,n(o)):e[s].push({imageSrc:o,imageSrcObserver:n,messageUid:s}):e[s]&&e[s].length&&(e[s][0].imageSrcObserver(e[s][0].imageSrc),e[s].shift())}}(),Utils.checkConnection=function(){var e=-1,t=(new Date).getTime(),i=0,s=!1;return setInterval(function(){i=(new Date).getTime(),s=i>t+5e3+1e3,t=i,s&&App.Api.hideError(!0)},5e3),function(t,i){clearTimeout(e),"error"!==i?(App.InternetConnectionError=!1,App.Api.hideError(!0)):"SystemPing"===t?(App.InternetConnectionError=!0,App.Api.showError(Utils.i18n("WARNING/NO_INTERNET_CONNECTION"),!1,!0,!0),e=setTimeout(function(){App.Ajax.send({Action:"SystemPing"})},6e4)):App.Ajax.send({Action:"SystemPing"})}}(),Utils.loadScript=function(e,t,i,s){var o=document.createElement("script");!Utils.isUnd(s)&&t&&(window[s]=t),Utils.isUnd(i)&&(i={}),_.each(i,function(e,t){o.setAttribute(t,e)}),o.type="text/javascript",o.src=e,document.body.appendChild(o)},Utils.registerMailto=function(e){!window.navigator||!Utils.isFunc(window.navigator.registerProtocolHandler)||e&&1===App.Storage.getData("MailtoAsked")||(window.navigator.registerProtocolHandler("mailto",Utils.Common.getAppPath()+"#"+Enums.Screens.Compose+"/to/%s",""!==AppData.App.SiteName?AppData.App.SiteName:"WebMail"),App.Storage.setData("MailtoAsked",1))},Utils.CustomTooltip={_$Region:null,_$ArrowTop:null,_$Text:null,_$ArrowBottom:null,_iArrowBorderLeft:0,_iArrowMarginLeft:0,_iLeftShift:0,_bInitialized:!1,_bShown:!1,iHideTimer:0,iTimer:0,init:function(){this._bInitialized||(this._$Region=$('<span class="custom_tooltip"></span>').appendTo("body").hide(),this._$ArrowTop=$('<span class="custom_tooltip_arrow top"></span>').appendTo(this._$Region),this._$Text=$('<span class="custom_tooltip_text"></span>').appendTo(this._$Region),this._$ArrowBottom=$('<span class="custom_tooltip_arrow bottom"></span>').appendTo(this._$Region),this._iArrowMarginLeft=Utils.pInt(this._$ArrowTop.css("margin-left")),this._iArrowBorderLeft=Utils.pInt(this._$ArrowTop.css("border-left-width")),this._iLeftShift=Utils.pInt(this._$Region.css("margin-left"))+this._iArrowMarginLeft+this._iArrowBorderLeft,this._bInitialized=!0),this._$ArrowTop.show(),this._$ArrowBottom.hide(),this._$ArrowTop.css({"margin-left":this._iArrowMarginLeft+"px"}),this._$ArrowBottom.css({"margin-left":this._iArrowMarginLeft+"px"})},show:function(e,t){this.init();var i=t.offset(),s=t.width(),o=70>s?s/2:s/4,n=Utils.pInt(t.css("padding-left")),r=$("body");this._$Text.html(e),this._bShown=!0,this._$Region.stop().fadeIn(260,_.bind(function(){this._bShown||this._$Region.hide()},this)).css({top:i.top+t.outerHeight()+1,left:i.left+n+o-this._iLeftShift,right:"auto"}),r.outerHeight()<this._$Region.outerHeight()+this._$Region.offset().top&&(this._$ArrowTop.hide(),this._$ArrowBottom.show(),this._$Region.css({top:i.top-this._$Region.outerHeight()})),setTimeout(function(){r.width()<this._$Region.outerWidth(!0)+this._$Region.offset().left&&(this._$Region.css({left:"auto",right:0}),this._$ArrowTop.css({"margin-left":o+i.left-this._$Region.offset().left-this._iArrowBorderLeft+"px"}),this._$ArrowBottom.css({"margin-left":o+i.left-this._$Region.offset().left-this._iArrowBorderLeft+Utils.pInt(this._$Region.css("margin-right"))+"px"}))}.bind(this),1)},hide:function(){this._bInitialized&&(this._bShown=!1,this._$Region.hide())}},Utils.htmlStartsWithBlockquote=function(e){var t=e.split("<blockquote"),i=t.length>0?t[0]:"",s=Utils.trim(i.replace(/<[^>]*>/g,""));return""===s},Utils.escapeQuotes=function(e){return e.replace(/'/g,"\\'").replace(/"/g,'\\"')},Utils.changeFavicon=function(e){$("head").append('<link rel="shortcut icon" type="image/x-icon" href='+e+" />")},Utils.checkCookies=function(){$.cookie("checkCookie","1",{path:"/"});var e="1"===$.cookie("checkCookie");return e||App.Screens.showError(Utils.i18n("WARNING/COOKIES_DISABLED"),!1,!0),e},Utils.calmEvent=function(e){e&&(e.stop&&e.stop(),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.returnValue=!1)},Utils.Common={},Utils.Common.getRequestParam=function(e){var t=[],i=[],s=null;return void 0===this.aGetParams&&(t=""!==location.search?location.search.substr(1).split("&"):[],t.length>0&&_.each(t,function(e){var t=e.split("=");i[t[0]]=t.length>1?t[1]:""}),this.aGetParams=i),void 0!==this.aGetParams[e]&&(s=this.aGetParams[e]),s},Utils.Common.getAppPath=function(){var e=window.location.origin||window.location.protocol+"//"+window.location.host;return e+window.location.pathname},Utils.Common.clearAndReloadLocation=function(e,t){if(e||""===window.location.search&&""===window.location.hash)window.location.reload();else{var i=Utils.Common.getAppPath();t||""===window.location.search||(i+=window.location.search),"replaceState"in history?(history.replaceState("",document.title,i),window.location.reload(!0)):window.location.href=i}},Utils.File={},Utils.File.getViewLinkByHash=function(e,t,i,s){var o="?/Raw/View/"+e+"/"+t,n=i===!0?"/1":"/0",r="string"==typeof s&&""!==s?"/"+s:"";return o+n+r},Utils.Address={},Utils.Address.isCorrectEmail=function(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)},Utils.Address.getFullEmail=function(e,t){var i="";return i=t.length>0?e.length>0?Utils.Address.isCorrectEmail(e)||-1!==e.indexOf(",")?'"'+e+'" <'+t+">":e+" <"+t+">":t:e},Utils.Address.getEmailParts=function(e,t){for(var i=e.indexOf('"'),s=e.indexOf('"',i+1),o=e.indexOf("<",s),n=-1,r=-1,a="",l="";-1!==o;)n=o,o=e.indexOf("<",o+1);return o=n,r=e.indexOf(">",o+1),-1===o?l=$.trim(e):(i=t?-1:i,a=$.trim(-1===i?e.substring(0,o):e.substring(i+1,s)),l=$.trim(e.substring(o+1,r))),{name:a,email:l,fullEmail:Utils.Address.getFullEmail(a,l)}},Utils.Address.getArrayRecipients=function(e,t){for(var i=[",",";"," "],s="",o=e,n=0,r=0,a="",l=null,p=[];o.length>0;){for(n=Utils.Address._getFirstSeparatorPosition(o,i),r=n;-1!==_.indexOf(i,o[r+1]);)r++;-1===n?(a=s+o,l=Utils.Address.getEmailParts(a),(t||Utils.Address.isCorrectEmail(l.email))&&p.push(l),o=""):(a=s+o.substring(0,n),l=Utils.Address.getEmailParts(a),Utils.Address.isCorrectEmail(l.email)?(p.push(l),s=""):s+=o.substring(0,r+1),o=o.substring(r+1))}return p},Utils.Address._getFirstSeparatorPosition=function(e,t){var i=-1;return _.each(t,function(t){var s=e.indexOf(t);-1!==s&&(-1===i||i>s)&&(i=s)}),i},Utils.Address.getIncorrectEmailsFromAddressString=function(e){for(var t=e.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),i=[],s=0,o=t.length,n="",r=null;o>s;s++)n=$.trim(t[s]),n.length>0&&(r=Utils.Address.getEmailParts($.trim(t[s])),Utils.Address.isCorrectEmail(r.email)||i.push(r.email));return i},CSelector.prototype.iTimer=0,CSelector.prototype.bResetCheckedOnClick=!1,CSelector.prototype.bCheckOnSelect=!1,CSelector.prototype.bUnselectOnCtrl=!1,CSelector.prototype.bDisableMultiplySelection=!1,CSelector.prototype.setBeforeSelectCallback=function(e){this.fBeforeSelectCallback=e||null},CSelector.prototype.getLastOrSelected=function(){var e=0,t=null;return _.each(this.list(),function(i){i.checked()&&e++,i.selected()&&(t=i)}),0===e&&t?t:this.oLast},CSelector.prototype.initOnApplyBindings=function(e,t,i,s,o){$(document).on("keydown",this.onKeydownBinded),this.oListScope=s,this.oScrollScope=o,this.sActionSelector=e,this.sSelectabelSelector=t,this.sCheckboxSelector=i;var n=this,r=function(e,t,i){var s=0,o=0,r=null,a=!1,l=!1,p=[],h=!1;if(t=t?t:null,i&&i.shiftKey&&null!==t&&null!==e&&t!==e)for(p=n.list(),h=t.checked(),s=0,o=p.length;o>s;s++)r=p[s],a=!1,(r===e||r===t)&&(a=!0),a&&(l=!l),(l||a)&&r.checked(h);t&&(n.oLast=t)};$(this.oListScope).on("dblclick",e,function(e){var t=ko.dataFor(this);!t||!e||e.ctrlKey||e.altKey||e.shiftKey||n.onDblClick(t)}),bMobileDevice&&$(this.oListScope).on("touchstart",e,function(e){if(e){var t=e.timeStamp,i=$(this).data("lastTouch")||t,s=t-i,o=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches.length:0;$(this).data("lastTouch",t),!s||s>250||o>1||(e.preventDefault(),$(this).trigger("dblclick"))}}),$(this.oListScope).on("click",e,function(e){var t=!0,i=null,s=n.getLastOrSelected(),o=ko.dataFor(this);o&&e&&(e.shiftKey?(t=!1,n.bDisableMultiplySelection||(null===n.oLast&&(n.oLast=o),o.checked(!o.checked()),r(s,o,e))):e.ctrlKey&&(t=!1,n.bDisableMultiplySelection||(n.oLast=o,i=n.itemSelected(),!i||i.checked()||o.checked()||i.checked(!0),n.bUnselectOnCtrl&&o===n.itemSelected()?(o.checked(!o.selected()),n.itemSelected(null)):o.checked(!o.checked()))),t&&(n.onSelect(o),n.scrollToSelected()))}),$(this.oListScope).on("click",i,function(e){var t=ko.dataFor(this);t&&e&&!n.bDisableMultiplySelection&&(e.shiftKey?(null===n.oLast&&(n.oLast=t),r(n.getLastOrSelected(),t,e)):n.oLast=t),e&&e.stopPropagation&&e.stopPropagation()}),$(this.oListScope).on("dblclick",i,function(e){e&&e.stopPropagation&&e.stopPropagation()})},CSelector.prototype.getResultSelection=function(e,t){var i=this,s=!1,o=!1,n=null,r=this.iFactor,a=!!this.multiplyLineFactor,l=0,p=0,h=[];if(!e&&-1<Utils.inArray(t,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]))h=this.list(),h&&0<h.length&&(-1<Utils.inArray(t,[this.KeyDown,this.KeyRight,Enums.Key.PageUp,Enums.Key.Home])?n=h[0]:-1<Utils.inArray(t,[this.KeyUp,this.KeyLeft,Enums.Key.PageDown,Enums.Key.End])&&(n=h[h.length-1]));else if(e&&(h=this.list(),p=h?h.length:0,p>0))if(Enums.Key.Home===t||Enums.Key.PageUp===t||Enums.Key.End===t||Enums.Key.PageDown===t||a&&(Enums.Key.Left===t||Enums.Key.Right===t)||!a&&(Enums.Key.Up===t||Enums.Key.Down===t))_.each(h,function(r){if(!s)switch(t){case i.KeyUp:case i.KeyLeft:e===r?s=!0:n=r;break;case Enums.Key.Home:case Enums.Key.PageUp:n=r,s=!0;break;case i.KeyDown:case i.KeyRight:o?(n=r,s=!0):e===r&&(o=!0);break;case Enums.Key.End:case Enums.Key.PageDown:n=r}});else if(a&&this.KeyDown===t){for(;p>l;l++)if(e===h[l]){l+=r,l>p-1&&(l-=r),n=h[l];break}}else if(a&&this.KeyUp===t)for(l=p;l>=0;l--)if(e===h[l]){l-=r,0>l&&(l+=r),n=h[l];break}return n},CSelector.prototype.shiftClickResult=function(e,t,i){if(t){var s=!!this.multiplyLineFactor,o=!1,n=!1;-1<Utils.inArray(i,s?[Enums.Key.Left,Enums.Key.Right]:[Enums.Key.Up,Enums.Key.Down])?t.checked(!t.checked()):-1<Utils.inArray(i,s?[Enums.Key.Up,Enums.Key.Down,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]:[Enums.Key.Left,Enums.Key.Right,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End])&&(n=!t.checked(),_.each(this.list(),function(i){var s=!1;(i===e||t===i)&&(o=!o,s=!0),(o||s)&&(i.checked(n),s=!1)}),s&&e&&(i===Enums.Key.Up||i===Enums.Key.Down)&&e.checked(!e.checked()))}},CSelector.prototype.clickNewSelectPosition=function(e,t){var i=this,s=0,o=null,n=this.itemSelected();o=this.getResultSelection(n,e),o?(t&&this.shiftClickResult(o,n,e),o&&this.fBeforeSelectCallback?(this.fBeforeSelectCallback(o,function(e){e&&(i.itemSelected(o),s=0===i.iTimer?50:150,0!==i.iTimer&&window.clearTimeout(i.iTimer),i.iTimer=window.setTimeout(function(){i.iTimer=0,i.onSelect(o,!1)},s),this.scrollToSelected())}),this.scrollToSelected()):(this.itemSelected(o),s=0===this.iTimer?50:150,0!==this.iTimer&&window.clearTimeout(this.iTimer),this.iTimer=window.setTimeout(function(){i.iTimer=0,i.onSelect(o)},s),this.scrollToSelected())):n&&t&&-1<Utils.inArray(e,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End])&&n.checked(!n.checked())},CSelector.prototype.onKeydown=function(e){var t=!0,i=0;return this.useKeyboardKeys()&&e&&!Utils.isTextFieldFocused()&&!App.Screens.hasOpenedMaximizedPopups()&&(i=e.keyCode,e.ctrlKey||this.KeyUp!==i&&this.KeyDown!==i&&this.KeyLeft!==i&&this.KeyRight!==i&&Enums.Key.PageUp!==i&&Enums.Key.PageDown!==i&&Enums.Key.Home!==i&&Enums.Key.End!==i?Enums.Key.Del!==i||e.ctrlKey||e.shiftKey?Enums.Key.Enter===i?0<this.list().length&&!e.ctrlKey&&(this.onEnter(this.itemSelected()),t=!1):!e.ctrlKey||e.altKey||e.shiftKey||Enums.Key.a!==i||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),t=!1):0<this.list().length&&(this.onDelete(),t=!1):(this.clickNewSelectPosition(i,e.shiftKey),t=!1)),t},CSelector.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected())},CSelector.prototype.onEnter=function(e){var t=this;e&&this.fBeforeSelectCallback?this.fBeforeSelectCallback(e,function(i){i&&(t.itemSelected(e),t.fEnterCallback.call(this,e))}):(this.itemSelected(e),this.fEnterCallback.call(this,e))},CSelector.prototype.selectionFunc=function(e){this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.itemSelected(e),this.fSelectCallback.call(this,e)},CSelector.prototype.onSelect=function(e,t){if(t=Utils.isUnd(t)?!0:!!t,this.fBeforeSelectCallback&&t){var i=this;this.fBeforeSelectCallback(e,function(t){t&&i.selectionFunc(e)})}else this.selectionFunc(e)},CSelector.prototype.onDblClick=function(e){this.fDblClickCallback.call(this,e)},CSelector.prototype.koCheckAll=function(){return ko.computed({read:this.checkAll,write:this.checkAll,owner:this})},CSelector.prototype.koCheckAllIncomplete=function(){return ko.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},CSelector.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var e=20,t=$(this.sSelectabelSelector,this.oScrollScope),i=t.position(),s=this.oScrollScope.height(),o=t.outerHeight();return i&&(i.top<0||i.top+o>s)?(this.oScrollScope.scrollTop(i.top<0?this.oScrollScope.scrollTop()+i.top-e:this.oScrollScope.scrollTop()+i.top-s+o+e),!0):!1},function(e){e.fn.splitter=function(t){return t=t||{},this.each(function(){var i=!1,s=t.collapse?t.collapse:!1,o=t.name,n=0,r=0,a=0,l={},p={},h=function(t){i=!0,A.addClass(f.activeClass),f._posSplit=-((E?b._overallWidth-t[f.eventPos]:t[f.eventPos])-y.get(0)[f.pxSplit]),e("body").attr({unselectable:"on"}).addClass("unselectable"),e(document).bind("mousemove",c).bind("mouseup",u)},c=function(e){var i=(E?b._overallWidth-e[f.eventPos]:e[f.eventPos])+f._posSplit;d(i),Utils.isFunc(t.resizeFunc)&&t.resizeFunc()},u=function C(i){A.removeClass(f.activeClass),e("body").attr({unselectable:"off"}).removeClass("unselectable"),o&&App.Storage.setData(o+"ResizerWidth",y.get(0)[f.pxSplit]),e(document).unbind("mousemove",c).unbind("mouseup",C),Utils.isFunc(t.resizeFunc)&&t.resizeFunc()},d=function(e,t){var i=y.get(0)._min;a=e,s&&i-e>150&&(e=5,t=!0),t||(e=window.Math.max(i,b._overallWidth-y.get(1)._max,window.Math.min(e,y.get(0)._max,b._overallWidth-y.get(1)._min))),y.get(0).$.css(f.split,e),y.get(1).$.css(f.split,b._overallWidth-e),App.browser.ie8AndBelow||y.trigger("resize")},m=function(e,t){for(var i=0,s=1;s<arguments.length;s++)i+=window.Math.max(window.parseInt(e.css(arguments[s]),10)||0,0);return i},g=(t.splitHorizontal?"h":t.splitVertical?"v":t.type)||"v",f=e.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[g],t),b=e(this),y=e(">*:not(css3pie)",b).each(function(){this.$=e(this)}),A=e(".resize_handler",y.get(0)).attr({unselectable:"on"}).bind("mousedown",h),E="rtl"===b.css("direction");y.get(0)._paneName=f.side1,y.get(1)._paneName=f.side2,y.each(function(){this._min=f["min"+this._paneName]||m(this.$,"min-"+f.split),this._max=f["max"+this._paneName]||m(this.$,"max-"+f.split)||9999,this._init=void 0===f["size"+this._paneName]?window.parseInt(e.css(this,f.split),10):f["size"+this._paneName]}),n=o?App.Storage.getData(o+"ResizerWidth")||y.get(0)._init:y.get(0)._init,isNaN(n)&&(n=b[0][f.pxSplit],n=window.Math.round(n/y.length)),f.resizeToWidth&&!App.browser.ie8AndBelow&&e(window).bind("resize",function(e){e.target===this&&b.trigger("resize")}),b.bind("resize",function(e,t,s,o,n){var a=e.target.className+"_"+s;i&&(l={}),e.target===this&&(b._overallWidth=b[0][f.pxSplit],b._overallWidth<=0||(r=f.sizeRight||f.sizeBottom?b._overallWidth-y.get(1)[f.pxSplit]:y.get(0)[f.pxSplit],isNaN(t)?t=r:s&&(n?t=l[a]?l[a]:r:(i=!1,l[a]?(t=l[a],l[a]=null):(t===r?(l[a]=null,t=p[a]):l[a]=p[a]=r,_.each(l,function(e,t){t!==a&&(l[t]=null)})))),d(t,o)))}).trigger("resize",[n])})}}(jQuery),function(e){e.ui.autocomplete.prototype._renderItem=function(t,i){var s=i.label.match(/[a-zA-Z0-9.\-_]+@[a-zA-Z0-9.]+/g);return s&&(i.label=i.label.replace("<"+s[0]+">","<span style='opacity: 0.5'>&lt;"+s[0]+"&gt</span>")),e("<li>").append("<a>"+i.label+(i.global?"":'<span class="del"></span>')+"</a>").appendTo(t)},e.ui.autocomplete.prototype._renderMenu=function(t,i){var s=this,o="";e.each(i,function(e,i){i&&i.category&&i.category!==o&&(o=i.category,t.append('<li class="ui-autocomplete-category">'+i.category+"</li>")),s._renderItemData(t,i)})},e.ui.autocomplete.prototype._move=function(e,t){return this.menu.element.is(":visible")?(this.menu.isFirstItem()&&/^previous/.test(e)?(this._value(this.term),this.menu._move("first","first",t)):this.menu.isLastItem()&&/^next/.test(e)&&(this._value(this.term),this.menu._move("last","last",t)),void this.menu[e](t)):void this.search(null,t)}}(jQuery),CApi.prototype.composeMessage=function(){App.Routing.setHash([Enums.Screens.Compose])},CApi.prototype.composeMessageFromDrafts=function(e,t){var i=App.Links.composeFromMessage("drafts",e,t);App.Routing.setHash(i)},CApi.prototype.composeMessageAsReplyOrForward=function(e,t,i){var s=App.Links.composeFromMessage(e,t,i);App.Routing.setHash(s)},CApi.prototype.composeMessageToAddresses=function(e){var t=App.Links.composeWithToField(e);App.Routing.setHash(t)},CApi.prototype.composeMessageWithVcard=function(e){var t=["vcard",e];App.Routing.goDirectly(App.Links.compose(),t)},CApi.prototype.composeMessageWithPgpKey=function(e,t){var i=["data-as-file",e,t];App.Routing.goDirectly(App.Links.compose(),i)},CApi.prototype.composeMessageWithFiles=function(e){var t=["file",e];App.Routing.goDirectly(App.Links.compose(),t)},CApi.prototype.closeComposePopup=function(){},CApi.prototype.createMailAccount=function(e){},CApi.prototype.showChangeDefaultAccountPasswordPopup=function(){},CApi.prototype.showConfigureMailPopup=function(e){},CApi.prototype.downloadByUrl=function(e){var t=null;bMobileDevice?window.open(e):(t=$('<iframe style="display: none;"></iframe>').appendTo(document.body),t.attr("src",e),setTimeout(function(){t.remove()},6e4))},CApi.prototype.isPgpSupported=function(){return!(!window.crypto||!window.crypto.getRandomValues)},CApi.prototype.pgp=function(e,t){if(Utils.isFunc(e))if(this.openPgp)e(this.openPgp);else if(this.isPgpSupported()){null!==this.openPgpCallbacks?this.openPgpCallbacks.push(e):e(!1);var i=this;this.openPgpRequest||(this.openPgpRequest=!0,$.ajax({url:"static/js/openpgp.js",dataType:"script",cache:!0,complete:function(){i.openPgp=window.openpgp?new OpenPgp(window.openpgp,"user_"+(t||"0")+"_"):!1,null!==i.openPgpCallbacks&&_.each(i.openPgpCallbacks,function(e){e(i.openPgp)}),i.openPgpCallbacks=null}}))}else e(!1)},CApi.prototype.showLoading=function(e){App.Screens.showLoading(e)},CApi.prototype.hideLoading=function(){App.Screens.hideLoading()},CApi.prototype.showReport=function(e,t){App.Screens.showReport(e,t)},CApi.prototype.showError=function(e,t,i,s){App.Screens.showError(e,t,i,s)},CApi.prototype.hideError=function(e){App.Screens.hideError(e)},CApi.prototype.showPgpErrorByCode=function(e,t,i){var s=Utils.isNonEmptyArray(e.errors)?e.errors:[],o=Utils.isNonEmptyArray(e.notices)?e.notices:[],n=[],r=[],a="",l=!1,p=!0;if(_.each(_.union(s,o),function(e){if(2===e.length)switch(e[0]){case OpenPgpResult.Enum.GenerateKeyError:a=Utils.i18n("OPENPGP/ERROR_GENERATE_KEY");break;case OpenPgpResult.Enum.ImportKeyError:a=Utils.i18n("OPENPGP/ERROR_IMPORT_KEY");break;case OpenPgpResult.Enum.ImportNoKeysFoundError:a=Utils.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_FOUND");break;case OpenPgpResult.Enum.PrivateKeyNotFoundError:case OpenPgpResult.Enum.PrivateKeyNotFoundNotice:r.push(e[1]);break;case OpenPgpResult.Enum.PublicKeyNotFoundError:p=!1,n.push(e[1]);break;case OpenPgpResult.Enum.PublicKeyNotFoundNotice:n.push(e[1]);break;case OpenPgpResult.Enum.KeyIsNotDecodedError:t===Enums.PgpAction.DecryptVerify?a=Utils.i18n("OPENPGP/ERROR_DECRYPT")+" "+Utils.i18n("OPENPGP/ERROR_KEY_NOT_DECODED",{USER:e[1]}):(t===Enums.PgpAction.Sign||t===Enums.PgpAction.EncryptSign)&&(a=Utils.i18n("OPENPGP/ERROR_SIGN")+" "+Utils.i18n("OPENPGP/ERROR_KEY_NOT_DECODED",{USER:e[1]}));break;case OpenPgpResult.Enum.SignError:a=Utils.i18n("OPENPGP/ERROR_SIGN");break;case OpenPgpResult.Enum.VerifyError:a=Utils.i18n("OPENPGP/ERROR_VERIFY");break;case OpenPgpResult.Enum.EncryptError:a=Utils.i18n("OPENPGP/ERROR_ENCRYPT");break;case OpenPgpResult.Enum.DecryptError:a=Utils.i18n("OPENPGP/ERROR_DECRYPT");break;case OpenPgpResult.Enum.SignAndEncryptError:a=Utils.i18n("OPENPGP/ERROR_ENCRYPT_OR_SIGN");break;case OpenPgpResult.Enum.VerifyAndDecryptError:a=Utils.i18n("OPENPGP/ERROR_DECRYPT_OR_VERIFY");break;case OpenPgpResult.Enum.DeleteError:a=Utils.i18n("OPENPGP/ERROR_DELETE_KEY");break;case OpenPgpResult.Enum.VerifyErrorNotice:a=Utils.i18n("OPENPGP/ERROR_VERIFY");break;case OpenPgpResult.Enum.NoSignDataNotice:l=!0}}),n.length>0?(n=_.without(n,""),n.length>0?a=Utils.i18n("OPENPGP/ERROR_NO_PUBLIC_KEYS_FOR_USERS_PLURAL",{USERS:n.join(", ")},null,n.length):t===Enums.PgpAction.Verify&&(a=Utils.i18n("OPENPGP/ERROR_NO_PUBLIC_KEY_FOUND_FOR_VERIFY")),p&&""!==a&&(a+=" "+Utils.i18n("OPENPGP/ERROR_MESSAGE_WAS_NOT_VERIFIED"))):r.length>0&&(r=_.without(r,""),r.length>0?a=Utils.i18n("OPENPGP/ERROR_NO_PRIVATE_KEYS_FOR_USERS_PLURAL",{USERS:r.join(", ")},null,r.length):t===Enums.PgpAction.DecryptVerify&&(a=Utils.i18n("OPENPGP/ERROR_NO_PRIVATE_KEY_FOUND_FOR_DECRYPT"))),""===a&&!l){switch(t){case Enums.PgpAction.Generate:a=Utils.i18n("OPENPGP/ERROR_GENERATE_KEY");break;case Enums.PgpAction.Import:a=Utils.i18n("OPENPGP/ERROR_IMPORT_KEY");break;case Enums.PgpAction.DecryptVerify:a=Utils.i18n("OPENPGP/ERROR_DECRYPT");break;case Enums.PgpAction.Verify:a=Utils.i18n("OPENPGP/ERROR_VERIFY");break;case Enums.PgpAction.Encrypt:a=Utils.i18n("OPENPGP/ERROR_ENCRYPT");break;case Enums.PgpAction.EncryptSign:a=Utils.i18n("OPENPGP/ERROR_ENCRYPT_OR_SIGN");break;case Enums.PgpAction.Sign:a=Utils.i18n("OPENPGP/ERROR_SIGN")}a=i}return""!==a&&App.Api.showError(a),l},CApi.prototype.showErrorByCode=function(e,t,i){var s=e.ErrorCode,o=e.ErrorMessage||"",n="";switch(s){default:n=t;break;case Enums.Errors.AuthError:n=Utils.i18n("WARNING/LOGIN_PASS_INCORRECT");break;case Enums.Errors.DataBaseError:n=Utils.i18n("WARNING/DATABASE_ERROR");break;case Enums.Errors.LicenseProblem:n=Utils.i18n("WARNING/INVALID_LICENSE");break;case Enums.Errors.DemoLimitations:n=Utils.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED");break;case Enums.Errors.Captcha:n=Utils.i18n("WARNING/CAPTCHA_IS_INCORRECT");break;case Enums.Errors.CanNotGetMessage:n=Utils.i18n("MESSAGE/ERROR_MESSAGE_DELETED");break;case Enums.Errors.NoRequestedMailbox:n=t+" "+Utils.i18n("COMPOSE/ERROR_INVALID_ADDRESS",{ADDRESS:e.Mailbox||""});break;case Enums.Errors.CanNotChangePassword:n=Utils.i18n("WARNING/UNABLE_CHANGE_PASSWORD");break;case Enums.Errors.AccountOldPasswordNotCorrect:n=Utils.i18n("WARNING/CURRENT_PASSWORD_NOT_CORRECT");break;case Enums.Errors.FetcherIncServerNotAvailable:n=Utils.i18n("WARNING/FETCHER_SAVE_ERROR");break;case Enums.Errors.FetcherLoginNotCorrect:n=Utils.i18n("WARNING/FETCHER_SAVE_ERROR");break;case Enums.Errors.HelpdeskUserNotExists:n=Utils.i18n("HELPDESK/ERROR_FORGOT_NO_ACCOUNT");break;case Enums.Errors.MailServerError:n=Utils.i18n("WARNING/CANT_CONNECT_TO_SERVER");break;case Enums.Errors.DataTransferFailed:n=Utils.i18n("WARNING/DATA_TRANSFER_FAILED");break;case Enums.Errors.NotDisplayedError:n=""}""!==n?(""!==o&&(n+=" ("+o+")"),this.showError(n,!1,!!i)):""!==o&&this.showError(o)},CApi.prototype.showErrorIfAttachmentSizeLimit=function(e,t){var i=Utils.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:e,MAXSIZE:Utils.friendlySize(AppData.App.AttachmentSizeLimit)});return AppData.App.AttachmentSizeLimit>0&&t>AppData.App.AttachmentSizeLimit?(App.Screens.showPopup(AlertPopup,[i]),!0):!1},CApi.prototype.deleteMessages=function(e,t,i){Utils.isFunc(i)||(i=function(){});var s=App.MailCache.folderList(),o=s.currentFolderFullName(),n=s.trashFolder(),r=n&&o===n.fullName(),a=s.spamFolder(),l=a&&o===a.fullName(),p=function(s){s&&(t.MailCache.deleteMessages(e),i())};l?(t.MailCache.deleteMessages(e),i()):r?App.Screens.showPopup(ConfirmPopup,[Utils.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),p]):n?(t.MailCache.moveMessagesToFolder(n.fullName(),e),i()):n||App.Screens.showPopup(ConfirmPopup,[Utils.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),p])},CApi.prototype.contactCreate=function(e,t,i,s){},AfterLogicApi.addScreenToHeader=function(e,t,i,s,o){App.addScreenToHeader(e,t,i,s,o,!0)},AfterLogicApi.setDefaultTab=function(e){var t=!!_.find(Enums.Screens,function(t){return t===e});t&&(AppData.App.DefaultTab=e)},AfterLogicApi.aSettingsTabs=[],AfterLogicApi.addSettingsTab=function(e){e.prototype.TabName&&(Enums.SettingsTab[e.prototype.TabName]=e.prototype.TabName,AfterLogicApi.aSettingsTabs.push(e))},AfterLogicApi.getPluginsSettingsTabs=function(){return AfterLogicApi.aSettingsTabs},AfterLogicApi.getSetting=function(e){return AppData.App[e]},AfterLogicApi.getPluginSettings=function(e){return AppData&&AppData.Plugins?AppData.Plugins[e]:null},AfterLogicApi.oPluginHooks={},AfterLogicApi.addPluginHook=function(e,t){Utils.isFunc(t)&&($.isArray(this.oPluginHooks[e])||(this.oPluginHooks[e]=[]),this.oPluginHooks[e].push(t))},AfterLogicApi.runPluginHook=function(e,t){$.isArray(this.oPluginHooks[e])&&(t=t||[],_.each(this.oPluginHooks[e],function(e){e.apply(null,t)}))},AfterLogicApi.sendAjaxRequest=function(e,t,i){App.Ajax.send(e,t,i)},AfterLogicApi.i18n=Utils.i18n,AfterLogicApi.getArrayRecipients=Utils.Address.getArrayRecipients,AfterLogicApi.getEmailParts=Utils.Address.getEmailParts,AfterLogicApi.isCorrectEmail=Utils.Address.isCorrectEmail,AfterLogicApi.showAlertPopup=function(e){App.Screens.showPopup(AlertPopup,[e])},AfterLogicApi.showConfirmPopup=function(e,t){App.Screens.showPopup(ConfirmPopup,[e,t])},AfterLogicApi.showPopup=function(e,t){App.Screens.showPopup(e,t)},AfterLogicApi.showReport=function(e,t){App.Screens.showReport(e,t)},AfterLogicApi.showError=function(e){App.Screens.showError(e)},AfterLogicApi.getPrimaryAccountData=function(){var e=AppData.Accounts.getDefault();return{Id:e.id(),Email:e.email(),FriendlyName:e.friendlyName()}},AfterLogicApi.getCurrentAccountData=function(){var e=AppData.Accounts.getCurrent();return{Id:e.id(),Email:e.email(),FriendlyName:e.friendlyName()}},AfterLogicApi.isMobile=function(){return this.getAppDataItem("IsMobile")},AfterLogicApi.getRequestParam=Utils.Common.getRequestParam,AfterLogicApi.editedFolderList=function(){return App.MailCache.editedFolderList},AfterLogicApi.FileSizeLimit=AppData.App.FileSizeLimit,AfterLogicApi.isFunc=Utils.isFunc,AfterLogicApi.isUnd=Utils.isUnd,AfterLogicApi.emptyFunction=Utils.emptyFunction,AfterLogicApi.getAppDataItem=function(e){return AppData&&AppData[e]?AppData[e]:null},AfterLogicApi.WindowOpener=Utils.WindowOpener,AfterLogicApi.getAppPath=Utils.Common.getAppPath,AfterLogicApi.loadScript=Utils.loadScript,AfterLogicApi.createObjectInstance=function(sClassName){var oReg=new RegExp("^[a-zA-Z]+$");return oReg.test(sClassName)?eval("new "+sClassName+"()"):null},CStorage.prototype.hasData=function(e){var t=this.bHtml5?localStorage.getItem(e):$.cookie(e);return!!t},CStorage.prototype.getData=function(e){var t=this.bHtml5?localStorage.getItem(e):$.cookie(e);return $.parseJSON(t)},CStorage.prototype.setData=function(e,t){var i=JSON.stringify(t);this.bHtml5?localStorage.setItem(e,i):$.cookie(e,i,{expires:30})},CStorage.prototype.removeData=function(e){this.bHtml5?localStorage.removeItem(e):$.cookie(e,null)},CStorage.prototype.init=function(){if("undefined"==typeof Storage)this.bHtml5=!1;else try{localStorage.setItem("check","val"),localStorage.removeItem("check")}catch(e){this.bHtml5=!1}},OpenPgp.prototype.pgp=null,OpenPgp.prototype.pgpKeyring=null,OpenPgp.prototype.keys=[],OpenPgp.prototype.getKeys=function(){return this.keys()},OpenPgp.prototype.getKeysObservable=function(){return this.keys},OpenPgp.prototype.reloadKeysFromStorage=function(){var e=[],t=this.pgpKeyring.getAllKeys();_.each(t,function(t){t&&t.primaryKey&&e.push(new OpenPgpKey(t))}),this.keys(e)},OpenPgp.prototype.convertToNativeKeys=function(e){return _.map(e,function(e){return e&&e.pgpKey?e.pgpKey:e})},OpenPgp.prototype.cloneKey=function(e){var t=null;return e&&(t=this.pgp.key.readArmored(e.armor()),t&&!t.err&&t.keys&&t.keys[0]?(t=t.keys[0],t&&t.primaryKey||(t=null)):t=null),t},OpenPgp.prototype.decryptKeyHelper=function(e,t,i,s){if(t)try{t.decrypt(Utils.pString(i)),t&&t.primaryKey&&t.primaryKey.isDecrypted||e.addError(OpenPgpResult.Enum.KeyIsNotDecodedError,s||"")}catch(o){e.addExceptionMessage(o,OpenPgpResult.Enum.KeyIsNotDecodedError,s||"")}else e.addError(OpenPgpResult.Enum.KeyIsNotDecodedError,s||"")},OpenPgp.prototype.verifyMessageHelper=function(e,t,i){var s=!1,o=null,n=[],r=[],a=[];if(i&&i.getSigningKeyIds)if(r=i.getSigningKeyIds(),r&&0<r.length)if(a=this.findKeysByEmails([t],!0),a&&0!==a.length){n=[];try{n=i.verify(this.convertToNativeKeys(a))}catch(l){e.addNotice(OpenPgpResult.Enum.VerifyErrorNotice,t)}n&&0<n.length&&(o=_.find(n,function(e){return e&&e.keyid&&e.valid}),o&&o.keyid&&a&&a[0]&&o.keyid.toHex().toLowerCase()===a[0].getId()?s=!0:e.addNotice(OpenPgpResult.Enum.VerifyErrorNotice,t))}else e.addNotice(OpenPgpResult.Enum.PublicKeyNotFoundNotice,t);else e.addNotice(OpenPgpResult.Enum.NoSignDataNotice);else e.addError(OpenPgpResult.Enum.UnknownError);return s||e.hasNotices()||e.addNotice(OpenPgpResult.Enum.VerifyErrorNotice),s},OpenPgp.prototype.generateKey=function(e,t,i){var s=new OpenPgpResult,o=null;try{o=this.pgp.generateKeyPair({userId:e,numBits:Utils.pInt(i),passphrase:Utils.trim(t)})}catch(n){s.addExceptionMessage(n)}if(o&&o.privateKeyArmored)try{this.pgpKeyring.privateKeys.importKey(o.privateKeyArmored),this.pgpKeyring.publicKeys.importKey(o.publicKeyArmored),this.pgpKeyring.store()}catch(n){s.addExceptionMessage(n,OpenPgpResult.Enum.GenerateKeyError)}else s.addError(OpenPgpResult.Enum.GenerateKeyError);return this.reloadKeysFromStorage(),s},OpenPgp.prototype.splitKeys=function(e){var t=[],i=0,s=30,o=null,n=Utils.trim(e),r=/[\-]{3,6}BEGIN[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}[\s\S]+?[\-]{3,6}END[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}/gi;for(n=n.replace(/[\r\n]([a-zA-Z0-9]{2,}:[^\r\n]+)[\r\n]+([a-zA-Z0-9\/\\+=]{10,})/g,"\n$1---xyx---$2").replace(/[\n\r]+/g,"\n").replace(/---xyx---/g,"\n\n");;){if(o=r.exec(n),!o||0>s)break;o[0]&&o[1]&&o[2]&&o[1]===o[2]&&("PRIVATE"===o[1]||"PUBLIC"===o[1])&&(t.push([o[1],o[0]]),i++),s--}return t},OpenPgp.prototype.importKeys=function(e){e=Utils.trim(e);var t=0,i=0,s=new OpenPgpResult,o=null,n=[];if(!e)return s.addError(OpenPgpResult.Enum.InvalidArgumentErrors);for(n=this.splitKeys(e),t=0;t<n.length;t++)if(o=n[t],"PRIVATE"===o[0])try{this.pgpKeyring.privateKeys.importKey(o[1]),i++}catch(r){s.addExceptionMessage(r,OpenPgpResult.Enum.ImportKeyError,"private")}else if("PUBLIC"===o[0])try{this.pgpKeyring.publicKeys.importKey(o[1]),i++}catch(r){s.addExceptionMessage(r,OpenPgpResult.Enum.ImportKeyError,"public")}return i>0?this.pgpKeyring.store():s.addError(OpenPgpResult.Enum.ImportNoKeysFoundError),this.reloadKeysFromStorage(),s},OpenPgp.prototype.getArmorInfo=function(e){e=Utils.trim(e);var t=0,i=0,s=null,o=[],n=null,r=[];if(!e)return!1;for(r=this.splitKeys(e),t=0;t<r.length;t++)if(n=r[t],"PRIVATE"===n[0])try{s=this.pgp.key.readArmored(n[1]),
s&&!s.err&&s.keys&&s.keys[0]&&o.push(new OpenPgpKey(s.keys[0])),i++}catch(a){o.push(null)}else if("PUBLIC"===n[0])try{s=this.pgp.key.readArmored(n[1]),s&&!s.err&&s.keys&&s.keys[0]&&o.push(new OpenPgpKey(s.keys[0])),i++}catch(a){o.push(null)}return o},OpenPgp.prototype.findKeyByID=function(e,t){t=!!t,e=e.toLowerCase();var i=_.find(this.keys(),function(i){var s=!1,o=null;return i&&t===i.isPublic()&&(o=i.pgpKey.getKeyIds(),o&&(s=_.find(o,function(t){return t&&t.toHex&&e===t.toHex().toLowerCase()}))),!!s});return i?i:null},OpenPgp.prototype.findKeysByEmails=function(e,t,i){t=!!t;var s=[],o=this.keys();return _.each(e,function(e){var n=_.find(o,function(i){return i&&t===i.isPublic()&&e===i.getEmail()});n?s.push(n):i&&i.addError(t?OpenPgpResult.Enum.PublicKeyNotFoundError:OpenPgpResult.Enum.PrivateKeyNotFoundError,e)}),s},OpenPgp.prototype.decryptAndVerify=function(e,t,i,s){var o=this,n=null,r=null,a=null,l=null,p=null,h=new OpenPgpResult,c=[];if(n=this.pgp.message.readArmored(e),n&&n.decrypt)if(c=n.getEncryptionKeyIds(),c&&(a=null,r=null,_.each(c,function(e){r||(r=o.findKeyByID(e.toHex(),!1),r&&t!==r.getEmail()&&(r=null))}),r&&(a=r),a||_.each(c,function(e){a||(a=o.findKeyByID(e.toHex(),!1))})),a){if(l=this.cloneKey(this.convertToNativeKeys([a])[0]),this.decryptKeyHelper(h,l,s,a.getEmail()),l&&!h.hasErrors())try{p=n.decrypt(l)}catch(u){h.addExceptionMessage(u,OpenPgpResult.Enum.DecryptError),p=null}p&&!h.hasErrors()&&(this.verifyMessageHelper(h,i,p),h.result=p.getText())}else h.addError(OpenPgpResult.Enum.PrivateKeyNotFoundError);return h},OpenPgp.prototype.verify=function(e,t){var i=null,s=new OpenPgpResult;return i=this.pgp.cleartext.readArmored(e),i&&i.getText&&i.verify?(this.verifyMessageHelper(s,t,i),s.result=i.getText()):s.addError(OpenPgpResult.Enum.CanNotReadMessage),s},OpenPgp.prototype.encrypt=function(e,t){var i=new OpenPgpResult,s=this.findKeysByEmails(t,!0,i);if(!i.hasErrors())try{i.result=this.pgp.encryptMessage(this.convertToNativeKeys(s),e)}catch(o){i.addExceptionMessage(o,OpenPgpResult.Enum.EncryptError)}return i},OpenPgp.prototype.sign=function(e,t,i){var s=new OpenPgpResult,o=null,n=null,r=this.findKeysByEmails([t],!1,s);if(!s.hasErrors()&&(o=this.convertToNativeKeys(r)[0],n=this.cloneKey(o),this.decryptKeyHelper(s,n,i,t),n&&!s.hasErrors()))try{s.result=this.pgp.signClearMessage([n],e)}catch(a){s.addExceptionMessage(a,OpenPgpResult.Enum.SignError,t)}return s},OpenPgp.prototype.signAndEncrypt=function(e,t,i,s){var o=null,n=null,r=new OpenPgpResult,a=this.findKeysByEmails([t],!1,r),l=this.findKeysByEmails(i,!0,r);if(!r.hasErrors()&&(o=this.convertToNativeKeys(a)[0],n=this.cloneKey(o),this.decryptKeyHelper(r,n,s,t),n&&!r.hasErrors()))try{r.result=this.pgp.signAndEncryptMessage(this.convertToNativeKeys(l),n,e)}catch(p){r.addExceptionMessage(p,OpenPgpResult.Enum.SignAndEncryptError)}return r},OpenPgp.prototype.deleteKey=function(e){var t=new OpenPgpResult;if(e)try{this.pgpKeyring[e.isPrivate()?"privateKeys":"publicKeys"].removeForId(e.getFingerprint()),this.pgpKeyring.store()}catch(i){t.addExceptionMessage(i,OpenPgpResult.Enum.DeleteError)}else t.addError(e?OpenPgpResult.Enum.UnknownError:OpenPgpResult.Enum.InvalidArgumentError);return this.reloadKeysFromStorage(),t},OpenPgpKey.prototype.pgpKey=null,OpenPgpKey.prototype.emailParts=null,OpenPgpKey.prototype.user="",OpenPgpKey.prototype.getId=function(){return this.pgpKey.primaryKey.getKeyId().toHex().toLowerCase()},OpenPgpKey.prototype.getEmail=function(){return this.emailParts.email||this.user},OpenPgpKey.prototype.getUser=function(){return this.user},OpenPgpKey.prototype.getFingerprint=function(){return this.pgpKey.primaryKey.getFingerprint()},OpenPgpKey.prototype.getBitSize=function(){return this.pgpKey.primaryKey.getBitSize()},OpenPgpKey.prototype.getArmor=function(){return this.pgpKey.armor()},OpenPgpKey.prototype.isPrivate=function(){return!!this.pgpKey.isPrivate()},OpenPgpKey.prototype.isPublic=function(){return!this.isPrivate()},OpenPgpResult.Enum={UnknownError:0,UnknownNotice:1,InvalidArgumentError:2,GenerateKeyError:10,ImportKeyError:20,ImportNoKeysFoundError:21,PrivateKeyNotFoundError:30,PublicKeyNotFoundError:31,KeyIsNotDecodedError:32,SignError:40,VerifyError:41,EncryptError:42,DecryptError:43,SignAndEncryptError:44,VerifyAndDecryptError:45,CanNotReadMessage:50,CanNotReadKey:51,DeleteError:60,PublicKeyNotFoundNotice:70,PrivateKeyNotFoundNotice:71,VerifyErrorNotice:72,NoSignDataNotice:73},OpenPgpResult.prototype.result=!1,OpenPgpResult.prototype.errors=null,OpenPgpResult.prototype.notices=null,OpenPgpResult.prototype.addError=function(e,t){return this.result=!1,this.errors=this.errors||[],this.errors.push([e||OpenPgpResult.Enum.UnknownError,t||""]),this},OpenPgpResult.prototype.addNotice=function(e,t){return this.notices=this.notices||[],this.notices.push([e||OpenPgpResult.Enum.UnknownNotice,t||""]),this},OpenPgpResult.prototype.addExceptionMessage=function(e,t,i){return e&&(this.result=!1,this.exceptions=this.exceptions||[],this.exceptions.push(""+(e.name||"unknown")+": "+(e.message||""))),Utils.isUnd(t)||this.addError(t,i),this},OpenPgpResult.prototype.hasErrors=function(){return this.errors&&0<this.errors.length},OpenPgpResult.prototype.hasNotices=function(){return this.notices&&0<this.notices.length},AlertPopup.prototype.onShow=function(e,t,i,s){this.alertDesc(e),this.closeCallback=t||null,this.title(i||""),this.okButtonText(s||Utils.i18n("MAIN/BUTTON_OK"))},AlertPopup.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"},AlertPopup.prototype.onEnterHandler=function(){this.close()},AlertPopup.prototype.close=function(){Utils.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand()},ConfirmPopup.prototype.onShow=function(e,t,i,s,o){this.confirmDesc(e),this.title(i||""),this.okButtonText(s||Utils.i18n("MAIN/BUTTON_OK")),this.cancelButtonText(o||Utils.i18n("MAIN/BUTTON_CANCEL")),Utils.isFunc(t)&&(this.fConfirmCallback=t),this.shown=!0},ConfirmPopup.prototype.onHide=function(){this.shown=!1},ConfirmPopup.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"},ConfirmPopup.prototype.onEnterHandler=function(){this.yesClick()},ConfirmPopup.prototype.yesClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(!0),this.closeCommand()},ConfirmPopup.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1),this.closeCommand()},ConfirmPopup.prototype.onEscHandler=function(){this.noClick()},ChangePasswordPopup.prototype.onShow=function(e,t,i){this.isHelpdesk(e),this.hasOldPassword(t),this.fOnPasswordChangedCallback=i,this.currentPassword(""),this.newPassword(""),this.confirmPassword("")},ChangePasswordPopup.prototype.popupTemplate=function(){return"Popups_ChangePasswordPopupViewModel"},ChangePasswordPopup.prototype.onUpdatePasswordResponse=function(e,t){e.Result===!1?App.Api.showErrorByCode(e,Utils.i18n("SETTINGS/ACCOUNT_PROPERTIES_NEW_PASSWORD_UPDATE_ERROR")):(App.Api.showReport(this.hasOldPassword()?Utils.i18n("SETTINGS/ACCOUNT_PROPERTIES_CHANGE_PASSWORD_SUCCESS"):Utils.i18n("SETTINGS/ACCOUNT_PROPERTIES_SET_PASSWORD_SUCCESS")),this.closeCommand(),"function"==typeof this.fOnPasswordChangedCallback&&this.fOnPasswordChangedCallback(),App.sResetPassHash="")},ChangePasswordPopup.prototype.onOKClick=function(){var e=null;this.confirmPassword()!==this.newPassword()?App.Api.showError(Utils.i18n("WARNING/PASSWORDS_DO_NOT_MATCH")):this.newPassword().length<AppData.App.PasswordMinLength?App.Api.showError(Utils.i18n("WARNING/PASSWORDS_MIN_LENGTH_ERROR").replace("%N%",AppData.App.PasswordMinLength)):!AppData.App.PasswordMustBeComplex||this.newPassword().match(/([0-9])/)&&this.newPassword().match(/([!,%,&,@,#,$,^,*,?,_,~])/)?this.isHelpdesk()?(e={Action:"HelpdeskUserPasswordUpdate",CurrentPassword:this.currentPassword(),NewPassword:this.newPassword()},App.Ajax.sendExt(e,this.onUpdatePasswordResponse,this)):(e={Action:"AccountUpdatePassword",AccountID:AppData.Accounts.editedId(),CurrentIncomingMailPassword:this.currentPassword(),NewIncomingMailPassword:this.newPassword(),Hash:App.sResetPassHash},App.Ajax.send(e,this.onUpdatePasswordResponse,this)):App.Api.showError(Utils.i18n("WARNING/PASSWORD_MUST_BE_COMPLEX"))},ChangePasswordPopup.prototype.onCancelClick=function(){this.closeCommand()},CImportOpenPgpKeyPopup.prototype.onShow=function(e,t){this.pgp=e,this.keyArmor(t||""),this.keyArmorFocused(!0),this.keys([]),this.hasExistingKeys(!1),""!==this.keyArmor()&&this.checkArmor()},CImportOpenPgpKeyPopup.prototype.popupTemplate=function(){return"Popups_ImportOpenPgpKeyPopupViewModel"},CImportOpenPgpKeyPopup.prototype.checkArmor=function(){var e=null,t=[],i=this.pgp,s=!1;""===this.keyArmor()?this.keyArmorFocused(!0):i&&(e=i.getArmorInfo(this.keyArmor()),Utils.isNonEmptyArray(e)&&_.each(e,function(e){if(e){var o=i.findKeyByID(e.getId(),e.isPublic()),n=null!==o,r=e.isPublic()?"OPENPGP/PUBLIC_KEY_ADD_INFO":"OPENPGP/PRIVATE_KEY_ADD_INFO";s=s||n,t.push({armor:e.getArmor(),email:e.user,id:e.getId(),addInfo:Utils.i18n(r,{LENGTH:e.getBitSize()}),needToImport:ko.observable(!n),disabled:n})}}),0===t.length&&App.Api.showError(Utils.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_FOUND")),this.keys(t),this.hasExistingKeys(s))},CImportOpenPgpKeyPopup.prototype.importKey=function(){var e=null,t=[];this.pgp&&(_.each(this.keys(),function(e){e.needToImport()&&t.push(e.armor)}),t.length>0?(e=this.pgp.importKeys(t.join("")),e&&e.result&&App.Api.showReport(Utils.i18n("OPENPGP/REPORT_KEY_SUCCESSFULLY_IMPORTED_PLURAL",{},null,t.length)),e&&!e.result&&App.Api.showPgpErrorByCode(e,Enums.PgpAction.Import,Utils.i18n("OPENPGP/ERROR_IMPORT_KEY")),this.closeCommand()):App.Api.showError(Utils.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_SELECTED")))},ContactCreatePopup.prototype.popupTemplate=function(){return"Popups_ContactCreatePopupViewModel"},ContactCreatePopup.prototype.onShow=function(e,t,i,s){(this.displayName()!==e||this.email()!==t)&&(this.displayName(e),this.email(t),this.phone(""),this.address(""),this.skype(""),this.facebook("")),Utils.isFunc(i)&&(this.fCallback=i),s&&(this.oContext=s)},ContactCreatePopup.prototype.onSaveClick=function(){if(this.canBeSave()){if(!this.loading()){var e={Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:this.displayName(),HomeEmail:this.email(),HomePhone:this.phone(),HomeStreet:this.address(),Skype:this.skype(),Facebook:this.facebook()};this.loading(!0),App.Ajax.send(e,this.onContactCreateResponse,this)}}else App.Api.showError(Utils.i18n("CONTACTS/ERROR_EMPTY_CONTACT"))},ContactCreatePopup.prototype.onCancelClick=function(){this.loading(!1),this.closeCommand()},ContactCreatePopup.prototype.onContactCreateResponse=function(e,t){this.loading(!1),e.Result?(App.Api.showReport(Utils.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),App.ContactsCache.clearInfoAboutEmail(t.HomeEmail),App.ContactsCache.getContactsByEmails([t.HomeEmail],this.fCallback,this.oContext),this.closeCommand()):App.Api.showErrorByCode(e,Utils.i18n("WARNING/CREATING_ACCOUNT_ERROR"))},ContactCreatePopup.prototype.canBeSave=function(){return""!==this.displayName()||""!==this.email()},ContactCreatePopup.prototype.goToContacts=function(){App.ContactsCache.newContactParams={displayName:this.displayName(),email:this.email(),phone:this.phone(),address:this.address(),skype:this.skype(),facebook:this.facebook()},this.closeCommand(),App.Routing.replaceHash(App.Links.contacts())},PlayerPopup.prototype.onShow=function(e){this.iframe(e)},PlayerPopup.prototype.popupTemplate=function(){return"Popups_PlayerPopupViewModel"},PlayerPopup.prototype.onClose=function(){Utils.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand(),this.iframe("")},CAppSettingsModel.prototype.parse=function(e){this.AllowWebMail=!!e.AllowWebMail,this.AllowUsersChangeInterfaceSettings=!!e.AllowUsersChangeInterfaceSettings,this.AllowUsersChangeEmailSettings=!!e.AllowUsersChangeEmailSettings,this.AllowUsersAddNewAccounts=!!e.AllowUsersAddNewAccounts||this.AllowUsersChangeEmailSettings,this.SiteName=Utils.pString(e.SiteName),this.Languages=e.Languages,this.Themes=e.Themes,this.DateFormats=e.DateFormats,this.AttachmentSizeLimit=Utils.pInt(e.AttachmentSizeLimit),this.ImageUploadSizeLimit=Utils.pInt(e.ImageUploadSizeLimit),this.FileSizeLimit=Utils.pInt(e.FileSizeLimit),this.AutoSave=!!e.AutoSave,this.IdleSessionTimeout=60*Utils.pInt(e.IdleSessionTimeout)*1e3,this.AllowInsertImage=!!e.AllowInsertImage,this.AllowBodySize=!!e.AllowBodySize,this.MaxBodySize=Utils.pInt(e.MaxBodySize),this.MaxSubjectSize=Utils.pInt(e.MaxSubjectSize),this.JoinReplyPrefixes=!!e.JoinReplyPrefixes,this.AllowAppRegisterMailto=!!e.AllowAppRegisterMailto,this.AllowPrefetch=!!e.AllowPrefetch,this.LoginFormType=Utils.pInt(e.LoginFormType),this.LoginSignMeType=Utils.pInt(e.LoginSignMeType),this.LoginAtDomainValue=Utils.pString(e.LoginAtDomainValue),this.AllowRegistration=!!e.AllowRegistration,this.AllowPasswordReset=!!e.AllowPasswordReset,this.RegistrationDomains=e.RegistrationDomains,this.RegistrationQuestions=_.without(e.RegistrationQuestions,""),this.DemoWebMail=!!e.DemoWebMail,this.DemoWebMailLogin=Utils.pString(e.DemoWebMailLogin),this.DemoWebMailPassword=Utils.pString(e.DemoWebMailPassword),this.GoogleAnalyticsAccount=e.GoogleAnalyticsAccount,this.ShowQuotaBar=!!e.ShowQuotaBar,this.ServerUseUrlRewrite=!!e.ServerUseUrlRewrite,this.AllowLanguageOnLogin=!bMobileApp&&!!e.AllowLanguageOnLogin,this.FlagsLangSelect=!!e.FlagsLangSelect,this.DefaultLanguage=Utils.pString(e.DefaultLanguage),this.LoginDescription=Utils.pString(e.LoginDescription),this.CustomLoginUrl=Utils.pString(e.CustomLoginUrl),this.CustomLogoutUrl=Utils.pString(e.CustomLogoutUrl),this.IosDetectOnLogin=!!e.IosDetectOnLogin,this.AllowContactsSharing=!!e.AllowContactsSharing,""!==e.DefaultLanguageShort&&(this.DefaultLanguageShort=e.DefaultLanguageShort),this.DefaultTab=e.DefaultTab,this.AllowIosProfile=!!e.AllowIosProfile,this.PasswordMinLength=e.PasswordMinLength,this.PasswordMustBeComplex=!!e.PasswordMustBeComplex},CDateModel.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=moment.unix(this.iTimeStampInUTC)},CDateModel.prototype.setDate=function(e,t,i){this.oMoment=moment([e,t,i])},CDateModel.prototype.getTimeFormat=function(){return AppData.User.defaultTimeFormat()===Enums.TimeFormat.F24?"HH:mm":"hh:mm A"},CDateModel.prototype.getFullDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY, "+this.getTimeFormat()):""},CDateModel.prototype.getMidDate=function(){return this.getShortDate(!0)},CDateModel.prototype.getShortDate=function(e){var t="",i=null;return this.oMoment&&(i=moment(),i.format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=i.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?Utils.i18n("DATETIME/YESTERDAY"):this.oMoment.format(i.year()===this.oMoment.year()?"MMM D":"MMM D, YYYY"),(Utils.isUnd(e)?1:!e)||(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},CDateModel.prototype.getDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY"):""},CDateModel.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},CDateModel.prototype.convertDate=function(e){var t=Utils.getDateFormatForMoment(AppData.User.DefaultDateFormat)+" "+this.getTimeFormat();return moment(1e3*e).format(t)},CDateModel.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},CCommonFileModel.prototype.dataObjectName="",CCommonFileModel.prototype.isVisibleViewLink=function(){return this.uploaded()&&!this.uploadError()&&this.isViewMimeType()},CCommonFileModel.prototype.parse=function(e,t){e["@Object"]===this.dataObjectName&&(this.fileName(Utils.pString(e.FileName)),this.tempName(Utils.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.type(Utils.pString(e.MimeType)),this.size(e.EstimatedSize?parseInt(e.EstimatedSize,10):parseInt(e.SizeInBytes,10)),this.content(Utils.pString(e.Content)),this.thumb(!!e.Thumb),this.hash(Utils.pString(e.Hash)),this.accountId(t),this.allowExpandSubFiles(!!e.Expand),this.iframedView(!!e.Iframed),this.uploadUid(this.hash()),this.uploaded(!0),Utils.isFunc(this.additionalParse)&&this.additionalParse(e))},CCommonFileModel.prototype.getInThumbQueue=function(e){this.thumbnailSessionUid(e),this.thumb()&&(!this.linked||this.linked&&!this.linked())&&Utils.thumbQueue(this.thumbnailSessionUid(),this.thumbnailLink(),this.thumbnailSrc)},CCommonFileModel.prototype.downloadFile=function(e){this.allowDownload()&&(e&&e.Api&&e.Api.downloadByUrl||(e=App),e&&this.downloadLink().length>0&&"#"!==this.downloadLink()&&e.Api.downloadByUrl(this.downloadLink()))},CCommonFileModel.prototype.onFileExpandResponse=function(e,t){this.subFiles([]),Utils.isNonEmptyArray(e.Result)&&(_.each(e.Result,_.bind(function(e){var t=this.getInstance();e["@Object"]=this.dataObjectName,t.parse(e,this.accountId()),this.subFiles.push(t)},this)),this.subFilesLoaded(!0),this.subFilesCollapsed(!0)),this.subFilesStartedLoading(!1)},CCommonFileModel.prototype.expandFile=function(){this.subFilesLoaded()?this.subFilesCollapsed(!0):(this.subFilesStartedLoading(!0),App.Ajax.send({Action:"FileExpand",RawKey:this.hash()},this.onFileExpandResponse,this))},CCommonFileModel.prototype.collapseFile=function(){this.subFilesCollapsed(!1)},CCommonFileModel.prototype.getInstance=function(){return new CCommonFileModel},CCommonFileModel.prototype.importFile=function(){var e=this.content(),t=_.bind(function(t){t&&App.Screens.showPopup(CImportOpenPgpKeyPopup,[t,e])},this);App.Api.pgp(t,AppData.User.IdUser)},CCommonFileModel.prototype.downloadOrViewByIconClick=function(e,t,i){""!==this.oembed()?this.viewFile(e,t):this.allowSelect()||this.downloadFile(i)},CCommonFileModel.prototype.viewFile=function(e,t){Utils.calmEvent(t),this.viewCommonFile()},CCommonFileModel.prototype.openLink=function(){Utils.WindowOpener.openTab(this.viewLink())},CCommonFileModel.prototype.viewCommonFile=function(){var e=Utils.Common.getAppPath()+this.viewLink(),t=null;this.visibleViewLink()&&this.viewLink().length>0&&"#"!==this.viewLink()&&(this.isLink()&&(e=this.linkUrl()),""!==this.oembedHtml()?App.Api.showPlayer(this.oembedHtml()):t=this.iframedView()?Utils.WindowOpener.openTab(e):Utils.WindowOpener.open(e,e,!1),t&&t.focus())},CCommonFileModel.prototype.eventDragStart=function(e,t){var i=t.originalEvent||t;return e&&i&&i.dataTransfer&&i.dataTransfer.setData&&i.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},CCommonFileModel.prototype.generateTransferDownloadUrl=function(){var e=this.downloadLink();return"http"!==e.substr(0,4)&&(e=Utils.Common.getAppPath()+e),this.type()+":"+this.fileName()+":"+e},CCommonFileModel.prototype.onUploadSelect=function(e,t){this.fileName(Utils.pString(t.FileName)),this.type(Utils.pString(t.Type)),this.size(Utils.pInt(t.Size)),this.uploadUid(e),this.uploaded(!1),this.visibleSpinner(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},CCommonFileModel.prototype.onUploadStart=function(){this.visibleSpinner(!0),this.visibleProgress(!0)},CCommonFileModel.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},CCommonFileModel.prototype.onUploadComplete=function(e,t,i){var s=!t||!i||i.Error||!1,o=Utils.i18n(i&&"size"===i.Error?"COMPOSE/UPLOAD_ERROR_SIZE":"COMPOSE/UPLOAD_ERROR_UNKNOWN");this.visibleSpinner(!1),this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(s),this.statusText(s?o:Utils.i18n("COMPOSE/UPLOAD_COMPLETE")),s||(this.fillDataAfterUploadComplete(i,e),setTimeout(function(e){return function(){e.statusText("")}}(this),3e3))},CCommonFileModel.prototype.fillDataAfterUploadComplete=function(e,t){},CCommonFileModel.prototype.onImageLoad=function(e,t){this.thumb()&&!this.thumbnailLoaded()&&(this.thumbnailLoaded(!0),Utils.thumbQueue(this.thumbnailSessionUid()))},CContactModel.birthdayMonths=Utils.getMonthNamesArray(),CContactModel.birthdayMonthSelect=[{text:Utils.i18n("DATETIME/MONTH"),value:"0"},{text:CContactModel.birthdayMonths[0],value:"1"},{text:CContactModel.birthdayMonths[1],value:"2"},{text:CContactModel.birthdayMonths[2],value:"3"},{text:CContactModel.birthdayMonths[3],value:"4"},{text:CContactModel.birthdayMonths[4],value:"5"},{text:CContactModel.birthdayMonths[5],value:"6"},{text:CContactModel.birthdayMonths[6],value:"7"},{text:CContactModel.birthdayMonths[7],value:"8"},{text:CContactModel.birthdayMonths[8],value:"9"},{text:CContactModel.birthdayMonths[9],value:"10"},{text:CContactModel.birthdayMonths[10],value:"11"},{text:CContactModel.birthdayMonths[11],value:"12"}],CContactModel.birthdayYearSelect=[{text:Utils.i18n("DATETIME/YEAR"),value:"0"}],CContactModel.prototype.getSendMailParts=function(e){return App.Links.composeWithToField(this.getFullEmail(e))},CContactModel.prototype.getSendMailLink=function(e){return App.Routing.buildHashFromArray(this.getSendMailParts(e))},CContactModel.prototype.sendMail=function(){return App.Api.composeMessageToAddresses(this.email()),bMobileApp},CContactModel.prototype.sendMailToPersonal=function(){return App.Api.composeMessageToAddresses(this.personalEmail()),bMobileApp},CContactModel.prototype.sendMailToBusiness=function(){return App.Api.composeMessageToAddresses(this.businessEmail()),bMobileApp},CContactModel.prototype.sendMailToOther=function(){return App.Api.composeMessageToAddresses(this.otherEmail()),bMobileApp},CContactModel.prototype.clear=function(){this.isNew(!1),this.readOnly(!1),this.idContact(""),this.idUser(""),this.global(!1),this.itsMe(!1),this.edited(!1),this.extented(!1),this.personalCollapsed(!1),this.businessCollapsed(!1),this.otherCollapsed(!1),this.groupsCollapsed(!1),this.displayName(""),this.firstName(""),this.lastName(""),this.nickName(""),this.skype(""),this.facebook(""),this.primaryEmail(this.sEmailDefaultType),this.primaryPhone(this.sPhoneDefaultType),this.primaryAddress(this.sAddressDefaultType),this.personalEmail(""),this.personalStreetAddress(""),this.personalCity(""),this.personalState(""),this.personalZipCode(""),this.personalCountry(""),this.personalWeb(""),this.personalFax(""),this.personalPhone(""),this.personalMobile(""),this.businessEmail(""),this.businessCompany(""),this.businessDepartment(""),this.businessJob(""),this.businessOffice(""),this.businessStreetAddress(""),this.businessCity(""),this.businessState(""),this.businessZipCode(""),this.businessCountry(""),this.businessWeb(""),this.businessFax(""),this.businessPhone(""),this.otherEmail(""),this.otherBirthdayMonth("0"),this.otherBirthdayDay("0"),this.otherBirthdayYear("0"),this.otherNotes(""),this.etag(""),this.sharedToAll(!1),this.groups([])},CContactModel.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.extented(!1),this.isNew(!0),bMobileApp||this.displayNameFocused(!0)},CContactModel.prototype.switchToView=function(){this.edited(!1),this.extented(!1)},CContactModel.prototype.toObject=function(){var e={ContactId:this.idContact(),PrimaryEmail:this.primaryEmail(),PrimaryPhone:this.primaryPhone(),PrimaryAddress:this.primaryAddress(),UseFriendlyName:"1",Title:"",FullName:this.displayName(),FirstName:this.firstName(),LastName:this.lastName(),NickName:this.nickName(),Global:this.global()?"1":"0",ItsMe:this.itsMe()?"1":"0",Skype:this.skype(),Facebook:this.facebook(),HomeEmail:this.personalEmail(),HomeStreet:this.personalStreetAddress(),HomeCity:this.personalCity(),HomeState:this.personalState(),HomeZip:this.personalZipCode(),HomeCountry:this.personalCountry(),HomeFax:this.personalFax(),HomePhone:this.personalPhone(),HomeMobile:this.personalMobile(),HomeWeb:this.personalWeb(),BusinessEmail:this.businessEmail(),BusinessCompany:this.businessCompany(),BusinessJobTitle:this.businessJob(),BusinessDepartment:this.businessDepartment(),BusinessOffice:this.businessOffice(),BusinessStreet:this.businessStreetAddress(),BusinessCity:this.businessCity(),BusinessState:this.businessState(),BusinessZip:this.businessZipCode(),BusinessCountry:this.businessCountry(),BusinessFax:this.businessFax(),BusinessPhone:this.businessPhone(),BusinessWeb:this.businessWeb(),OtherEmail:this.otherEmail(),Notes:this.otherNotes(),ETag:this.etag(),BirthdayDay:this.otherBirthdayDay(),BirthdayMonth:this.otherBirthdayMonth(),BirthdayYear:this.otherBirthdayYear(),SharedToAll:this.sharedToAll()?"1":"0",GroupsIds:this.groups()};return e},CContactModel.prototype.parse=function(e){if(e&&"Object/CContact"===e["@Object"]){var t=0,i=0,s=0,o=[];switch(this.idContact(Utils.pExport(e,"IdContact","").toString()),this.idUser(Utils.pExport(e,"IdUser","").toString()),this.global(!!Utils.pExport(e,"Global",!1)),this.itsMe(!!Utils.pExport(e,"ItsMe",!1)),this.readOnly(!!Utils.pExport(e,"ReadOnly",!1)),this.displayName(Utils.pExport(e,"FullName","")),this.firstName(Utils.pExport(e,"FirstName","")),this.lastName(Utils.pExport(e,"LastName","")),this.nickName(Utils.pExport(e,"NickName","")),this.skype(Utils.pExport(e,"Skype","")),this.facebook(Utils.pExport(e,"Facebook","")),t=Utils.pInt(Utils.pExport(e,"PrimaryEmail",0))){case 1:t=Enums.ContactEmailType.Business;break;case 2:t=Enums.ContactEmailType.Other;break;default:case 0:t=Enums.ContactEmailType.Personal}switch(this.primaryEmail(t),i=Utils.pInt(Utils.pExport(e,"PrimaryPhone",0))){case 2:i=Enums.ContactPhoneType.Business;break;case 1:i=Enums.ContactPhoneType.Personal;break;default:case 0:i=Enums.ContactPhoneType.Mobile}switch(this.primaryPhone(i),s=Utils.pInt(Utils.pExport(e,"PrimaryAddress",0))){case 1:s=Enums.ContactAddressType.Business;break;default:case 0:s=Enums.ContactAddressType.Personal}this.primaryAddress(s),this.personalEmail(Utils.pExport(e,"HomeEmail","")),this.personalStreetAddress(Utils.pExport(e,"HomeStreet","")),this.personalCity(Utils.pExport(e,"HomeCity","")),this.personalState(Utils.pExport(e,"HomeState","")),this.personalZipCode(Utils.pExport(e,"HomeZip","")),this.personalCountry(Utils.pExport(e,"HomeCountry","")),this.personalWeb(Utils.pExport(e,"HomeWeb","")),this.personalFax(Utils.pExport(e,"HomeFax","")),this.personalPhone(Utils.pExport(e,"HomePhone","")),this.personalMobile(Utils.pExport(e,"HomeMobile","")),this.businessEmail(Utils.pExport(e,"BusinessEmail","")),this.businessCompany(Utils.pExport(e,"BusinessCompany","")),this.businessDepartment(Utils.pExport(e,"BusinessDepartment","")),this.businessJob(Utils.pExport(e,"BusinessJobTitle","")),this.businessOffice(Utils.pExport(e,"BusinessOffice","")),this.businessStreetAddress(Utils.pExport(e,"BusinessStreet","")),this.businessCity(Utils.pExport(e,"BusinessCity","")),this.businessState(Utils.pExport(e,"BusinessState","")),this.businessZipCode(Utils.pExport(e,"BusinessZip","")),this.businessCountry(Utils.pExport(e,"BusinessCountry","")),this.businessWeb(Utils.pExport(e,"BusinessWeb","")),this.businessFax(Utils.pExport(e,"BusinessFax","")),this.businessPhone(Utils.pExport(e,"BusinessPhone","")),this.otherEmail(Utils.pExport(e,"OtherEmail","")),this.otherBirthdayMonth(Utils.pExport(e,"BirthdayMonth","0").toString()),this.otherBirthdayDay(Utils.pExport(e,"BirthdayDay","0").toString()),this.otherBirthdayYear(Utils.pExport(e,"BirthdayYear","0").toString()),this.otherNotes(Utils.pExport(e,"Notes","")),this.etag(Utils.pExport(e,"ETag","")),this.sharedToAll(!!Utils.pExport(e,"SharedToAll",!1)),o=Utils.pExport(e,"GroupsIds",[]),_.isArray(o)&&this.groups(_.map(o,function(e){return Utils.pString(e)}))}},CContactModel.prototype.getFullEmail=function(e){return Utils.Address.getFullEmail(this.displayName(),e)},CContactModel.prototype.getEmailsString=function(){return _.uniq(_.without([this.email(),this.personalEmail(),this.businessEmail(),this.otherEmail()],"")).join(",")},CContactModel.prototype.viewAllMails=function(){App.MailCache.searchMessagesInInbox("email:"+this.getEmailsString())},CContactModel.prototype.sendThisContact=function(){App.Api.composeMessageWithVcard(this)},CContactModel.prototype.isStrLink=function(e){return/^http/.test(e)},CContactModel.prototype.onCallClick=function(e){App.Phone.call(e)},CContactModel.prototype.viewAllMailsWithContact=function(){var e=this.getEmailsString();AppData.SingleMode&&window.opener&&window.opener.App?(window.opener.App.MailCache.searchMessagesInCurrentFolder("email:"+e),window.opener.focus(),window.close()):App.MailCache.searchMessagesInCurrentFolder("email:"+e)},CPostModel.prototype.parse=function(e){if(this.Id=e.IdHelpdeskPost,this.IdThread=e.IdHelpdeskThread,this.IdOwner=e.IdOwner,this.bThreadOwner=e.IsThreadOwner,this.sFrom=Utils.isNonEmptyArray(e.Owner)?e.Owner[1]||e.Owner[0]||"":Utils.i18n("HELPDESK/THREAD_DELETED_USER"),this.sDate=CDateModel.prototype.convertDate(e.Created),this.iType=e.Type,this.bSysType=e.SystemType,this.sText=Utils.pString(e.Text),this.itsMe(e.ItsMe),e.Attachments){var t=0,i=0,s=null,o=[],n=Date.now().toString();for(i=e.Attachments.length;i>t;t++)e.Attachments[t]&&"Object/CHelpdeskAttachment"===Utils.pExport(e.Attachments[t],"@Object","")&&(s=new CHelpdeskAttachmentModel,s.parse(e.Attachments[t]),s.getInThumbQueue(n),o.push(s));this.attachments(o)}},CThreadListModel.prototype.parse=function(e){this.Id=e.IdHelpdeskThread,this.ThreadHash=Utils.pString(e.ThreadHash),this.IdOwner=e.IdOwner,this.ItsMe=!!e.ItsMe,this.sSubject=Utils.pString(e.Subject),this.time(Utils.pInt(e.Updated)),this.aOwner=Utils.isNonEmptyArray(e.Owner)?e.Owner:["",""],this.sEmail=this.aOwner[0]||"",this.sName=this.aOwner[1]||"",this.sFrom=this.sName||this.sEmail,this.sFromFull=Utils.trim(""===this.sName?this.sEmail:this.sName+(""!==this.sEmail?" ("+this.sEmail+")":"")),this.postsCount(e.PostCount),this.state(e.Type),this.unseen(!e.IsRead)},CThreadListModel.prototype.Name=function(){return this.sName},CThreadListModel.prototype.Email=function(){return this.sEmail},CThreadListModel.prototype.updateMomentDate=function(){this.time.valueHasMutated()},Utils.extend(CHelpdeskAttachmentModel,CCommonFileModel),CHelpdeskAttachmentModel.prototype.dataObjectName="Object/CHelpdeskAttachment",CHelpdeskAttachmentModel.prototype.getInstance=function(){return new CHelpdeskAttachmentModel},CHelpdeskAttachmentModel.prototype.fillDataAfterUploadComplete=function(e){this.tempName(e.Result.HelpdeskFile.TempName),this.type(e.Result.HelpdeskFile.MimeType),this.hash(e.Result.HelpdeskFile.Hash)},CUserSettingsModel.prototype.parse=function(e){null!==e&&(this.Name=Utils.pString(e.Name),this.Email=Utils.pString(e.Email),e.Language&&(this.DefaultLanguage=Utils.pString(e.Language)),e.DateFormat&&(this.DefaultDateFormat=Utils.pString(e.DateFormat)),this.defaultTimeFormat(Utils.pString(e.TimeFormat)),this.IsHelpdeskAgent=!!e.IsHelpdeskAgent,this.HelpdeskIframeUrl=Utils.pString(e.HelpdeskIframeUrl),this.HasPassword=e.HasPassword)},CUserSettingsModel.prototype.updateSettings=function(e,t,i,s){this.Name=e,this.DefaultLanguage=t,this.DefaultDateFormat=s,this.defaultTimeFormat(i)},CInformationViewModel.prototype.showLoading=function(e){this.loadingMessage(e&&""!==e?e:Utils.i18n("MAIN/LOADING")),this.loadingVisible(!0),_.defer(_.bind(function(){this.loadingHidden(!1)},this))},CInformationViewModel.prototype.hideLoading=function(){this.loadingHidden(!0),setTimeout(_.bind(function(){this.loadingHidden()&&this.loadingVisible(!1)},this),this.iAnimationDuration)},CInformationViewModel.prototype.showReport=function(e,t){0!==t&&(t=t||this.iReportDuration),e&&""!==e?(this.reportMessage(e),this.reportVisible(!0),_.defer(_.bind(this.reportHidden,this,!1)),clearTimeout(this.iReportTimeout),0===t?this.reportVisibleClose(!0):(this.reportVisibleClose(!1),this.iReportTimeout=setTimeout(_.bind(this.selfHideReport,this),t))):(this.reportHidden(!0),this.reportVisible(!1))},CInformationViewModel.prototype.selfHideReport=function(){this.reportHidden(!0),setTimeout(_.bind(function(){this.reportHidden()&&this.reportVisible(!1)},this),this.iAnimationDuration)},CInformationViewModel.prototype.showError=function(e,t,i,s){e&&""!==e?(this.gray(!!s),this.errorMessage(e),this.isHtmlError(t),this.errorVisible(!0),_.defer(_.bind(function(){this.errorHidden(!1)},this)),
clearTimeout(this.iErrorTimeout),i||(this.iErrorTimeout=setTimeout(_.bind(function(){this.selfHideError()},this),this.iErrorDuration))):this.selfHideError()},CInformationViewModel.prototype.selfHideError=function(){this.errorHidden(!0),setTimeout(_.bind(function(){this.errorHidden()&&this.errorVisible(!1)},this),this.iAnimationDuration)},CInformationViewModel.prototype.hideError=function(e){e=Utils.isUnd(e)?!1:!!e,e===this.gray()&&this.selfHideError()},CPageSwitcherViewModel.prototype.hotKeysBind=function(){$(document).on("keydown",$.proxy(function(e){if(this.shown&&!Utils.isTextFieldFocused()){var t=e.keyCode;e.ctrlKey&&t===Enums.Key.Left?this.clickPreviousPage():e.ctrlKey&&t===Enums.Key.Right&&this.clickNextPage()}},this))},CPageSwitcherViewModel.prototype.hide=function(){this.shown=!1},CPageSwitcherViewModel.prototype.show=function(){this.shown=!0},CPageSwitcherViewModel.prototype.clear=function(){this.currentPage(1),this.count(0)},CPageSwitcherViewModel.prototype.setCount=function(e){this.count(e),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},CPageSwitcherViewModel.prototype.setPage=function(e,t){this.perPage(t),this.currentPage(e>this.pagesCount()?this.pagesCount():e)},CPageSwitcherViewModel.prototype.clickPage=function(e){var t=e.number;1>t&&(t=1),t>this.pagesCount()&&(t=this.pagesCount()),this.currentPage(t)},CPageSwitcherViewModel.prototype.clickFirstPage=function(){this.currentPage(1)},CPageSwitcherViewModel.prototype.clickPreviousPage=function(){var e=this.currentPage()-1;1>e&&(e=1),this.currentPage(e)},CPageSwitcherViewModel.prototype.clickNextPage=function(){var e=this.currentPage()+1;e>this.pagesCount()&&(e=this.pagesCount()),this.currentPage(e)},CPageSwitcherViewModel.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},CHelpdeskLoginViewModel.prototype.__name="CHelpdeskLoginViewModel",CHelpdeskLoginViewModel.prototype.onShow=function(){var e=App.Storage.getData("ReportText");e&&(App.Api.showReport(e),App.Storage.removeData("ReportText")),App.Storage.getData("helpdeskQuestion")&&this.helpdeskQuestion(App.Storage.getData("helpdeskQuestion")),$html.addClass("non-adjustable-valign")},CHelpdeskLoginViewModel.prototype.onHide=function(){this.loginProcess(!1),this.registeringProcess(!1),this.sendingPasswordProcess(!1),this.changingPasswordProcess(!1),this.email(""),this.password(""),this.regEmail(""),this.regSocialEmail(""),this.regName(""),this.regPassword(""),this.regConfirmPassword(""),this.forgotEmail(""),this.changepassNewpass(""),this.changepassConfirmpass(""),this.helpdeskQuestion(""),this.gotoForgot(!1),this.gotoRegister(!1),this.gotoSignin(!1),this.gotoSocialRegister(!1),this.gotoChangepass(!1)},CHelpdeskLoginViewModel.prototype.socialNetworkLogin=function(){this.regSocialEmail(this.socialEmail()),this.socialIsLoggedIn()&&this.gotoSocialRegister(!0)},CHelpdeskLoginViewModel.prototype.onSocialClick=function(e){if(this.storeQuestion(),$.cookie("external-services-redirect","helpdesk"),window!==window.top){var t=screen.width/2-350,i=screen.height/2-300;window.open(Utils.Common.getAppPath()+"?external-services="+e+"&scopes=login",e,"location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes,menubar=no,width=700,height=600,left="+t+",top="+i)}else window.location.href="?external-services="+e+"&scopes=login"},CHelpdeskLoginViewModel.prototype.storeQuestion=function(){""!==this.helpdeskQuestion()&&App.Storage.setData("helpdeskQuestion",this.helpdeskQuestion())},CHelpdeskLoginViewModel.prototype.actionSend=function(){this.storeQuestion(),this.gotoRegister(!0)},CHelpdeskLoginViewModel.prototype.actionLogin=function(){$(".check_autocomplete_input").trigger("input").trigger("change").trigger("keydown"),Utils.trim(this.password())&&""!==Utils.trim(this.email())?(this.storeQuestion(),this.loginProcess(!0),App.Ajax.sendExt({Action:"HelpdeskLogin",Email:this.email(),Password:this.password(),SignMe:this.signMe()?"1":"0"},this.onHelpdeskLoginResponse,this)):this.shake(!0)},CHelpdeskLoginViewModel.prototype.onHelpdeskLoginResponse=function(e,t){this.loginProcess(!1),e.Result?window.location.reload():e.ErrorCode===Enums.Errors.HelpdeskThrowInWebmail?window.location.href="":(e.ErrorCode===Enums.Errors.NotDisplayedError&&(e.ErrorCode=Enums.Errors.DataTransferFailed),App.Api.showErrorByCode(e,Utils.i18n("HELPDESK/ERROR_LOGIN_FAILED")),this.shake(!0),this.emailFocus(!0))},CHelpdeskLoginViewModel.prototype.actionRegister=function(){this.regPassword()!==this.regConfirmPassword()?(App.Api.showError(Utils.i18n("WARNING/PASSWORDS_DO_NOT_MATCH")),this.regPasswordFocus(!0)):(this.registeringProcess(!0),App.Ajax.sendExt({Action:"HelpdeskRegister",Email:this.regEmail(),Password:this.regPassword(),Name:this.regName()},this.onHelpdeskRegisterResponse,this))},CHelpdeskLoginViewModel.prototype.onHelpdeskRegisterResponse=function(e,t){this.registeringProcess(!1),e.Result===!1?(e.ErrorCode===Enums.Errors.NotDisplayedError&&(e.ErrorCode=Enums.Errors.DataTransferFailed),App.Api.showErrorByCode(e,Utils.i18n("HELPDESK/ERROR_REGISTRATION_FAILED")),this.regEmailFocus(!0)):(App.Api.showReport(Utils.i18n("HELPDESK/ACTIVATION_DESCRIPTION",{EMAIL:this.regEmail()})),this.gotoRegister(!1))},CHelpdeskLoginViewModel.prototype.actionSocialRegister=function(){if(!this.registeringProcess()){if(""===this.regSocialEmail())return void this.regSocialEmailFocus(!0);this.registeringProcess(!0),App.Ajax.sendExt({Action:"SocialRegister",NotificationEmail:this.regSocialEmail()},this.onHelpdeskSocialRegisterResponse,this)}},CHelpdeskLoginViewModel.prototype.onHelpdeskSocialRegisterResponse=function(e,t){this.registeringProcess(!1),e.Result===!1?(e.ErrorCode===Enums.Errors.NotDisplayedError&&(e.ErrorCode=Enums.Errors.DataTransferFailed),App.Api.showErrorByCode(e,Utils.i18n("HELPDESK/ERROR_REGISTRATION_FAILED")),this.regSocialEmailFocus(!0)):window.location.href=AppData.TenantHash?"?helpdesk="+AppData.TenantHash:"?helpdesk"},CHelpdeskLoginViewModel.prototype.actionForgot=function(){this.sendingPasswordProcess(!0),App.Ajax.sendExt({Action:"HelpdeskForgot",Email:this.forgotEmail()},this.onHelpdeskForgotResponse,this)},CHelpdeskLoginViewModel.prototype.onHelpdeskForgotResponse=function(e,t){this.sendingPasswordProcess(!1),e.Result===!1?(e.ErrorCode===Enums.Errors.NotDisplayedError&&(e.ErrorCode=Enums.Errors.DataTransferFailed),App.Api.showErrorByCode(e,Utils.i18n("HELPDESK/ERROR_FORGOT_FAILED")),this.forgotEmailFocus(!0)):(App.Api.showReport(Utils.i18n("HELPDESK/INFO_FORGOT_SUCCESSFULL")),this.email(this.forgotEmail()),this.passwordFocus(!0),_.delay(_.bind(function(){this.forgotEmail("")},this),500),this.gotoForgot(!1))},CHelpdeskLoginViewModel.prototype.backToLogin=function(){location.replace("?helpdesk="+AppData.TenantHash)},CHelpdeskLoginViewModel.prototype.actionChangepass=function(){if(!this.changingPasswordProcess()){var e={Action:"HelpdeskForgotChangePassword",TenantHash:AppData.TenantHash,ActivateHash:AppData.HelpdeskForgotHash,NewPassword:this.changepassNewpass()};if(""===this.changepassNewpass())return void this.changepassNewpassFocus(!0);if(""===this.changepassConfirmpass())return void this.changepassConfirmpassFocus(!0);if(this.changepassNewpass()!==this.changepassConfirmpass())return App.Api.showError(Utils.i18n("WARNING/PASSWORDS_DO_NOT_MATCH")),void this.changepassNewpassFocus(!0);this.changingPasswordProcess(!0),App.Ajax.sendExt(e,this.onHelpdeskForgotChangePasswordResponse,this)}},CHelpdeskLoginViewModel.prototype.onHelpdeskForgotChangePasswordResponse=function(e,t){this.changingPasswordProcess(!1),e.Result===!1?(e.ErrorCode===Enums.Errors.NotDisplayedError&&(e.ErrorCode=Enums.Errors.DataTransferFailed),App.Api.showErrorByCode(e,Utils.i18n("HELPDESK/ERROR_CHANGEPASS_FAILED")),this.changepassNewpassFocus(!0)):(App.Storage.setData("ReportText",Utils.i18n("HELPDESK/INFO_CHANGEPASS_SUCCESSFULL")),this.backToLogin())},CHelpdeskHeaderViewModel.prototype.logout=function(){App.logout()},CHelpdeskViewModel.prototype.initInputosaurus=function(e,t,i,s){e()&&$(e()).length>0&&$(e()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:_.bind(function(e,t){this.autocompleteCallback(e.term,t)},this),autoCompleteAppendTo:$(e()).closest("td"),change:_.bind(function(e){i(!0),this.setRecipient(t,e.target.value),i(!1)},this),copy:_.bind(function(e){this.inputosaurusBuffer=e},this),paste:_.bind(function(){var e=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",e},this),focus:_.bind(this.focusedField,this,s),mobileDevice:bMobileDevice})},CHelpdeskViewModel.prototype.autocompleteCallback=function(e,t){var i={Action:"ContactSuggestions",Search:e};App.Ajax.send(i,function(e){var i=[];e&&e.Result&&e.Result&&e.Result.List&&(i=_.map(e.Result.List,function(e){var t="",i=e.Email;return e.IsGroup?t=e.Name&&0<Utils.trim(e.Name).length?'"'+e.Name+'" ('+e.Email+")":"("+e.Email+")":(t=Utils.Address.getFullEmail(e.Name,e.Email),i=t),{label:t,value:i,frequency:e.Frequency}}),i=_.compact(i)),t(i)},this)},CHelpdeskViewModel.prototype.setRecipient=function(e,t){e()===t?e.valueHasMutated():e(t)},CHelpdeskViewModel.prototype.requestFromLogin=function(){this.bExtApp&&App.Storage.getData("helpdeskQuestion")&&(this.newThreadText(App.Storage.getData("helpdeskQuestion")),App.Storage.removeData("helpdeskQuestion"),this.executeThreadCreate())},CHelpdeskViewModel.prototype.cleanAll=function(){this.replyText(""),this.replyTextFocus(!1),this.newThreadText(""),this.uploadedFiles([]),this.posts([]),this.internalNote(!1),this.isQuickReplyActive(!1),this.ccbccVisible(!1),this.ccAddr(""),this.bccAddr("")},CHelpdeskViewModel.prototype.onOwnerContactResponse=function(e){e?(this.ownerContact(e),this.ownerExistsInContacts(!0)):(this.ownerContact(new CContactModel),this.ownerExistsInContacts(!1)),this.ownerContactInfoReceived(!0)},CHelpdeskViewModel.prototype.updateOpenerWindow=function(){this.singleMode&&window.opener&&window.opener.App&&window.opener.App.updateHelpdesk()},CHelpdeskViewModel.prototype.deletePost=function(e){e&&e.itsMe()&&App.Screens.showPopup(ConfirmPopup,[Utils.i18n("HELPDESK/CONFIRM_DELETE_THIS_POST"),_.bind(function(t){t&&(this.postForDelete(e),App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskPostDelete",PostId:e.Id,ThreadId:e.IdThread,IsExt:this.bExtApp?1:0},this.onHelpdeskPostDeleteResponse,this))},this)])},CHelpdeskViewModel.prototype.onHelpdeskPostDeleteResponse=function(e,t){e.Result===!1?App.Api.showErrorByCode(e,Utils.i18n("HELPDESK/ERROR_COULDNT_DELETE_POST")):(this.posts.remove(this.postForDelete()),App.Api.showReport(Utils.i18n("HELPDESK/REPORT_POST_HAS_BEEN_DELETED"))),this.requestPosts(),this.updateOpenerWindow()},CHelpdeskViewModel.prototype.addToContacts=function(){this.selectedItem()&&App.ContactsCache.addToContacts("",this.selectedItem().sEmail,this.onAddToContactsResponse,this)},CHelpdeskViewModel.prototype.iHaveMoreToSay=function(){this.isQuickReplyHidden(!1),_.delay(_.bind(function(){this.replyTextFocus(!0)},this),300)},CHelpdeskViewModel.prototype.onAddToContactsResponse=function(e,t){e.Result&&this.selectedItem()&&""!==t.HomeEmail&&t.HomeEmail===this.selectedItem().sEmail&&(App.Api.showReport(Utils.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),App.ContactsCache.clearInfoAboutEmail(this.selectedItem().sEmail),App.ContactsCache.getContactsByEmails([this.selectedItem().sEmail],this.onOwnerContactResponse,this))},CHelpdeskViewModel.prototype.scrollPostsToBottom=function(){this.scrollToBottomTrigger(!this.scrollToBottomTrigger())},CHelpdeskViewModel.prototype.scrollPostsToTop=function(){this.scrollToTopTrigger(!this.scrollToTopTrigger())},CHelpdeskViewModel.prototype.showClientDetails=function(){this.clientDetailsVisible(!0)},CHelpdeskViewModel.prototype.hideClientDetails=function(){this.clientDetailsVisible(!1)},CHelpdeskViewModel.prototype.startAutocheckmail=function(){var e=this,t=AppData&&AppData.User?AppData.User.AutoCheckMailInterval:1;t>0&&(clearTimeout(this.iAutoCheckTimer),this.iAutoCheckTimer=setTimeout(function(){e.checkCommand()},60*t*1e3))},CHelpdeskViewModel.prototype.onApplyBindings=function(e){this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",$(".items_list",e),$(".threads_scroll.scroll-inner",e)),this.initUploader(),$(this.domQuickReply()).on("click",_.bind(function(e){this.preventFalseClick(!0)},this)),$(document.body).on("click",_.bind(function(e){App.Screens.currentScreen()===Enums.Screens.Helpdesk&&this.isQuickReplyPaneEmpty()&&!this.preventFalseClick()&&(this.replyText(""),this.isQuickReplyActive(!1))},this)),App.registerHelpdeskUpdateFunction&&App.registerHelpdeskUpdateFunction(_.bind(this.checkCommand,this)),this.startAutocheckmail()},CHelpdeskViewModel.prototype.onShow=function(){this.newThreadButtonWidth.notifySubscribers(),this.selector.useKeyboardKeys(!0),this.oPageSwitcher.show(),this.oPageSwitcher.perPage(this.ThreadsPerPage),this.oPageSwitcher.currentPage(1),this.requestThreadsList()},CHelpdeskViewModel.prototype.onHide=function(){this.selector.useKeyboardKeys(!1),this.oPageSwitcher.hide()},CHelpdeskViewModel.prototype.requestThreadsList=function(){this.newThreadCreating()||(this.loadingList(!0),this.checkStarted(!0),App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadsList",IsExt:this.bExtApp?1:0,Offset:(this.oPageSwitcher.currentPage()-1)*this.ThreadsPerPage,Limit:this.ThreadsPerPage,Filter:this.listFilter(),Search:this.search()},this.onHelpdeskThreadsListResponse,this),this.requestThreadsPendingCount())},CHelpdeskViewModel.prototype.requestThreadByIdOrHash=function(e,t){App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadByIdOrHash",IsExt:this.bExtApp?1:0,ThreadId:e?e:0,ThreadHash:t?t:""},this.onThreadByIdOrHashResponse,this)},CHelpdeskViewModel.prototype.requestThreadsPendingCount=function(){App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadsPendingCount",IsExt:this.bExtApp?1:0},this.onHelpdeskThreadsPendingCountResponse,this)},CHelpdeskViewModel.prototype.onHelpdeskThreadsListResponse=function(e,t){var i=0,s=0,o=this.selectedItem(),n=o?Utils.pString(o.Id):"",r=[],a=null,l=null,p=e.Result&&_.isArray(e.Result.List)?e.Result.List:[];if(this.checkStarted(!1),e.Result===!1)App.Api.showErrorByCode(e);else{for(s=p.length;s>i;i++)p[i]&&"Object/CHelpdeskThread"===Utils.pExport(p[i],"@Object","")&&(a=new CThreadListModel,a.parse(p[i]),a.OwnerIsMe=Utils.pString(a.IdOwner),n===Utils.pString(a.Id)&&(o.postsCount(a.postsCount()),a.selected(!0),this.selector.itemSelected(a)),r.push(a));if(this.loadingList(!1),this.newThreadId()){var h=this.newThreadId();this.onItemSelect(_.find(this.threads().concat(r),function(e){return e.ItsMe&&e.Id===h})),this.newThreadId(null)}this.threads(r),this.setUnseenCount(),this.oPageSwitcher.setCount(Utils.pInt(e.Result.ItemsCount)),AppData.HelpdeskThreadId&&(l=_.find(r,function(e){return e.Id===AppData.HelpdeskThreadId},this),l?this.onItemSelect(l):r.length&&this.requestThreadByIdOrHash(AppData.HelpdeskThreadId)),AppData.HelpdeskThreadAction&&("add"===AppData.HelpdeskThreadAction?this.iHaveMoreToSay():"close"===AppData.HelpdeskThreadAction&&this.closeCommand())}},CHelpdeskViewModel.prototype.onHelpdeskThreadsPendingCountResponse=function(e,t){e.Result===!1?App.Api.showErrorByCode(e):App.helpdeskPendingCount(e.Result)},CHelpdeskViewModel.prototype.requestPosts=function(e,t){var i=this.selectedItem(),s=e?e.Id:i?i.Id:0,o=t?t:0,n={};s&&(n={Action:"HelpdeskThreadPosts",IsExt:this.bExtApp?1:0,ThreadId:s,StartFromId:o,Limit:5},o&&this.loadingMoreMessages(!0),App.Ajax[this.ajaxSendFunc](n,this.onHelpdeskThreadPostsResponse,this))},CHelpdeskViewModel.prototype.onHelpdeskThreadPostsResponse=function(e,t){var i=this,s=0,o=0,n=[],r=[],a=null,l=e.Result&&_.isArray(e.Result.List)?e.Result.List:[];if(e.Result===!1)App.Api.showErrorByCode(e);else if(this.selectedItem()&&e.Result.ThreadId===this.selectedItem().Id){for(this.selectedItem().postsCount(Utils.pInt(e.Result.ItemsCount)),o=l.length;o>s;s++)l[s]&&"Object/CHelpdeskPost"===Utils.pExport(l[s],"@Object","")&&(a=new CPostModel,a.parse(l[s]),n.push(a));r=this.posts(),e.Result.StartFromId?(_.each(n,function(e,t){this.posts.unshift(e)},this),this.loadingMoreMessages(!1)):(0===r.length||r[r.length-1].Id!==n[0].Id)&&(0!==r.length?_.each(n.reverse(),function(e,t){_.find(r,function(t){return t.Id===e.Id})||this.posts.push(e)},this):this.posts(n.reverse()),_.delay(function(){i.scrollPostsToBottom()},100)),this.selectedItem().unseen()&&this.executeThreadSeen(this.selectedItem().Id)}},CHelpdeskViewModel.prototype.onRoute=function(e){var t=e[0],i=_.find(this.threads(),function(e){return e.ThreadHash===t});i?(i=i,this.onItemSelect(i)):0===this.threads().length&&this.loadingList()&&void 0===this.threadSubscription&&!AppData.SingleMode?this.threadSubscription=this.threads.subscribe(function(){this.onRoute(e),this.threadSubscription.dispose(),this.threadSubscription=void 0},this):t?this.requestThreadByIdOrHash(null,t):(this.selectedItem(null),this.selector.itemSelected(null))},CHelpdeskViewModel.prototype.onThreadByIdOrHashResponse=function(e,t){var i=new CThreadListModel;e.Result&&(i.parse(e.Result),i.OwnerIsMe=Utils.pString(i.IdOwner),this.onItemSelect(i))},CHelpdeskViewModel.prototype.onItemSelect=function(e){this.previousSelectedItem(this.selectedItem()),(!this.selectedItem()||e&&(this.selectedItem().ThreadHash!==e.ThreadHash||this.selectedItem().Id!==e.Id))&&(this.replySendingStarted()||this.isQuickReplyPaneEmpty()&&this.isNewThreadPaneEmpty()?this.selectItem(e):App.Screens.showPopup(ConfirmPopup,[Utils.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),_.bind(function(t){t?this.selectItem(e):(this.replyTextFocus(!0),this.isQuickReplyHidden(!1),this.selector.itemSelected(this.previousSelectedItem()))},this)]))},CHelpdeskViewModel.prototype.onItemDelete=function(){this.executeDelete()},CHelpdeskViewModel.prototype.selectItem=function(e){this.visibleNewThread(!1),this.selector.listCheckedAndSelected(!1),this.cleanAll(),e&&(this.selector.itemSelected(e),this.selectedItem(e),this.isQuickReplyHidden(e.ItsMe||!this.bAgent),this.requestPosts(e),this.singleMode||App.Routing.setHash([Enums.Screens.Helpdesk,e.ThreadHash]),e.postsCount(0),this.posts([]))},CHelpdeskViewModel.prototype.openNewThread=function(){this.selector.itemSelected(null),this.selectedItem(null),this.visibleNewThread(!0),App.Routing.setHash([Enums.Screens.Helpdesk,""]),this.newThreadTextFocus(!0),this.setSignature(this.newThreadText,this.domNewThreadTextarea())},CHelpdeskViewModel.prototype.cancelNewThread=function(){this.onItemSelect(this.previousSelectedItem())},CHelpdeskViewModel.prototype.isEnableListActions=function(){return!!this.selectedItem()},CHelpdeskViewModel.prototype.executeDelete=function(){var e=this,t=this.selectedItem();t&&(_.each(this.threads(),function(e){e===t&&e.deleted(!0)}),_.delay(function(){e.threads.remove(function(e){return e.deleted()})},500),this.selectedItem(null),App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadDelete",IsExt:this.bExtApp?1:0,ThreadId:t.Id},this.onHelpdeskThreadDeleteResponse,this),App.Routing.setHash([Enums.Screens.Helpdesk,""]))},CHelpdeskViewModel.prototype.executeOpenNewWindow=function(){var e=App.Routing.buildHashFromArray([Enums.Screens.SingleHelpdesk,this.selectedItem().ThreadHash]);Utils.WindowOpener.openTab(e)},CHelpdeskViewModel.prototype.onHelpdeskThreadDeleteResponse=function(e,t){this.requestThreadsList(),this.updateOpenerWindow()},CHelpdeskViewModel.prototype.executeChangeState=function(e){var t=this.selectedItem();void 0!==e&&t&&(t.state(e),App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadChangeState",IsExt:this.bExtApp?1:0,ThreadId:t.Id,Type:t.state()},this.onHelpdeskThreadChangeStateResponse,this))},CHelpdeskViewModel.prototype.onHelpdeskThreadChangeStateResponse=function(e,t){this.requestThreadsList(),this.updateOpenerWindow()},CHelpdeskViewModel.prototype.executeThreadPing=function(e){void 0!==e&&App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadPing",IsExt:this.bExtApp?1:0,ThreadId:e},this.onThreadPingResponse,this)},CHelpdeskViewModel.prototype.onThreadPingResponse=function(e,t){this.watchers(_.map(e.Result,function(e){var t=e.length>0?e[0].replace(/"/g,""):"",i=e.length>0?e[1]:"",s={name:t,email:i,text:i,initial:i.substr(0,2),icon:""};return i.length>0&&t.length>0?(s.text='"'+t+'" <'+i+">",s.initial=/\s/g.test(t)?this.getInitials(t):t.substr(0,2)):i.length>0?(s.text=i,s.initial=i.substr(0,2)):t.length>0&&(s.text=t,s.initial=this.getInitials(t)),s},this))},CHelpdeskViewModel.prototype.getInitials=function(e){return _.reduce(e.split(" ",2),function(e,t){return e+t.substr(0,1)},"")},CHelpdeskViewModel.prototype.executeThreadSeen=function(e){void 0!==e&&App.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadSeen",IsExt:this.bExtApp?1:0,ThreadId:e},this.onHelpdeskThreadSeenResponse,this)},CHelpdeskViewModel.prototype.onHelpdeskThreadSeenResponse=function(e,t){e.Result&&this.selectedItem()&&(this.selectedItem().unseen(!1),this.setUnseenCount()),this.updateOpenerWindow()},CHelpdeskViewModel.prototype.executeThreadCreate=function(){var e=Utils.trim(this.newThreadText().replace(/[\n\r]/," ")),t=e.indexOf(" ",40);t>=0&&(e=e.substring(0,t)),this.newThreadCreating(!0),this.sendHelpdeskPostCreate(0,e,this.newThreadText(),this.onThreadCreateResponse)},CHelpdeskViewModel.prototype.onThreadCreateResponse=function(e,t){this.newThreadCreating(!1),e.Result&&t&&(App.Api.showReport(Utils.i18n("HELPDESK/REPORT_THREAD_SUCCESSFULLY_CREATED")),e.Result.ThreadIsNew&&this.newThreadId(e.Result.ThreadId),this.cleanAll(),this.visibleNewThread(!1)),this.requestThreadsList(),this.updateOpenerWindow()},CHelpdeskViewModel.prototype.executePostCreate=function(){this.selectedItem()&&(this.replySendingStarted(!0),this.sendHelpdeskPostCreate(this.selectedItem().Id,"",this.replyText(),this.onPostCreateResponse))},CHelpdeskViewModel.prototype.onPostCreateResponse=function(e,t){this.replySendingStarted(!1),e.Result&&t&&(App.Api.showReport(Utils.i18n("HELPDESK/REPORT_POST_SUCCESSFULLY_ADDED")),this.cleanAll(),this.requestPosts()),this.requestThreadsList(),this.updateOpenerWindow()},CHelpdeskViewModel.prototype.sendHelpdeskPostCreate=function(e,t,i,s){var o={},n={};_.each(this.uploadedFiles(),function(e){o[e.tempName()]=e.hash()}),n={Action:"HelpdeskPostCreate",IsExt:this.bExtApp?1:0,ThreadId:e,IsInternal:this.internalNote()?1:0,Subject:t,Text:i,Cc:this.ccAddr(),Bcc:this.bccAddr(),Attachments:o},App.Ajax[this.ajaxSendFunc](n,s,this)},CHelpdeskViewModel.prototype.onShowThreadsByOwner=function(){this.search("owner:"+this.selectedItem().aOwner[0]),this.listFilter(Enums.HelpdeskFilters.All),this.requestThreadsList()},CHelpdeskViewModel.prototype.onSearch=function(){this.requestThreadsList()},CHelpdeskViewModel.prototype.onClearSearch=function(){this.search(""),this.requestThreadsList()},CHelpdeskViewModel.prototype.initUploader=function(){this.oJua=this.createJuaObject(this.uploaderButton()),this.oJuaCompose=this.createJuaObject(this.uploaderButtonCompose())},CHelpdeskViewModel.prototype.createJuaObject=function(e){if(e){var t=new Jua({action:"?/Upload/HelpdeskFile/",name:"jua-uploader",queueSize:2,clickElement:e,hiddenElementsPosition:Utils.isRTL()?"right":"left",dragAndDropElement:e,disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:{IsExt:this.bExtApp?"1":"0",Token:AppData.Token,TenantHash:this.bExtApp&&AppData?AppData.TenantHash:"",AccountID:this.bExtApp?0:AppData.Accounts.currentId()}});return t.on("onProgress",_.bind(this.onFileUploadProgress,this)).on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onStart",_.bind(this.onFileUploadStart,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",_.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",_.bind(this.bDragActive,this,!1)),t}return null},CHelpdeskViewModel.prototype.onFileRemove=function(e){var t=this.getUploadedFileByUID(e);this.oJua&&this.oJua.cancel(e),this.uploadedFiles.remove(t)},CHelpdeskViewModel.prototype.getUploadedFileByUID=function(e){return _.find(this.uploadedFiles(),function(t){return t.uploadUid()===e})},CHelpdeskViewModel.prototype.onFileUploadSelect=function(e,t){var i,s=Utils.i18n("HELPDESK/ERROR_UPLOAD_FILES_COUNT"),o=Utils.i18n("MAIN/BUTTON_CLOSE"),n=this.uploadedFiles().length;return n>=5?(App.Screens.showPopup(AlertPopup,[s,null,"",o]),!1):App.Api.showErrorIfAttachmentSizeLimit(t.FileName,t.Size)?!1:(i=new CHelpdeskAttachmentModel,i.onUploadSelect(e,t),this.uploadedFiles.push(i),!0)},CHelpdeskViewModel.prototype.onFileUploadProgress=function(e,t,i){var s=this.getUploadedFileByUID(e);s&&s.onUploadProgress(t,i)},CHelpdeskViewModel.prototype.onFileUploadStart=function(e){var t=this.getUploadedFileByUID(e);t&&t.onUploadStart()},CHelpdeskViewModel.prototype.onFileUploadComplete=function(e,t,i){var s=this.getUploadedFileByUID(e),o=Date.now().toString();s&&(s.onUploadComplete(e,t,i),"image"===s.type().substr(0,5)&&(s.thumb(!0),s.getInThumbQueue(o)))},CHelpdeskViewModel.prototype.setUnseenCount=function(){App.helpdeskUnseenCount(_.filter(this.threads(),function(e){return e.unseen()},this).length)},CHelpdeskViewModel.prototype.quoteText=function(e){var t=this.replyText(),i=_.bind(function(){this.replyText(""===t?">"+e:t+"\n>"+e),this.replyTextFocus(!0)},this);this.isQuickReplyHidden()?_.delay(function(){i()},300):i(),this.isQuickReplyHidden(!1)},CHelpdeskViewModel.prototype.setSignature=function(e,t){e&&""===e()&&this.isSignatureVisible()&&e("\r\n\r\n"+this.signature()),t&&setTimeout(function(){if(t=t[0],t.setSelectionRange)t.focus(),t.setSelectionRange(0,0);else if(t.createTextRange){var e=t.createTextRange();e.moveStart("character",0),e.select()}}.bind(this),10)},CHelpdeskViewModel.prototype.changeCcbccVisibility=function(e,t){this.ccbccVisible(!0),$(this.ccAddrDom()).inputosaurus("focus")},CHelpdeskSettingsViewModel.prototype.onShow=function(){this.name(AppData.User.Name),this.language(AppData.User.DefaultLanguage),this.timeFormat(AppData.User.defaultTimeFormat()),this.dateFormat(AppData.User.DefaultDateFormat)},CHelpdeskSettingsViewModel.prototype.onResponse=function(e,t){e.Result===!1?App.Api.showErrorByCode(e,Utils.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):t.Language!==AppData.User.DefaultLanguage?window.location.reload():(AppData.User.updateSettings(t.Name,t.Language,t.TimeFormat,t.DateFormat),App.Api.showReport(Utils.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))},CHelpdeskSettingsViewModel.prototype.save=function(){var e={Action:"HelpdeskSettingsUpdate",Name:this.name(),Language:this.language(),TimeFormat:this.timeFormat(),DateFormat:this.dateFormat()};App.Ajax.sendExt(e,this.onResponse,this)},CHelpdeskSettingsViewModel.prototype.backToHelpdesk=function(){App.Routing.setHash([Enums.Screens.Helpdesk])},CHelpdeskSettingsViewModel.prototype.onChangePasswordClick=function(){App.Screens.showPopup(ChangePasswordPopup,[!0,!0])},CScreens.prototype.initScreens=function(){},CScreens.prototype.initLayout=function(){},CScreens.prototype.init=function(){this.initScreens(),this.initLayout(),$("#pSevenContent").addClass("single_mode"),_.defer(function(){AppData.SingleMode||$("#pSevenContent").removeClass("single_mode")}),this.informationScreen(this.showNormalScreen(Enums.Screens.Information))},CScreens.prototype.hasOpenedMinimizedPopups=function(){var e=!1;return _.each(this.popups,function(t){var i=t.__vm;i.minimized&&i.minimized()&&(e=!0)}),e},CScreens.prototype.hasOpenedMaximizedPopups=function(){var e=!1;return _.each(this.popups,function(t){var i=t.__vm;i.minimized&&i.minimized()||(e=!0)}),e},CScreens.prototype.getCurrentScreenModel=function(){var e=this.oScreens[this.currentScreen()],t="undefined"!=typeof e?e.Model:null;return t},CScreens.prototype.showCurrentScreen=function(e,t){var i=this.oScreens[this.currentScreen()],s="undefined"!=typeof i?i.Model:null;this.currentScreen()!==e&&(s&&i.bInitialized&&s.hideViewModel(),this.currentScreen(e)),this.showNormalScreen(e,t),this.resizeAll()},CScreens.prototype.showNormalScreen=function(e,t){var i=e,s=this.oScreens[i];return s&&(s.bInitialized="boolean"!=typeof s.bInitialized?!1:s.bInitialized,s.bInitialized||(s.Model=this.initViewModel(s.Model,s.TemplateName),s.bInitialized=!0),s.Model.showViewModel(t)),s?s.Model:null},CScreens.prototype.initViewModel=function(e,t){var i=null,s=null;return i=new e,s=$('div[data-view-model="'+t+'"]').attr("data-bind","template: {name: '"+t+"'}").hide(),i.$viewModel=s,i.bShown=!1,i.showViewModel=function(e){bMobileApp&&(bIsWindowsPhone||App.browser.ie)?_.defer(_.bind(function(){this.$viewModel.show()},this)):this.$viewModel.show(),"function"==typeof this.onRoute&&this.onRoute(e),this.bShown||("function"==typeof this.onShow&&this.onShow(e),AfterLogicApi.runPluginHook&&this.__name&&AfterLogicApi.runPluginHook("view-model-on-show",[this.__name,this]),this.bShown=!0)},i.hideViewModel=function(){this.$viewModel.hide(),"function"==typeof this.onHide&&this.onHide(),this.bShown=!1},ko.applyBindings(i,s[0]),"function"==typeof i.onApplyBindings&&i.onApplyBindings(s),i},CScreens.prototype.showPopup=function(e,t){if(e){if(!e.__builded){var i=null,s=new e,o=s.popupTemplate?s.popupTemplate():"";""!==o&&(i=$('div[data-view-model="'+o+'"]').attr("data-bind","template: {name: '"+o+"'}").removeClass("visible").hide(),i&&1===i.length&&(s.visibility=ko.observable(!1),e.__builded=!0,e.__vm=s,s.$viewModel=i,e.__dom=i,s.showViewModel=Utils.createCommand(s,function(){App&&App.Screens&&App.Screens.showPopup(e)}),s.closeCommand=Utils.createCommand(s,function(){App&&App.Screens&&App.Screens.hidePopup(e)}),ko.applyBindings(s,i[0]),Utils.delegateRun(s,"onApplyBindings",[i])))}e.__vm&&e.__dom&&(e.__vm.visibility()||(e.__dom.show(),_.delay(function(){e.__dom.addClass("visible")},50),e.__vm.visibility(!0),this.popups.push(e),1===this.popups.length&&(this.keyupPopupBinded=_.bind(this.keyupPopup,this),$(document).on("keyup",this.keyupPopupBinded))),Utils.delegateRun(e.__vm,"onShow",t))}},CScreens.prototype.keyupPopup=function(e){var t=this.popups.length>0?this.popups[this.popups.length-1].__vm:null;if(e&&t&&(!t.minimized||!t.minimized())){var i=window.parseInt(e.keyCode,10);Enums.Key.Esc===i&&(t.onEscHandler?t.onEscHandler(e):t.closeCommand()),Enums.Key.Enter!==i&&Enums.Key.Space!==i||!t.onEnterHandler||t.onEnterHandler()}},CScreens.prototype.hidePopup=function(e){e&&e.__vm&&e.__dom&&(this.keyupPopupBinded&&1===this.popups.length&&($(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),e.__dom.removeClass("visible").hide(),e.__vm.visibility(!1),Utils.delegateRun(e.__vm,"onHide"),this.popups=_.without(this.popups,e))},CScreens.prototype.showLoading=function(e){this.informationScreen()&&this.informationScreen().showLoading(e)},CScreens.prototype.hideLoading=function(){this.informationScreen()&&this.informationScreen().hideLoading()},CScreens.prototype.showReport=function(e,t){this.informationScreen()&&this.informationScreen().showReport(e,t)},CScreens.prototype.showError=function(e,t,i,s){this.informationScreen()&&this.informationScreen().showError(e,t,i,s)},CScreens.prototype.hideError=function(e){this.informationScreen()&&this.informationScreen().hideError(e)},CScreens.prototype.initHelpdesk=function(){var e=this.oScreens[Enums.Screens.Helpdesk];AppData.User.IsHelpdeskSupported&&e&&!e.bInitialized&&(e.Model=this.initViewModel(e.Model,e.TemplateName),e.bInitialized=!0)},CScreens.prototype.initScreens=function(){this.oScreens[Enums.Screens.Information]={Model:CInformationViewModel,TemplateName:"Common_InformationViewModel"},this.oScreens[Enums.Screens.Login]={Model:CHelpdeskLoginViewModel,TemplateName:"Helpdesk_Login"},this.oScreens[Enums.Screens.Header]={Model:CHelpdeskHeaderViewModel,TemplateName:"Helpdesk_Header"},this.oScreens[Enums.Screens.Helpdesk]={Model:CHelpdeskViewModel,TemplateName:"Helpdesk_HelpdeskViewModel"},this.oScreens[Enums.Screens.Settings]={Model:CHelpdeskSettingsViewModel,TemplateName:"Helpdesk_SettingsExt"}},CScreens.prototype.initLayout=function(){$("#pSevenContent").append($("#HelpdeskLayout").html())},AbstractApp.prototype.init=function(){},
AbstractApp.prototype.collectScreensData=function(){},AbstractApp.prototype.run=function(){},AbstractApp.prototype.momentDateTriggerCallback=function(){var e=ko.dataFor(this);e&&e.updateMomentDate&&e.updateMomentDate()},AbstractApp.prototype.fastMomentDateTrigger=function(){$(".moment-date-trigger-fast").each(this.momentDateTriggerCallback)},AbstractApp.prototype.setTitle=function(e){document.title=".",document.title=e||""},AbstractApp.prototype.tokenProblem=function(){var e="window.location.reload(); return false;",t=Utils.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:e});AppData.Auth=!1,App.Api.showError(t,!0,!0)},_.extend(AppHelpDesk.prototype,AbstractApp.prototype),AppHelpDesk.prototype.init=function(){var e=new CUserSettingsModel,t=new CAppSettingsModel;t.parse(AppData.App),AppData.App=t,e.parse(AppData.User),AppData.User=e},AppHelpDesk.prototype.logout=function(){App.Ajax.sendExt({Action:"HelpdeskLogout"},this.onLogout,this)},AppHelpDesk.prototype.authProblem=function(){this.logout()},AppHelpDesk.prototype.onLogout=function(){window.location.reload()},AppHelpDesk.prototype.run=function(){this.Screens.init(),AppData&&AppData.Auth?this.Routing.init(Enums.Screens.Helpdesk):(this.Screens.showCurrentScreen(Enums.Screens.Login),AppData&&AppData.LastErrorCode===Enums.Errors.AuthError&&this.Api.showError(Utils.i18n("WARNING/AUTH_PROBLEM"),!1,!0),AppData&&AppData.HelpdeskActivatedEmail&&this.Api.showReport(Utils.i18n("HELPDESK/ACCOUNT_ACTIVATED")))},AppHelpDesk.prototype.initHeaderInfo=function(){this.browser.ie?$(document).bind("focusin",_.bind(this.onFocus,this)).bind("focusout",_.bind(this.onBlur,this)):$(window).bind("focus",_.bind(this.onFocus,this)).bind("blur",_.bind(this.onBlur,this))},AppHelpDesk.prototype.onFocus=function(){this.focused(!0)},AppHelpDesk.prototype.onBlur=function(){this.focused(!1)},AppHelpDesk.prototype.setTitle=function(e){document.title=".",document.title=this.getTitleByScreen()},AppHelpDesk.prototype.getTitleByScreen=function(){var e="";switch(this.currentScreen()){case Enums.Screens.Login:e=Utils.i18n("TITLE/HELPDESK",null,"");break;case Enums.Screens.Helpdesk:e=Utils.i18n("TITLE/HELPDESK");break;case Enums.Screens.Settings:e=Utils.i18n("TITLE/SETTINGS")}return""===e?e=AppData.HelpdeskSiteName:""!==AppData.HelpdeskSiteName&&(e+=" - "+AppData.HelpdeskSiteName),e},AppHelpDesk.prototype.addScreenToHeader=function(){},App=new AppHelpDesk,window.App=App,AppData.AllowMobile&&-1===AppData.IsMobile){var bMobile=window.matchMedia("all and (min-width: 768px)").matches?0:1;window.App.Ajax.send({Action:"SystemSetMobile",Mobile:bMobile},function(){bMobile?window.location.reload():$(function(){_.defer(function(){App.run()})})},this)}else $(function(){_.defer(function(){App.run()})});window.Modernizr&&navigator&&window.Modernizr.addTest("mobile",function(){return bMobileApp}),window.AfterLogicApi=AfterLogicApi,window.Enums=Enums,$html.removeClass("no-js").addClass("js"),$html.hasClass("pdf")&&(aViewMimeTypes.push("application/pdf"),aViewMimeTypes.push("application/x-pdf"))}(jQuery,window,ko,crossroads,hasher);
